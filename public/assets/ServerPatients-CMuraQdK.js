import{q as U,r,n as A,j as e,S as D,O as $,C as q,X as z,z as P}from"./index-Bhw970Mt.js";import{C as T}from"./Card-xxJ0N2iO.js";import{R as F}from"./refresh-cw-CEIIBFss.js";import{S as _}from"./square-pen-CZ9eK-q9.js";const O=10,X=()=>{const{actions:E}=U(),[f,y]=r.useState(""),[c,u]=r.useState(1),[p,B]=r.useState(0),[N,R]=r.useState([]),[j,b]=r.useState(!1),[s,n]=r.useState(null),[v,g]=r.useState(!1),[w,o]=r.useState(null),S=r.useMemo(()=>Math.max(1,Math.ceil(p/O)),[p]),{showToast:k}=A(),x=async t=>{b(!0);try{const{data:a}=await P.auth.getSession(),i=a?.session?.access_token,m=t?.resetPage?1:c,l=new URLSearchParams({q:f,page:String(m),pageSize:String(O)}),d=await fetch(`/api/patients?${l.toString()}`,{headers:i?{Authorization:`Bearer ${i}`}:{}}),C=await d.json();d.ok&&(R(C.patients||[]),B(C.total||0),t?.resetPage&&u(1))}finally{b(!1)}};r.useEffect(()=>{x()},[c]);const h=t=>{const a=t.data||t;E.setCurrentPatient({...a,id:t.id||a.id})},L=t=>{const a=t.data?.demographics||t.demographics||{};n({id:t.id,firstName:a.firstName||"",lastName:a.lastName||"",mrn:a.mrn||"",dateOfBirth:a.dateOfBirth||"",sex:a.sex||"unknown",original:t}),o(null)},M=async()=>{if(s){if(!s.firstName?.trim()||!s.lastName?.trim()){o("First and last name are required");return}g(!0),o(null);try{const{data:t}=await P.auth.getSession(),a=t?.session?.access_token;if(!a){o("Not authenticated"),g(!1);return}const i=s.original?.data||s.original,m={...i||{},id:s.id,demographics:{...i?.demographics||{},firstName:s.firstName,lastName:s.lastName,mrn:s.mrn,dateOfBirth:s.dateOfBirth,sex:s.sex},lastUpdated:new Date().toISOString()},l=await fetch("/api/patients",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({patient:m})});if(!l.ok){const d=await l.json().catch(()=>({}));throw new Error(d?.error||`Save failed (${l.status})`)}n(null),await x(),k("success","Patient updated")}catch(t){o(t?.message||"Save failed"),k("error",t?.message||"Save failed")}finally{g(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(T,{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(D,{className:"w-5 h-5 text-gray-400"}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"All Patients"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("input",{value:f,onChange:t=>y(t.target.value),placeholder:"Search by name or MRN",className:"flex-1 border border-gray-300 rounded px-3 py-2 text-sm"}),e.jsx("button",{onClick:()=>x({resetPage:!0}),className:"px-3 py-2 bg-blue-600 text-white rounded text-sm",children:"Search"}),e.jsx("button",{onClick:()=>{y(""),x({resetPage:!0})},className:"px-3 py-2 bg-white border rounded text-sm",children:"Clear"}),e.jsxs("button",{onClick:()=>x(),className:"px-3 py-2 bg-white border rounded text-sm flex items-center gap-1",children:[e.jsx(F,{className:"w-4 h-4"})," Refresh"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MRN"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DOB"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[N.map(t=>{const a=t.data?.demographics||t.demographics||{},i=`${a.firstName||""} ${a.lastName||""}`.trim(),m=a.mrn||"",l=a.dateOfBirth?new Date(a.dateOfBirth).toLocaleDateString():"",d=t.data?.lastUpdated||t.lastUpdated?new Date(t.data?.lastUpdated||t.lastUpdated).toLocaleString():"";return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 cursor-pointer",onClick:()=>h(t),children:i||"—"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 cursor-pointer",onClick:()=>h(t),children:m||"—"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 cursor-pointer",onClick:()=>h(t),children:l||"—"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 cursor-pointer",onClick:()=>h(t),children:d||"—"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600",children:e.jsxs("button",{onClick:()=>L(t),className:"inline-flex items-center px-2 py-1 bg-white border rounded text-xs hover:bg-gray-50",children:[e.jsx(_,{className:"w-4 h-4 mr-1"})," Edit"]})})]},t.id)}),N.length===0&&!j&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-gray-500",children:"No patients found"})}),j&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-gray-500",children:"Loading…"})})]})]})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",c," of ",S," • ",p," total"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:c<=1,onClick:()=>u(t=>Math.max(1,t-1)),className:"px-2 py-1 bg-white border rounded disabled:opacity-50",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx("button",{disabled:c>=S,onClick:()=>u(t=>t+1),className:"px-2 py-1 bg-white border rounded disabled:opacity-50",children:e.jsx(q,{className:"w-4 h-4"})})]})]})]}),s&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Edit Patient"}),e.jsx("button",{onClick:()=>n(null),className:"text-gray-400 hover:text-gray-600","aria-label":"Close",children:e.jsx(z,{className:"w-5 h-5"})})]}),w&&e.jsx("div",{className:"mb-3 text-sm text-red-700",children:w}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"First Name"}),e.jsx("input",{value:s.firstName,onChange:t=>n({...s,firstName:t.target.value}),className:"w-full border rounded px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Last Name"}),e.jsx("input",{value:s.lastName,onChange:t=>n({...s,lastName:t.target.value}),className:"w-full border rounded px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"MRN"}),e.jsx("input",{value:s.mrn,onChange:t=>n({...s,mrn:t.target.value}),className:"w-full border rounded px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",value:s.dateOfBirth,onChange:t=>n({...s,dateOfBirth:t.target.value}),className:"w-full border rounded px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Sex"}),e.jsxs("select",{value:s.sex,onChange:t=>n({...s,sex:t.target.value}),className:"w-full border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"unknown",children:"Unknown"})]})]})]}),e.jsxs("div",{className:"mt-5 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>n(null),className:"px-3 py-1.5 text-sm bg-white border rounded",children:"Cancel"}),e.jsx("button",{onClick:M,disabled:v,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded disabled:opacity-50",children:v?"Saving…":"Save"})]})]})})]})};export{X as default};
//# sourceMappingURL=ServerPatients-CMuraQdK.js.map
