<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OncoSafeRx - Oncologist Test Page</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .container { background: #f9f9f9; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .success { background: #d4edda; color: #155724; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; padding: 10px; border-radius: 4px; margin: 10px 0; }
        input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .patient-list { background: white; padding: 15px; border-radius: 4px; border: 1px solid #ddd; }
        h1, h2, h3 { color: #333; }
    </style>
</head>
<body>
    <h1>üè• OncoSafeRx - Oncologist Dashboard</h1>
    <p><strong>Emergency Test Version</strong> - All functionality works with local storage</p>

    <!-- Profile Section -->
    <div class="container">
        <h2>üë©‚Äç‚öïÔ∏è Your Profile</h2>
        <div class="grid">
            <div>
                <label>First Name:</label>
                <input type="text" id="firstName" placeholder="Enter your first name">
                
                <label>Last Name:</label>
                <input type="text" id="lastName" placeholder="Enter your last name">
                
                <label>Email:</label>
                <input type="email" id="email" placeholder="your.email@hospital.com">
                
                <label>Specialty:</label>
                <select id="specialty">
                    <option value="Medical Oncology">Medical Oncology</option>
                    <option value="Surgical Oncology">Surgical Oncology</option>
                    <option value="Radiation Oncology">Radiation Oncology</option>
                    <option value="Hematology-Oncology">Hematology-Oncology</option>
                    <option value="Pediatric Oncology">Pediatric Oncology</option>
                </select>
            </div>
            <div>
                <label>Institution:</label>
                <input type="text" id="institution" placeholder="Hospital or clinic name">
                
                <label>License Number:</label>
                <input type="text" id="licenseNumber" placeholder="Medical license number">
                
                <label>Years of Experience:</label>
                <input type="number" id="yearsExperience" min="0" max="50" placeholder="Years practicing">
                
                <button onclick="saveProfile()">üíæ Save Profile</button>
                <button onclick="loadProfile()">üîÑ Load Profile</button>
            </div>
        </div>
        <div id="profileStatus"></div>
    </div>

    <!-- Patient Management Section -->
    <div class="container">
        <h2>üë• Patient Management</h2>
        <div class="grid">
            <div>
                <h3>‚ûï Add New Patient</h3>
                <label>First Name:</label>
                <input type="text" id="patientFirstName" placeholder="Patient first name">
                
                <label>Last Name:</label>
                <input type="text" id="patientLastName" placeholder="Patient last name">
                
                <label>Date of Birth:</label>
                <input type="date" id="patientDOB">
                
                <label>Sex:</label>
                <select id="patientSex">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
                
                <label>MRN:</label>
                <input type="text" id="patientMRN" placeholder="Medical record number">
                
                <label>Height (cm):</label>
                <input type="number" id="patientHeight" placeholder="170">
                
                <label>Weight (kg):</label>
                <input type="number" id="patientWeight" placeholder="70">
                
                <button onclick="addPatient()">‚ûï Add Patient</button>
                <div id="patientStatus"></div>
            </div>
            <div>
                <h3>üìã Your Patients</h3>
                <div id="patientList" class="patient-list">
                    <em>No patients added yet</em>
                </div>
                <button onclick="loadPatients()">üîÑ Refresh List</button>
                <button onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
            </div>
        </div>
    </div>

    <!-- Data Export Section -->
    <div class="container">
        <h2>üìä Data Management</h2>
        <button onclick="exportData()">üì• Export All Data</button>
        <button onclick="showStorageInfo()">üíæ Show Storage Info</button>
        <div id="dataInfo"></div>
    </div>

    <script>
        // Oncologist Profile Management
        function saveProfile() {
            const profile = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                specialty: document.getElementById('specialty').value,
                institution: document.getElementById('institution').value,
                licenseNumber: document.getElementById('licenseNumber').value,
                yearsExperience: parseInt(document.getElementById('yearsExperience').value) || 0,
                role: 'oncologist',
                savedAt: new Date().toISOString()
            };

            try {
                localStorage.setItem('oncologist_profile', JSON.stringify(profile));
                document.getElementById('profileStatus').innerHTML = 
                    '<div class="success">‚úÖ Profile saved successfully!</div>';
                console.log('Profile saved:', profile);
            } catch (error) {
                document.getElementById('profileStatus').innerHTML = 
                    '<div class="error">‚ùå Failed to save profile: ' + error.message + '</div>';
            }
        }

        function loadProfile() {
            try {
                const stored = localStorage.getItem('oncologist_profile');
                if (stored) {
                    const profile = JSON.parse(stored);
                    document.getElementById('firstName').value = profile.firstName || '';
                    document.getElementById('lastName').value = profile.lastName || '';
                    document.getElementById('email').value = profile.email || '';
                    document.getElementById('specialty').value = profile.specialty || 'Medical Oncology';
                    document.getElementById('institution').value = profile.institution || '';
                    document.getElementById('licenseNumber').value = profile.licenseNumber || '';
                    document.getElementById('yearsExperience').value = profile.yearsExperience || '';
                    
                    document.getElementById('profileStatus').innerHTML = 
                        '<div class="success">‚úÖ Profile loaded successfully!</div>';
                } else {
                    document.getElementById('profileStatus').innerHTML = 
                        '<div class="error">‚ö†Ô∏è No saved profile found</div>';
                }
            } catch (error) {
                document.getElementById('profileStatus').innerHTML = 
                    '<div class="error">‚ùå Failed to load profile: ' + error.message + '</div>';
            }
        }

        // Patient Management
        function addPatient() {
            const patient = {
                id: 'pat_' + Date.now(),
                firstName: document.getElementById('patientFirstName').value,
                lastName: document.getElementById('patientLastName').value,
                dateOfBirth: document.getElementById('patientDOB').value,
                sex: document.getElementById('patientSex').value,
                mrn: document.getElementById('patientMRN').value || 'MRN' + Date.now(),
                heightCm: parseInt(document.getElementById('patientHeight').value) || 170,
                weightKg: parseInt(document.getElementById('patientWeight').value) || 70,
                addedAt: new Date().toISOString(),
                addedBy: 'oncologist'
            };

            if (!patient.firstName || !patient.lastName) {
                document.getElementById('patientStatus').innerHTML = 
                    '<div class="error">‚ùå Please enter patient first and last name</div>';
                return;
            }

            try {
                let patients = JSON.parse(localStorage.getItem('oncologist_patients') || '[]');
                patients.push(patient);
                localStorage.setItem('oncologist_patients', JSON.stringify(patients));
                
                document.getElementById('patientStatus').innerHTML = 
                    '<div class="success">‚úÖ Patient added successfully!</div>';
                
                // Clear form
                ['patientFirstName', 'patientLastName', 'patientDOB', 'patientMRN', 'patientHeight', 'patientWeight'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                document.getElementById('patientSex').value = 'male';
                
                loadPatients(); // Refresh the list
                console.log('Patient added:', patient);
            } catch (error) {
                document.getElementById('patientStatus').innerHTML = 
                    '<div class="error">‚ùå Failed to add patient: ' + error.message + '</div>';
            }
        }

        function loadPatients() {
            try {
                const patients = JSON.parse(localStorage.getItem('oncologist_patients') || '[]');
                const listDiv = document.getElementById('patientList');
                
                if (patients.length === 0) {
                    listDiv.innerHTML = '<em>No patients added yet</em>';
                    return;
                }

                let html = '<h4>Total Patients: ' + patients.length + '</h4>';
                patients.forEach((patient, index) => {
                    const age = patient.dateOfBirth ? Math.floor((Date.now() - new Date(patient.dateOfBirth)) / (365.25 * 24 * 60 * 60 * 1000)) : 'Unknown';
                    html += `
                        <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 4px;">
                            <strong>${patient.firstName} ${patient.lastName}</strong> (${patient.sex}, age ${age})
                            <br>MRN: ${patient.mrn} | Height: ${patient.heightCm}cm | Weight: ${patient.weightKg}kg
                            <br><small>Added: ${new Date(patient.addedAt).toLocaleDateString()}</small>
                            <button onclick="removePatient(${index})" style="float: right; background: #dc3545;">üóëÔ∏è Remove</button>
                        </div>
                    `;
                });
                listDiv.innerHTML = html;
            } catch (error) {
                document.getElementById('patientList').innerHTML = 
                    '<div class="error">‚ùå Failed to load patients: ' + error.message + '</div>';
            }
        }

        function removePatient(index) {
            if (confirm('Are you sure you want to remove this patient?')) {
                try {
                    let patients = JSON.parse(localStorage.getItem('oncologist_patients') || '[]');
                    patients.splice(index, 1);
                    localStorage.setItem('oncologist_patients', JSON.stringify(patients));
                    loadPatients();
                } catch (error) {
                    alert('Failed to remove patient: ' + error.message);
                }
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data? This cannot be undone.')) {
                localStorage.removeItem('oncologist_profile');
                localStorage.removeItem('oncologist_patients');
                document.getElementById('profileStatus').innerHTML = '<div class="success">‚úÖ All data cleared</div>';
                document.getElementById('patientStatus').innerHTML = '<div class="success">‚úÖ All data cleared</div>';
                loadPatients();
                // Clear form fields
                document.querySelectorAll('input').forEach(input => input.value = '');
                document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
            }
        }

        function exportData() {
            try {
                const profile = JSON.parse(localStorage.getItem('oncologist_profile') || '{}');
                const patients = JSON.parse(localStorage.getItem('oncologist_patients') || '[]');
                
                const exportData = {
                    exportDate: new Date().toISOString(),
                    profile: profile,
                    patients: patients,
                    totalPatients: patients.length
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = 'oncosaferx_data_' + new Date().toISOString().split('T')[0] + '.json';
                link.click();
                
                document.getElementById('dataInfo').innerHTML = 
                    '<div class="success">‚úÖ Data exported successfully!</div>';
            } catch (error) {
                document.getElementById('dataInfo').innerHTML = 
                    '<div class="error">‚ùå Export failed: ' + error.message + '</div>';
            }
        }

        function showStorageInfo() {
            try {
                const profile = localStorage.getItem('oncologist_profile');
                const patients = localStorage.getItem('oncologist_patients');
                
                const info = `
                    <h4>Storage Information:</h4>
                    <p><strong>Profile:</strong> ${profile ? 'Saved (' + Math.round(profile.length/1024) + ' KB)' : 'Not saved'}</p>
                    <p><strong>Patients:</strong> ${patients ? JSON.parse(patients).length + ' patients (' + Math.round(patients.length/1024) + ' KB)' : 'No patients'}</p>
                    <p><strong>Total Storage:</strong> ${Math.round(((profile?.length || 0) + (patients?.length || 0))/1024)} KB</p>
                `;
                document.getElementById('dataInfo').innerHTML = info;
            } catch (error) {
                document.getElementById('dataInfo').innerHTML = 
                    '<div class="error">‚ùå Failed to get storage info: ' + error.message + '</div>';
            }
        }

        // Auto-load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProfile();
            loadPatients();
            console.log('OncoSafeRx Test Page Loaded');
        });
    </script>
</body>
</html>