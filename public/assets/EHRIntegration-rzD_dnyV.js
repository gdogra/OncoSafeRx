import{q as K,r as x,j as e,e as w,I as R,A as _,S as $,U as T,F as G,h as J}from"./index-Bhw970Mt.js";import{C as f}from"./Card-xxJ0N2iO.js";import{A as S}from"./Alert-Ce4CVrwB.js";import{L as k}from"./LoadingSpinner-DmXCsUX4.js";import{D as U}from"./database-DVBy81T8.js";import{W as X}from"./wifi-BvwRqpkY.js";import{W as Y}from"./wifi-off-O4ORr-sx.js";import{R as Z}from"./refresh-cw-CEIIBFss.js";import{D}from"./download-BdaDgNV1.js";import{U as H}from"./upload-BEArSWBQ.js";import{C as O}from"./circle-check-big-BS3hXAhd.js";import{C as ee}from"./circle-x-pntuk0KV.js";import{L as te}from"./link-CaIml41H.js";var L={};class N{constructor(){this.baseUrl=L.REACT_APP_FHIR_BASE_URL||"https://hapi.fhir.org/baseR4",this.headers={"Content-Type":"application/fhir+json",Accept:"application/fhir+json"};const t=L.REACT_APP_FHIR_AUTH_TOKEN;t&&(this.headers.Authorization=`Bearer ${t}`)}static getInstance(){return N.instance||(N.instance=new N),N.instance}async searchPatients(t){const a=new URLSearchParams;t.name&&a.append("name",t.name),t.identifier&&a.append("identifier",t.identifier),t.birthdate&&a.append("birthdate",t.birthdate),t.gender&&a.append("gender",t.gender),a.append("_count",(t.limit||10).toString());const r=await fetch(`${this.baseUrl}/Patient?${a}`,{headers:this.headers});if(!r.ok)throw new Error(`FHIR Patient search failed: ${r.statusText}`);return r.json()}async getPatientWithResources(t){try{const a=await fetch(`${this.baseUrl}/Patient/${t}`,{headers:this.headers});if(!a.ok)throw new Error(`Failed to fetch patient: ${a.statusText}`);const r=await a.json(),[l,g,m,y]=await Promise.all([this.getObservations(t),this.getMedicationRequests(t),this.getAllergyIntolerances(t),this.getConditions(t)]);return{patient:r,observations:l.entry?.map(c=>c.resource)||[],medications:g.entry?.map(c=>c.resource)||[],allergies:m.entry?.map(c=>c.resource)||[],conditions:y.entry?.map(c=>c.resource)||[]}}catch(a){throw console.error("Failed to fetch patient with resources:",a),a}}async getObservations(t,a){const r=new URLSearchParams({patient:t,_sort:"-date",_count:"100"});a&&r.append("category",a);const l=await fetch(`${this.baseUrl}/Observation?${r}`,{headers:this.headers});if(!l.ok)throw new Error(`Failed to fetch observations: ${l.statusText}`);return l.json()}async getMedicationRequests(t){const a=new URLSearchParams({patient:t,status:"active",_sort:"-authoredon",_count:"50"}),r=await fetch(`${this.baseUrl}/MedicationRequest?${a}`,{headers:this.headers});if(!r.ok)throw new Error(`Failed to fetch medication requests: ${r.statusText}`);return r.json()}async getAllergyIntolerances(t){const a=new URLSearchParams({patient:t,_count:"50"}),r=await fetch(`${this.baseUrl}/AllergyIntolerance?${a}`,{headers:this.headers});if(!r.ok)throw new Error(`Failed to fetch allergies: ${r.statusText}`);return r.json()}async getConditions(t){const a=new URLSearchParams({patient:t,_count:"50"}),r=await fetch(`${this.baseUrl}/Condition?${a}`,{headers:this.headers});if(!r.ok)throw new Error(`Failed to fetch conditions: ${r.statusText}`);return r.json()}convertFHIRPatientToProfile(t,a=[],r=[],l=[],g=[]){const m=t.name?.[0],y=t.telecom||[],c=t.address?.[0],I={firstName:m?.given?.[0]||"",lastName:m?.family||"",dateOfBirth:t.birthDate||"",sex:t.gender==="male"?"male":t.gender==="female"?"female":"other",mrn:t.identifier?.find(s=>s.type?.coding?.[0]?.code==="MR")?.value,contact:{phone:y.find(s=>s.system==="phone")?.value,email:y.find(s=>s.system==="email")?.value,address:c?.text||[c?.line?.join(" "),c?.city,c?.state].filter(Boolean).join(", ")}},C=a.filter(s=>s.valueQuantity?.value!==void 0).map(s=>({timestamp:s.effectiveDateTime||new Date().toISOString(),labType:s.code.text||s.code.coding?.[0]?.display||"Unknown",value:s.valueQuantity.value,unit:s.valueQuantity.unit||"",referenceRange:s.referenceRange?.[0]?`${s.referenceRange[0].low?.value||""}-${s.referenceRange[0].high?.value||""}`:void 0,isAbnormal:s.interpretation?.some(o=>o.coding?.some(h=>["H","L","A"].includes(h.code||""))),criticalFlag:s.interpretation?.some(o=>o.coding?.some(h=>["HH","LL","AA"].includes(h.code||"")))})),E=r.map((s,o)=>({id:s.id||`med-${o}`,drug:{rxcui:"unknown",name:s.medicationCodeableConcept?.text||s.medicationCodeableConcept?.coding?.[0]?.display||"Unknown medication",generic_name:s.medicationCodeableConcept?.coding?.[0]?.display},dosage:s.dosageInstruction?.[0]?.doseAndRate?.[0]?.doseQuantity?.value?.toString()||"Unknown",frequency:s.dosageInstruction?.[0]?.text||"Unknown",route:s.dosageInstruction?.[0]?.route?.text||"Unknown",startDate:s.authoredOn||new Date().toISOString(),indication:"From EHR",isActive:s.status==="active"})),j=l.map((s,o)=>({id:s.id||`allergy-${o}`,allergen:s.code?.text||s.code?.coding?.[0]?.display||"Unknown allergen",allergenType:s.category?.[0]==="medication"?"drug":s.category?.[0]==="food"?"food":s.category?.[0]==="environment"?"environmental":"other",reaction:s.reaction?.[0]?.manifestation?.[0]?.text||s.reaction?.[0]?.manifestation?.[0]?.coding?.[0]?.display||"Unknown reaction",severity:s.reaction?.[0]?.severity==="severe"?"severe":s.reaction?.[0]?.severity==="moderate"?"moderate":"mild",dateReported:s.recordedDate||new Date().toISOString(),verified:s.verificationStatus?.coding?.[0]?.code==="confirmed"})),v=g.map((s,o)=>({id:s.id||`condition-${o}`,condition:s.code?.text||s.code?.coding?.[0]?.display||"Unknown condition",icd10Code:s.code?.coding?.find(h=>h.system?.includes("icd-10"))?.code,status:s.clinicalStatus?.coding?.[0]?.code==="active"?"active":s.clinicalStatus?.coding?.[0]?.code==="resolved"?"resolved":"inactive",dateOfOnset:s.onsetDateTime||s.onsetPeriod?.start||new Date().toISOString(),dateResolved:s.abatementDateTime}));return{id:t.id||`fhir-patient-${Date.now()}`,demographics:I,allergies:j,medications:E,conditions:v,labValues:C,genetics:[],vitals:[],treatmentHistory:[],notes:[{id:"fhir-import",timestamp:new Date().toISOString(),author:"FHIR Import",type:"clinical",content:`Patient data imported from FHIR server: ${t.identifier?.length||0} identifiers, ${a.length} observations, ${r.length} medications, ${l.length} allergies, ${g.length} conditions`}],preferences:{},lastUpdated:new Date().toISOString(),createdBy:"FHIR Import Service",isActive:t.active!==!1}}async createPatient(t){const a=this.convertProfileToFHIRPatient(t),r=await fetch(`${this.baseUrl}/Patient`,{method:"POST",headers:this.headers,body:JSON.stringify(a)});if(!r.ok)throw new Error(`Failed to create FHIR patient: ${r.statusText}`);return r.json()}convertProfileToFHIRPatient(t){return{resourceType:"Patient",identifier:t.demographics.mrn?[{use:"usual",type:{coding:[{system:"http://terminology.hl7.org/CodeSystem/v2-0203",code:"MR",display:"Medical Record Number"}]},value:t.demographics.mrn}]:void 0,active:t.isActive,name:[{use:"official",family:t.demographics.lastName,given:[t.demographics.firstName]}],telecom:[t.demographics.contact?.phone?{system:"phone",value:t.demographics.contact.phone,use:"home"}:null,t.demographics.contact?.email?{system:"email",value:t.demographics.contact.email}:null].filter(Boolean),gender:t.demographics.sex==="male"?"male":t.demographics.sex==="female"?"female":"other",birthDate:t.demographics.dateOfBirth}}async validateConnection(){try{const t=await fetch(`${this.baseUrl}/metadata`,{headers:{Accept:"application/fhir+json"}});return t.ok?{connected:!0,version:(await t.json()).fhirVersion||"Unknown"}:{connected:!1,error:`HTTP ${t.status}: ${t.statusText}`}}catch(t){return{connected:!1,error:t instanceof Error?t.message:"Unknown error"}}}}const P=N.getInstance();var B={};const ge=()=>{const{state:d,actions:t}=K(),[a,r]=x.useState(null),[l,g]=x.useState({}),[m,y]=x.useState(""),[c,I]=x.useState([]),[C,E]=x.useState(!1),[j,v]=x.useState(!1),[s,o]=x.useState(null),[h,p]=x.useState(null),[b,M]=x.useState("search");x.useEffect(()=>{A()},[]);const A=async()=>{try{const n=await P.validateConnection();r(n.connected),g(n)}catch{r(!1),g({error:"Failed to check connection"})}},F=async()=>{if(m.trim()){E(!0),o(null);try{const i=(await P.searchPatients({name:m,limit:10})).entry?.map(u=>u.resource)||[];I(i),i.length===0&&o(`No patients found matching "${m}"`)}catch(n){o(n instanceof Error?n.message:"Search failed"),I([])}finally{E(!1)}}},q=async n=>{if(!n.id){p({success:!1,message:"Invalid patient ID"});return}v(!0),p(null);try{const i=await P.getPatientWithResources(n.id),u=P.convertFHIRPatientToProfile(i.patient,i.observations,i.medications,i.allergies,i.conditions);t.setCurrentPatient(u),p({success:!0,message:`Successfully imported patient: ${u.demographics.firstName} ${u.demographics.lastName}`}),setTimeout(()=>p(null),5e3)}catch(i){p({success:!1,message:i instanceof Error?i.message:"Import failed"})}finally{v(!1)}},Q=async()=>{if(!d.currentPatient){p({success:!1,message:"No patient selected for export"});return}v(!0),p(null);try{const n=await P.createPatient(d.currentPatient);p({success:!0,message:`Patient exported to EHR system with ID: ${n.id}`})}catch(n){p({success:!1,message:n instanceof Error?n.message:"Export failed"})}finally{v(!1)}},W=n=>{const i=n.name?.[0];return i?`${i.given?.join(" ")||""} ${i.family||""}`.trim():"Unknown Name"},V=n=>n.identifier?.find(u=>u.type?.coding?.[0]?.code==="MR")?.value||n.id||"No ID",z=[{id:"search",label:"Search Patients",icon:$},{id:"import",label:"Import Data",icon:D},{id:"export",label:"Export Data",icon:H},{id:"settings",label:"Connection",icon:U}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[e.jsx(U,{className:"w-8 h-8 text-primary-600"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"EHR Integration"}),e.jsx(w,{content:"Connect to Electronic Health Record systems using FHIR R4 standard for seamless patient data exchange",children:e.jsx(R,{className:"w-5 h-5 text-gray-400"})})]}),e.jsx("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:"Import patient data from Electronic Health Record systems, export OncoSafeRx data, and maintain seamless clinical workflows."})]}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[a===null?e.jsx(_,{className:"w-6 h-6 text-gray-400 animate-pulse"}):a?e.jsx(X,{className:"w-6 h-6 text-green-600"}):e.jsx(Y,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"FHIR Server Connection"}),e.jsx("p",{className:"text-sm text-gray-600",children:a===null?"Checking connection...":a?`Connected • FHIR ${l.version||"R4"}`:`Disconnected • ${l.error}`})]})]}),e.jsxs("button",{onClick:A,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Refresh"})]})]})}),h&&e.jsx(S,{type:h.success?"success":"error",title:h.success?"Success":"Error",children:h.message}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:z.map(n=>{const i=n.icon;return e.jsxs("button",{onClick:()=>M(n.id),className:`group inline-flex items-center space-x-2 py-4 px-6 border-b-2 font-medium text-sm ${b===n.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{children:n.label})]},n.id)})})}),e.jsxs("div",{className:"p-6",children:[b==="search"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx($,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Search EHR Patients"}),e.jsx(w,{content:"Search for patients in the connected EHR system by name or identifier",children:e.jsx(R,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("input",{type:"text",value:m,onChange:n=>y(n.target.value),onKeyPress:n=>n.key==="Enter"&&F(),placeholder:"Enter patient name...",disabled:!a,className:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100"}),e.jsx("button",{onClick:F,disabled:!a||C||!m.trim(),className:"flex items-center space-x-2 px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:C?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"sm"}),e.jsx("span",{children:"Searching..."})]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Search"})]})})]})]}),s&&e.jsx(S,{type:"error",title:"Search Error",children:s}),c.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3",children:["Search Results (",c.length,")"]}),e.jsx("div",{className:"space-y-3",children:c.map((n,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:W(n)}),e.jsxs("div",{className:"text-sm text-gray-600",children:["ID: ",V(n)," • DOB: ",n.birthDate||"Unknown"," • Gender: ",n.gender||"Unknown"]})]})]}),e.jsxs("button",{onClick:()=>q(n),disabled:j,className:"flex items-center space-x-2 px-3 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 disabled:opacity-50",children:[j?e.jsx(k,{size:"sm"}):e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:"Import"})]})]},n.id||i))})]})]}),b==="import"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(D,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import Patient Data"}),e.jsx(w,{content:"Import comprehensive patient data including demographics, medications, allergies, conditions, and lab results",children:e.jsx(R,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx(f,{children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(T,{className:"w-12 h-12 mx-auto mb-4 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Demographics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Basic patient information, contact details, and identifiers"})]})}),e.jsx(f,{children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 text-green-600"}),e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Clinical Data"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Medications, allergies, conditions, and treatment history"})]})}),e.jsx(f,{children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-4 text-purple-600"}),e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Lab Results"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Laboratory values, vital signs, and diagnostic results"})]})})]}),e.jsx(S,{type:"info",title:"Data Import Process",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"Search for patients using the Search tab"}),e.jsx("li",{children:"Select a patient to import their complete clinical record"}),e.jsx("li",{children:"Data is automatically converted to OncoSafeRx format"}),e.jsx("li",{children:"Safety alerts are generated based on imported data"})]})})]}),b==="export"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(H,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Export Patient Data"}),e.jsx(w,{content:"Export OncoSafeRx patient data to EHR systems in FHIR format",children:e.jsx(R,{className:"w-4 h-4 text-gray-400"})})]}),d.currentPatient?e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"w-6 h-6 text-primary-600"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:[d.currentPatient.demographics.firstName," ",d.currentPatient.demographics.lastName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["MRN: ",d.currentPatient.demographics.mrn||"Not assigned"," • Last updated: ",new Date(d.currentPatient.lastUpdated).toLocaleDateString()]})]})]}),e.jsxs("button",{onClick:Q,disabled:!a||j,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 disabled:opacity-50",children:[j?e.jsx(k,{size:"sm"}):e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:"Export to EHR"})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"font-medium text-gray-900",children:d.currentPatient.allergies.length}),e.jsx("div",{className:"text-gray-600",children:"Allergies"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"font-medium text-gray-900",children:d.currentPatient.medications.filter(n=>n.isActive).length}),e.jsx("div",{className:"text-gray-600",children:"Active Medications"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"font-medium text-gray-900",children:d.currentPatient.conditions.length}),e.jsx("div",{className:"text-gray-600",children:"Conditions"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"font-medium text-gray-900",children:d.currentPatient.labValues.length}),e.jsx("div",{className:"text-gray-600",children:"Lab Values"})]})]})]}):e.jsx(S,{type:"info",title:"No Patient Selected",children:"Select a patient from the Patients tab to export their data to the EHR system."})]}),b==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Connection Settings"}),e.jsx(w,{content:"Configure FHIR server connection and authentication settings",children:e.jsx(R,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(f,{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Server Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Endpoint:"}),e.jsx("span",{className:"font-mono",children:B.REACT_APP_FHIR_BASE_URL||"https://hapi.fhir.org/baseR4"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Version:"}),e.jsx("span",{children:l.version||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsxs("span",{className:`inline-flex items-center space-x-1 ${a?"text-green-600":"text-red-600"}`,children:[a?e.jsx(O,{className:"w-3 h-3"}):e.jsx(ee,{className:"w-3 h-3"}),e.jsx("span",{children:a?"Connected":"Disconnected"})]})]})]})]}),e.jsxs(f,{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Security"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(te,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"HTTPS Encryption: Enabled"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(O,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"FHIR R4 Compliance: Yes"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(J,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("span",{className:"text-gray-600",children:["Token Auth: ",B.REACT_APP_FHIR_AUTH_TOKEN?"Configured":"Not configured"]})]})]})]})]}),e.jsx(S,{type:"warning",title:"Configuration Note",children:"EHR integration requires proper FHIR server configuration and authentication. Contact your system administrator to configure connection settings via environment variables."})]})]})]})]})};export{ge as default};
//# sourceMappingURL=EHRIntegration-rzD_dnyV.js.map
