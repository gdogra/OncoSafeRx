{"version":3,"mappings":"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","names":["__iconNode","LoaderCircle","createLucideIcon","KEY","getPins","raw","isPinned","rxcui","togglePin","name","pins","clearPins","reorderPins","order","current","next","ts","entry","v","DrugCard","drug","onClick","showDetails","showTooltips","className","navigate","useNavigate","selection","useSelection","handleClick","getSeverityColor","tty","formatTty","getDrugInfoTooltip","jsxs","jsx","getTtyTooltip","explanations","getClinicalSafetyTooltip","pinned","Card","Pill","Tooltip","Star","Tag","AlertTriangle","ChevronRight","analytics","Activity","Dna","m","inferBiomarkerForDrug","MapPinned","Share2","calculateRelevanceScore","query","lowerQuery","lowerName","similarity","calculateSimilarity","str1","str2","longer","shorter","distance","levenshteinDistance","matrix","i","j","cost","DrugSearchResults","results","loading","error","onDrugSelect","filters","popularity","categorizedResults","useMemo","categories","popularDrugs","oncologyDrugs","ttyOk","isOncologyApprox","n","oncoOk","isPopular","popular","isOncology","onco","enhancedDrug","key","a","b","flatList","highlighted","setHighlighted","useState","containerRef","useRef","useEffect","move","delta","prev","handleKeyDown","e","d","t","_","index","Alert","TrendingUp","Database","Globe","category","drugs","getCategoryIcon","cat","Filter","getCategoryTooltip","r","dr","getCategoryColor","Clock","EnhancedDrugResults","onCompare","viewMode","sortBy","filterBy","onPin","onAddToInteractions","selectedDrugs","setSelectedDrugs","currentViewMode","setCurrentViewMode","currentSortBy","setCurrentSortBy","showFilters","setShowFilters","expandedCards","setExpandedCards","handleDrugToggle","drugId","id","handleCardExpand","sortedAndFilteredDrugs","result","getEvidenceBadge","level","variants","getCostBadge","tier","defaultPin","list","defaultAddToInteractions","renderDrugCard","isExpanded","CheckCircle","Target","DollarSign","Bookmark","Plus","indication","idx","Shield","biomarker","benefit","risk","req","ChevronUp","ChevronDown","Eye","Grid","List","BarChart3","Download","LOCAL","SolidDrugSearch","placeholder","value","onChange","onSelect","maxResults","onOfflineChange","onAutoResolve","open","setOpen","setLoading","offline","setOffline","options","setOptions","highlight","setHighlight","rootRef","inputRef","lastAutoFor","onDocDown","abort","q","resp","data","opts","s","val","exact","o","only","lc","fallback","onKeyDown","h","commit","opt","displayOptions","THERAPEUTIC_CLASS_OPTIONS","MECHANISM_OPTIONS","INDICATION_OPTIONS","BIOMARKER_OPTIONS","APPROVAL_STATUS_OPTIONS","CLINICAL_TRIAL_PHASE_OPTIONS","FilterAutocomplete","selectedValues","onSelectionChange","label","maxSelection","searchable","showCounts","isOpen","setIsOpen","searchTerm","setSearchTerm","filteredOptions","setFilteredOptions","searchInputRef","filtered","option","sorted","handleClickOutside","event","handleOptionToggle","isSelected","newValues","removeValue","clearAll","X","Search","Check","ImprovedDrugSearch","setFilters","searchSuggestions","setSearchSuggestions","recommendations","setRecommendations","isLoading","setIsLoading","showAdvancedFilters","setShowAdvancedFilters","aiMode","setAiMode","activeTab","setActiveTab","serverSuggestions","setServerSuggestions","serverSuggestionsOffline","setServerSuggestionsOffline","serverSuggestionsLoading","setServerSuggestionsLoading","searchLoading","setSearchLoading","searchError","setSearchError","searchResults","setSearchResults","pinnedOnly","setPinnedOnly","selectedRxcui","setSelectedRxcui","setVariants","variantError","setVariantError","variantLoading","setVariantLoading","details","setDetails","detailsLoading","setDetailsLoading","detailsError","setDetailsError","interactionSummary","setInteractionSummary","interactionLoading","setInteractionLoading","interactionError","setInteractionError","generateAISuggestions","term","timer","suggestions","handleFilterChange","runSearch","stored","external","all","sev","major","moderate","minor","clearAllFilters","getActiveFiltersCount","count","renderEnhancedFilter","title","icon","values","TabButton","isActive","children","Brain","Sparkles","suggestion","Zap","mode","Icon","Heart","Microscope","Users","err","COMPREHENSIVE_OPTIONS","AutocompleteSearch","onInputChange","showCategories","allowMultiple","selectedOptions","disabled","inputValue","setInputValue","highlightedIndex","setHighlightedIndex","recentSearches","setRecentSearches","serverOptions","setServerOptions","serverOffline","setServerOffline","listRef","saved","isOffline","fuzzyMatch","text","search","cleanSearch","word","charIndex","char","foundIndex","matches","lastIndex","alias","labelMatch","valueMatch","aliasMatch","score","combined","handleInputChange","newValue","handleOptionSelect","updated","getOptionIcon","type","removeSelectedOption","optionId","Loader2","useUrlState","location","useLocation","defaultValue","serialize","defaultSerialize","deserialize","defaultDeserialize","replace","getInitialValue","useCallback","urlValue","state","setState","updateUrl","searchParams","serialized","newSearch","newUrl","updateState","prevState","useUrlFilters","defaultFilters","getFiltersFromUrl","newFilters","updateFilters","prevFilters","updates","updatedFilters","clearFilters","useUrlPagination","defaultPage","defaultPageSize","page","setPage","pageSize","setPageSize","resetPagination","useUrlSort","defaultSort","defaultDirection","setSortBy","sortDirection","setSortDirection","updateSort","field","direction","useLocalStorage","initialValue","syncAcrossTabs","storedValue","setStoredValue","item","setValue","valueToStore","handleStorageChange","useUserPreferences","defaultPreferences","storageKey","preferences","setPreferences","clearPreferences","updatePreference","updatePreferences","resetPreferences","useRecentSearches","maxItems","searches","setSearches","addSearch","trimmedSearch","removeSearch","clearSearches","DrugSearchInner","searchQuery","setSearchQuery","selectedDrug","setSelectedDrug","setError","pinsTick","setPinsTick","searchMode","setSearchMode","aiInsights","setAiInsights","drugAnalytics","setDrugAnalytics","recentInteractions","setRecentInteractions","rxnormOfflineToast","setRxnormOfflineToast","rxnormToastDismissed","setRxnormToastDismissed","connStatus","setConnStatus","connTesting","setConnTesting","connCheckedAt","setConnCheckedAt","basicSuggestions","setBasicSuggestions","basicSuggestionsOffline","setBasicSuggestionsOffline","basicSuggestionsLoading","setBasicSuggestionsLoading","dismissed","testConnectivity","isOnline","activeTtySet","pinnedList","handleSearch","drugService","filteredResults","finalResults","handleDrugSelect","handleBackToResults","handler","el","History","Info","p","dragged","x","from","to","oncoNames","isOnco","DrugSearch","FeatureErrorBoundary"],"ignoreList":[0],"sources":["../../node_modules/lucide-react/dist/esm/icons/loader-circle.js","../../src/utils/pins.ts","../../src/components/DrugSearch/DrugCard.tsx","../../src/components/DrugSearch/DrugSearchResults.tsx","../../src/components/DrugSearch/EnhancedDrugResults.tsx","../../src/components/DrugSearch/SolidDrugSearch.tsx","../../src/components/DrugSearch/FilterAutocomplete.tsx","../../src/components/DrugSearch/ImprovedDrugSearch.tsx","../../src/components/DrugSearch/AutocompleteSearch.tsx","../../src/hooks/useUrlState.ts","../../src/hooks/useLocalStorage.ts","../../src/pages/DrugSearch.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.544.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"M21 12a9 9 0 1 1-6.219-8.56\", key: \"13zald\" }]];\nconst LoaderCircle = createLucideIcon(\"loader-circle\", __iconNode);\n\nexport { __iconNode, LoaderCircle as default };\n//# sourceMappingURL=loader-circle.js.map\n","const KEY = 'oncosaferx_pins';\n\nexport type PinMap = Record<string, { name: string; t: number }>;\n\nexport function getPins(): PinMap {\n  try {\n    const raw = localStorage.getItem(KEY);\n    return raw ? JSON.parse(raw) : {};\n  } catch {\n    return {};\n  }\n}\n\nexport function isPinned(rxcui?: string): boolean {\n  if (!rxcui) return false;\n  const pins = getPins();\n  return !!pins[rxcui];\n}\n\nexport function togglePin(rxcui: string, name: string): PinMap {\n  const pins = getPins();\n  if (pins[rxcui]) delete pins[rxcui];\n  else pins[rxcui] = { name, t: Date.now() };\n  try { localStorage.setItem(KEY, JSON.stringify(pins)); } catch {}\n  return pins;\n}\n\nexport function clearPins() {\n  try { localStorage.removeItem(KEY); } catch {}\n}\n\nexport function reorderPins(order: string[]) {\n  const current = getPins();\n  const next: PinMap = {};\n  // Rebuild object in provided order to preserve insertion order\n  let ts = Date.now();\n  for (const rxcui of order) {\n    const entry = current[rxcui];\n    if (entry) {\n      next[rxcui] = { name: entry.name, t: ts-- };\n    }\n  }\n  // Append any missing (new) pins at the end in their current order\n  Object.entries(current).forEach(([rxcui, v]) => {\n    if (!next[rxcui]) next[rxcui] = v;\n  });\n  try { localStorage.setItem(KEY, JSON.stringify(next)); } catch {}\n}\n","import React from 'react';\nimport { Drug } from '../../types';\nimport { Pill, ChevronRight, Tag, AlertTriangle, Share2, Activity, Dna, MapPinned, Star } from 'lucide-react';\nimport Card from '../UI/Card';\nimport Tooltip from '../UI/Tooltip';\nimport { useNavigate } from 'react-router-dom';\nimport { useSelection } from '../../context/SelectionContext';\nimport { analytics } from '../../utils/analytics';\nimport { inferBiomarkerForDrug } from '../../utils/biomarkers';\nimport { isPinned, togglePin } from '../../utils/pins';\n\ninterface DrugCardProps {\n  drug: Drug;\n  onClick?: (drug: Drug) => void;\n  showDetails?: boolean;\n  showTooltips?: boolean;\n  className?: string;\n}\n\nconst DrugCard: React.FC<DrugCardProps> = ({ drug, onClick, showDetails = false, showTooltips = true, className = '' }) => {\n  const navigate = useNavigate();\n  const selection = useSelection();\n\n  const handleClick = () => {\n    onClick?.(drug);\n  };\n\n  const getSeverityColor = (tty?: string) => {\n    if (!tty) return 'bg-gray-100 text-gray-700';\n    \n    switch (tty.toLowerCase()) {\n      case 'scd':\n      case 'sbd':\n        return 'bg-primary-100 text-primary-700';\n      case 'gpck':\n      case 'bpck':\n        return 'bg-warning-100 text-warning-700';\n      default:\n        return 'bg-gray-100 text-gray-700';\n    }\n  };\n\n  const formatTty = (tty?: string) => {\n    if (!tty) return 'Unknown';\n    \n    const ttyMap: Record<string, string> = {\n      'SCD': 'Clinical Drug',\n      'SBD': 'Branded Drug',\n      'GPCK': 'Generic Pack',\n      'BPCK': 'Branded Pack',\n    };\n    \n    return ttyMap[tty.toUpperCase()] || tty;\n  };\n\n  // Get drug information tooltip\n  const getDrugInfoTooltip = () => (\n    <div className=\"space-y-2 text-xs\">\n      <div className=\"font-semibold\">Drug Information:</div>\n      <div>Name: {drug.name}</div>\n      <div>RXCUI: {drug.rxcui}</div>\n      {drug.tty && <div>Type: {formatTty(drug.tty)}</div>}\n      {drug.generic_name && <div>Generic: {drug.generic_name}</div>}\n      {drug.therapeutic_class && <div>Class: {drug.therapeutic_class}</div>}\n      <div className=\"mt-2 pt-2 border-t border-gray-200\">\n        <div className=\"text-gray-300\">{onClick ? 'Click for more details' : 'Drug details'}</div>\n      </div>\n    </div>\n  );\n\n  // Get TTY explanation tooltip\n  const getTtyTooltip = (tty?: string) => {\n    const explanations: Record<string, string> = {\n      'SCD': 'Semantic Clinical Drug - A clinical drug with specific ingredient(s), strength(s), and dose form',\n      'SBD': 'Semantic Branded Drug - A branded drug with specific ingredient(s), strength(s), and dose form',\n      'GPCK': 'Generic Pack - A collection of generic drugs in a package',\n      'BPCK': 'Branded Pack - A collection of branded drugs in a package',\n    };\n\n    if (!tty) return 'Drug type classification from RxNorm terminology';\n    \n    return explanations[tty.toUpperCase()] || `${tty} - Drug type classification`;\n  };\n\n  // Get clinical safety tooltip\n  const getClinicalSafetyTooltip = () => (\n    <div className=\"space-y-2 text-xs\">\n      <div className=\"font-semibold text-amber-200\">Clinical Safety:</div>\n      <ul className=\"space-y-1 list-disc list-inside\">\n        <li>Always verify drug name and strength</li>\n        <li>Check for patient allergies</li>\n        <li>Review contraindications</li>\n        <li>Consider drug interactions</li>\n      </ul>\n      <div className=\"mt-2 pt-2 border-t border-amber-200\">\n        <div className=\"text-amber-200\">Consult clinical guidelines and patient-specific factors</div>\n      </div>\n    </div>\n  );\n\n  const pinned = isPinned(drug.rxcui);\n\n  return (\n    <Card \n      className={`transition-all duration-200 ${\n        onClick \n          ? 'cursor-pointer hover:shadow-md hover:border-primary-300' \n          : ''\n      } ${className}`}\n      padding=\"md\"\n    >\n      <div className=\"flex items-start justify-between\" onClick={onClick ? handleClick : undefined}>\n        <div className=\"flex items-start space-x-3 flex-1\">\n          <div className=\"flex-shrink-0\">\n            <div className=\"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center\">\n              <Pill className=\"w-5 h-5 text-primary-600\" />\n            </div>\n          </div>\n          \n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center space-x-2\">\n              <h3 className=\"text-lg font-semibold text-gray-900 truncate\">\n                {drug.name}\n              </h3>\n              {pinned && (\n                <Tooltip content=\"Pinned\">\n                  <span className=\"inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] font-medium bg-yellow-100 text-yellow-800 border border-yellow-200\">\n                    <Star className=\"w-3 h-3 mr-1\" /> Pinned\n                  </span>\n                </Tooltip>\n              )}\n              {showTooltips && (\n                <Tooltip\n                  content={getDrugInfoTooltip()}\n                  type=\"info\"\n                  iconOnly\n                  position=\"top\"\n                  maxWidth=\"max-w-xs\"\n                />\n              )}\n            </div>\n            \n            {drug.synonym && drug.synonym !== drug.name && (\n              <p className=\"text-sm text-gray-600 mt-1\">\n                Also known as: {drug.synonym}\n              </p>\n            )}\n            \n            <div className=\"flex items-center space-x-4 mt-2\">\n              <div className=\"flex items-center space-x-1\">\n                <Tag className=\"w-3 h-3 text-gray-400\" />\n                <span className=\"text-xs text-gray-500\">RXCUI: {drug.rxcui}</span>\n                {showTooltips && (\n                  <Tooltip\n                    content=\"RxNorm Concept Unique Identifier - A unique identifier for this medication in the RxNorm database\"\n                    type=\"help\"\n                    iconOnly\n                    position=\"top\"\n                    maxWidth=\"max-w-xs\"\n                  />\n                )}\n              </div>\n              \n              {drug.tty && (\n                <Tooltip\n                  content={getTtyTooltip(drug.tty)}\n                  type=\"help\"\n                  disabled={!showTooltips}\n                  maxWidth=\"max-w-sm\"\n                >\n                  <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getSeverityColor(drug.tty)}`}>\n                    {formatTty(drug.tty)}\n                  </span>\n                </Tooltip>\n              )}\n              \n              {showTooltips && (\n                <Tooltip\n                  content={getClinicalSafetyTooltip()}\n                  type=\"warning\"\n                  iconOnly\n                  position=\"top\"\n                  maxWidth=\"max-w-xs\"\n                >\n                  <AlertTriangle className=\"w-4 h-4 text-amber-500\" />\n                </Tooltip>\n              )}\n            </div>\n\n            {showDetails && (\n              <div className=\"mt-3 space-y-2\">\n                {drug.generic_name && drug.generic_name !== drug.name && (\n                  <div>\n                    <span className=\"text-sm font-medium text-gray-700\">Generic: </span>\n                    <span className=\"text-sm text-gray-600\">{drug.generic_name}</span>\n                  </div>\n                )}\n                \n                {drug.therapeutic_class && (\n                  <div>\n                    <span className=\"text-sm font-medium text-gray-700\">Class: </span>\n                    <span className=\"text-sm text-gray-600\">{drug.therapeutic_class}</span>\n                  </div>\n                )}\n                \n                {drug.indication && (\n                  <div>\n                    <span className=\"text-sm font-medium text-gray-700\">Indication: </span>\n                    <span className=\"text-sm text-gray-600\">{drug.indication}</span>\n                  </div>\n                )}\n\n                {drug.brand_names && drug.brand_names.length > 0 && (\n                  <div>\n                    <span className=\"text-sm font-medium text-gray-700\">Brand Names: </span>\n                    <span className=\"text-sm text-gray-600\">{drug.brand_names.join(', ')}</span>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n        \n        {onClick && (\n          <div className=\"flex-shrink-0 ml-4\">\n            <ChevronRight className=\"w-5 h-5 text-gray-400\" />\n          </div>\n        )}\n      </div>\n      {/* Quick actions */}\n      <div className=\"mt-3 flex flex-wrap gap-2\">\n        <Tooltip content={pinned ? 'Unpin this drug' : 'Pin this drug'}>\n          <button\n            type=\"button\"\n            onClick={() => { togglePin(drug.rxcui, drug.name); }}\n            className={`inline-flex items-center px-3 py-1.5 text-xs rounded ${pinned ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-700'} hover:bg-gray-200`}\n            aria-pressed={pinned}\n            aria-label={pinned ? 'Unpin drug' : 'Pin drug'}\n          >\n            <Star className={`w-3 h-3 mr-1 ${pinned ? '' : 'opacity-70'}`} /> {pinned ? 'Pinned' : 'Pin'}\n          </button>\n        </Tooltip>\n        <button\n          type=\"button\"\n          onClick={() => {\n            selection.addDrug(drug);\n            try { analytics.logSelection(drug.rxcui, drug.name, 'card_action_interactions'); } catch {}\n            // Use setTimeout to ensure state updates complete before navigation\n            setTimeout(() => navigate('/interactions'), 100);\n          }}\n          className=\"inline-flex items-center px-3 py-1.5 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200\"\n        >\n          <Activity className=\"w-3 h-3 mr-1\" /> Use in Interactions\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => {\n            selection.addDrug(drug);\n            try { analytics.logSelection(drug.rxcui, drug.name, 'card_action_genomics'); } catch {}\n            // Use setTimeout to ensure state updates complete before navigation\n            setTimeout(() => navigate('/genomics'), 100);\n          }}\n          className=\"inline-flex items-center px-3 py-1.5 text-xs bg-purple-100 text-purple-700 rounded hover:bg-purple-200\"\n        >\n          <Dna className=\"w-3 h-3 mr-1\" /> Analyze Genomics\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => {\n            selection.addDrug(drug);\n            const m = inferBiomarkerForDrug(drug.name);\n            try { analytics.logSelection(drug.rxcui, drug.name, 'card_action_trials'); } catch {}\n            // Use setTimeout to ensure state updates complete before navigation\n            setTimeout(() => {\n              if (m) navigate(`/trials?biomarker=${encodeURIComponent(m)}`);\n              else navigate('/trials');\n            }, 100);\n          }}\n          className=\"inline-flex items-center px-3 py-1.5 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200\"\n        >\n          <MapPinned className=\"w-3 h-3 mr-1\" /> Find Trials\n        </button>\n        {onClick && (\n          <button\n            type=\"button\"\n            onClick={handleClick}\n            onMouseDown={() => { try { analytics.logSelection(drug.rxcui, drug.name, 'card_action_details'); } catch {} }}\n            className=\"inline-flex items-center px-3 py-1.5 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200\"\n          >\n            <Share2 className=\"w-3 h-3 mr-1\" /> View Details\n          </button>\n        )}\n      </div>\n    </Card>\n  );\n};\n\nexport default DrugCard;\n","import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Drug, DrugSearchResult } from '../../types';\nimport DrugCard from './DrugCard';\nimport Alert from '../UI/Alert';\nimport Tooltip from '../UI/Tooltip';\nimport { Database, Globe, Star, Pill, Filter, TrendingUp, Clock, Info } from 'lucide-react';\nimport { getPins } from '../../utils/pins';\n\ninterface DrugSearchResultsProps {\n  results: DrugSearchResult | null;\n  loading: boolean;\n  error: string | null;\n  onDrugSelect?: (drug: Drug) => void;\n  filters?: { onlyOncology?: boolean; tty?: Set<string> };\n}\n\n// Calculate relevance score based on query match\nfunction calculateRelevanceScore(drug: Drug, query: string): number {\n  const lowerQuery = (query || '').toLowerCase();\n  const lowerName = (drug.name || '').toLowerCase();\n  if (!lowerQuery) return 0;\n  if (lowerName === lowerQuery) return 100;\n  if (lowerName.startsWith(lowerQuery)) return 80;\n  if (lowerName.includes(lowerQuery)) return 60;\n  const similarity = calculateSimilarity(lowerName, lowerQuery);\n  return Math.floor(similarity * 40);\n}\n\n// Simple similarity calculation\nfunction calculateSimilarity(str1: string, str2: string): number {\n  const longer = str1.length > str2.length ? str1 : str2;\n  const shorter = str1.length > str2.length ? str2 : str1;\n  if (longer.length === 0) return 1.0;\n  const distance = levenshteinDistance(longer, shorter);\n  return (longer.length - distance) / longer.length;\n}\n\n// Levenshtein distance for fuzzy matching\nfunction levenshteinDistance(str1: string, str2: string): number {\n  const matrix = Array(str2.length + 1)\n    .fill(null)\n    .map(() => Array(str1.length + 1).fill(null));\n  for (let i = 0; i <= str1.length; i++) matrix[0][i] = i;\n  for (let j = 0; j <= str2.length; j++) matrix[j][0] = j;\n  for (let j = 1; j <= str2.length; j++) {\n    for (let i = 1; i <= str1.length; i++) {\n      const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;\n      matrix[j][i] = Math.min(\n        (matrix[j][i - 1] as number) + 1,\n        (matrix[j - 1][i] as number) + 1,\n        (matrix[j - 1][i - 1] as number) + cost\n      );\n    }\n  }\n  return matrix[str2.length][str1.length] as number;\n}\n\nconst DrugSearchResults: React.FC<DrugSearchResultsProps> = ({\n  results,\n  loading,\n  error,\n  onDrugSelect,\n  filters,\n}) => {\n  // Popularity map from localStorage (incremented on selection elsewhere)\n  let popularity: Record<string, number> = {};\n  try { popularity = JSON.parse(localStorage.getItem('oncosaferx_popularity') || '{}'); } catch {}\n  // Categorize and rank results\n  const categorizedResults = useMemo(() => {\n    if (!results || !results.results.length) return null;\n\n    const categories: Record<string, Drug[]> = {\n      'Brand Names': [],\n      'Generic Names': [],\n      'Ingredients': [],\n      'Combinations': [],\n      'Other': [],\n    };\n\n    // Popular drug indicators\n    const popularDrugs = ['aspirin', 'ibuprofen', 'acetaminophen', 'warfarin', 'metformin', 'atorvastatin'];\n    const oncologyDrugs = ['pembrolizumab', 'nivolumab', 'fluorouracil', 'cisplatin', 'doxorubicin', 'paclitaxel'];\n\n    // Apply filters first (if any)\n    const baseList = results.results.filter(drug => {\n      const ttyOk = !filters?.tty || filters.tty.size === 0 || (drug.tty ? filters.tty.has(drug.tty) : false);\n      // oncology flag approximated by name matches; refined later by backend\n      const oncoNames = ['pembrolizumab','nivolumab','fluorouracil','cisplatin','doxorubicin','paclitaxel','tamoxifen','imatinib'];\n      const isOncologyApprox = oncoNames.some(n => (drug.name || '').toLowerCase().includes(n));\n      const oncoOk = !filters?.onlyOncology || isOncologyApprox;\n      return ttyOk && oncoOk;\n    });\n\n    baseList.forEach(drug => {\n      // Add popularity indicators\n      const isPopular = popularDrugs.some(popular => \n        drug.name.toLowerCase().includes(popular.toLowerCase())\n      );\n      const isOncology = oncologyDrugs.some(onco => \n        drug.name.toLowerCase().includes(onco.toLowerCase())\n      );\n\n      // Enhanced drug object with metadata\n      const enhancedDrug = {\n        ...drug,\n        isPopular,\n        isOncology,\n        relevanceScore: calculateRelevanceScore(drug, results.query || ''),\n        popularityScore: Number(popularity[drug.rxcui] || 0),\n      };\n\n      // Categorize by term type\n      switch (drug.tty) {\n        case 'BN':\n          categories['Brand Names'].push(enhancedDrug);\n          break;\n        case 'IN':\n        case 'PIN':\n          categories['Ingredients'].push(enhancedDrug);\n          break;\n        case 'MIN':\n          categories['Combinations'].push(enhancedDrug);\n          break;\n        case 'SCD':\n        case 'SBD':\n          categories['Generic Names'].push(enhancedDrug);\n          break;\n        default:\n          categories['Other'].push(enhancedDrug);\n          break;\n      }\n    });\n\n    // Sort each category by relevance score\n    Object.keys(categories).forEach(key => {\n      categories[key].sort((a, b) => {\n        // Prioritize popular and oncology drugs\n        if (a.isPopular && !b.isPopular) return -1;\n        if (!a.isPopular && b.isPopular) return 1;\n        if (a.isOncology && !b.isOncology) return -1;\n        if (!a.isOncology && b.isOncology) return 1;\n        // Then by dynamic popularity\n        if ((a as any).popularityScore !== (b as any).popularityScore) return (b as any).popularityScore - (a as any).popularityScore;\n        // Then by relevance score\n        return b.relevanceScore - a.relevanceScore;\n      });\n    });\n\n    return categories;\n  }, [results]);\n  const pins = useMemo(() => getPins(), [results]);\n\n  // Flattened list for keyboard navigation\n  const flatList = useMemo(() => {\n    if (!results || !results.results.length) return [] as Drug[];\n    if (!categorizedResults) return results.results as Drug[];\n    return Object.values(categorizedResults).flat();\n  }, [results, categorizedResults]);\n\n  const [highlighted, setHighlighted] = useState<number>(-1);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    setHighlighted(-1);\n  }, [results, filters]);\n\n  const move = (delta: number) => {\n    if (flatList.length === 0) return;\n    setHighlighted((prev) => {\n      const next = prev < 0 ? (delta > 0 ? 0 : flatList.length - 1) : (prev + delta + flatList.length) % flatList.length;\n      return next;\n    });\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'ArrowDown' || e.key.toLowerCase() === 'j') {\n      e.preventDefault();\n      move(1);\n    } else if (e.key === 'ArrowUp' || e.key.toLowerCase() === 'k') {\n      e.preventDefault();\n      move(-1);\n    } else if (e.key === 'Enter' && highlighted >= 0 && flatList[highlighted]) {\n      e.preventDefault();\n      const d = flatList[highlighted];\n      onDrugSelect?.(d);\n      try { const { rxcui, name } = d; (async () => (await import('../../utils/analytics')).analytics.logSelection(rxcui, name, 'search_results'))(); } catch {}\n    } else if (e.key.toLowerCase() === 'p' && highlighted >= 0 && flatList[highlighted]) {\n      // Toggle pin on highlighted item\n      e.preventDefault();\n      const d = flatList[highlighted];\n      try { togglePin(d.rxcui, d.name); setPinTick(t => t + 1); } catch {}\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"space-y-4\">\n        {Array.from({ length: 3 }).map((_, index) => (\n          <div key={index} className=\"animate-pulse\">\n            <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n              <div className=\"flex items-start space-x-3\">\n                <div className=\"w-10 h-10 bg-gray-200 rounded-lg\"></div>\n                <div className=\"flex-1 space-y-2\">\n                  <div className=\"h-5 bg-gray-200 rounded w-3/4\"></div>\n                  <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-1/4\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <Alert type=\"error\" title=\"Search Error\">\n        {error}\n      </Alert>\n    );\n  }\n\n  if (!results) {\n    return (\n      <div className=\"text-center py-12\">\n        <div className=\"text-gray-500\">\n          <Database className=\"w-12 h-12 mx-auto mb-4 text-gray-300\" />\n          <p className=\"text-lg font-medium\">Search for drugs</p>\n          <p className=\"text-sm\">Enter a drug name to search our database and external sources</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (results.count === 0) {\n    return (\n      <Alert type=\"info\" title=\"No Results Found\">\n        No drugs found matching your search query \"{results.query}\". Please try a different search term.\n      </Alert>\n    );\n  }\n\n  return (\n    <div\n      className=\"space-y-6 outline-none\"\n      tabIndex={0}\n      onKeyDown={handleKeyDown}\n      ref={containerRef}\n      role=\"listbox\"\n      aria-label=\"Drug search results\"\n      aria-activedescendant={highlighted >= 0 && flatList[highlighted] ? `drug-option-${flatList[highlighted].rxcui}` : undefined}\n    >\n      {/* Enhanced Search Summary */}\n      <div className=\"bg-white rounded-lg border border-gray-200 p-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900 flex items-center space-x-2\">\n              <TrendingUp className=\"w-5 h-5 text-blue-600\" />\n              <span>Search Results for \"{results.query}\"</span>\n            </h3>\n            <p className=\"text-sm text-gray-600\">\n              Found {results.count} drug{results.count !== 1 ? 's' : ''} • Ranked by relevance and popularity\n            </p>\n          </div>\n          \n          {results.sources && (\n            <div className=\"flex items-center space-x-4 text-sm text-gray-500\">\n              <Tooltip content=\"Results from local OncoSafeRx database\">\n                <div className=\"flex items-center space-x-1 cursor-help\">\n                  <Database className=\"w-4 h-4\" />\n                  <span>Local: {results.sources.local}</span>\n                </div>\n              </Tooltip>\n              <Tooltip content=\"Results from RxNorm (National Library of Medicine) database\">\n                <div className=\"flex items-center space-x-1 cursor-help\">\n                  <Globe className=\"w-4 h-4\" />\n                  <span>RxNorm: {results.sources.rxnorm}</span>\n                </div>\n              </Tooltip>\n            </div>\n          )}\n        </div>\n\n        {/* Category Summary */}\n        {categorizedResults && (\n          <div className=\"flex flex-wrap gap-3 pt-3 border-t border-gray-100\">\n            {Object.entries(categorizedResults).map(([category, drugs]) => {\n              if (drugs.length === 0) return null;\n              \n              const getCategoryIcon = (cat: string) => {\n                switch (cat) {\n                  case 'Brand Names': return <Star className=\"w-3 h-3\" />;\n                  case 'Generic Names': return <Pill className=\"w-3 h-3\" />;\n                  case 'Ingredients': return <Filter className=\"w-3 h-3\" />;\n                  case 'Combinations': return <Database className=\"w-3 h-3\" />;\n                  default: return <Globe className=\"w-3 h-3\" />;\n                }\n              };\n\n              const getCategoryTooltip = (cat: string) => {\n                switch (cat) {\n                  case 'Brand Names': return 'Proprietary/commercial drug names (e.g., Tylenol, Advil)';\n                  case 'Generic Names': return 'Scientific/chemical drug names (e.g., acetaminophen, ibuprofen)';\n                  case 'Ingredients': return 'Active pharmaceutical ingredients and components';\n                  case 'Combinations': return 'Multi-ingredient formulations and combination products';\n                  default: return 'Other drug terminology types';\n                }\n              };\n\n              return (\n                <Tooltip key={category} content={getCategoryTooltip(category)}>\n                  <div className=\"flex items-center space-x-1 px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-600 cursor-help\">\n                    {getCategoryIcon(category)}\n                    <span>{category}: {drugs.length}</span>\n                  </div>\n                </Tooltip>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Pinned Results */}\n      {Object.keys(pins).length > 0 && results && results.results.length > 0 && (\n        <div className=\"space-y-3\">\n          <div className={`inline-flex items-center space-x-2 px-3 py-2 rounded-lg border text-yellow-700 bg-yellow-50 border-yellow-200`}>\n            <Star className=\"w-4 h-4\" />\n            <h4 className=\"font-medium\">Pinned</h4>\n            <span className=\"text-sm\">({Object.keys(pins).filter(r => results.results.find(dr => dr.rxcui === r)).length})</span>\n          </div>\n          <div className=\"space-y-3\">\n            {results.results\n              .filter((d) => !!pins[d.rxcui])\n              .map((drug) => (\n                <div key={`${drug.rxcui}-${drug.tty}`} className=\"relative\">\n                  <DrugCard\n                    drug={drug}\n                    onClick={onDrugSelect}\n                    className={'ring-2 ring-yellow-200'}\n                  />\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n\n      {/* Categorized Results */}\n      {categorizedResults ? (\n        <div className=\"space-y-6\">\n          {Object.entries(categorizedResults).map(([category, drugs]) => {\n            if (drugs.length === 0) return null;\n\n            const getCategoryColor = (cat: string) => {\n              switch (cat) {\n                case 'Brand Names': return 'text-purple-600 bg-purple-50 border-purple-200';\n                case 'Generic Names': return 'text-blue-600 bg-blue-50 border-blue-200';\n                case 'Ingredients': return 'text-green-600 bg-green-50 border-green-200';\n                case 'Combinations': return 'text-orange-600 bg-orange-50 border-orange-200';\n                default: return 'text-gray-600 bg-gray-50 border-gray-200';\n              }\n            };\n\n            const getCategoryIcon = (cat: string) => {\n              switch (cat) {\n                case 'Brand Names': return <Star className=\"w-4 h-4\" />;\n                case 'Generic Names': return <Pill className=\"w-4 h-4\" />;\n                case 'Ingredients': return <Filter className=\"w-4 h-4\" />;\n                case 'Combinations': return <Database className=\"w-4 h-4\" />;\n                default: return <Globe className=\"w-4 h-4\" />;\n              }\n            };\n\n            return (\n              <div key={category} className=\"space-y-3\">\n                {/* Category Header */}\n                <div className={`inline-flex items-center space-x-2 px-3 py-2 rounded-lg border ${getCategoryColor(category)}`}>\n                  {getCategoryIcon(category)}\n                  <h4 className=\"font-medium\">{category}</h4>\n                  <span className=\"text-sm\">({drugs.length})</span>\n                </div>\n\n                {/* Category Results */}\n                <div className=\"space-y-3\">\n                  {drugs.map((drug) => (\n                    <div\n                      key={`${drug.rxcui}-${drug.tty}`}\n                      id={`drug-option-${drug.rxcui}`}\n                      className=\"relative\"\n                      role=\"option\"\n                      aria-selected={highlighted >= 0 && flatList[highlighted]?.rxcui === drug.rxcui}\n                    >\n                      {/* Pin toggle */}\n                      <Tooltip content={pins[drug.rxcui] ? 'Unpin this drug' : 'Pin this drug'}>\n                        <button\n                          type=\"button\"\n                          onClick={(e) => { e.stopPropagation(); togglePin(drug.rxcui, drug.name); setPinTick(t => t + 1); }}\n                          className={`absolute top-2 left-2 z-10 inline-flex items-center justify-center w-6 h-6 rounded-full border ${pins[drug.rxcui] ? 'bg-yellow-100 border-yellow-300 text-yellow-800' : 'bg-white border-gray-200 text-gray-500'} hover:bg-yellow-50`}\n                          aria-label={pins[drug.rxcui] ? 'Unpin' : 'Pin'}\n                        >\n                          <Star className=\"w-3 h-3\" />\n                        </button>\n                      </Tooltip>\n                      <DrugCard\n                        drug={drug}\n                        onClick={onDrugSelect}\n                        className={`${drug.isPopular ? 'ring-2 ring-yellow-200' : ''} ${drug.isOncology ? 'ring-2 ring-purple-200' : ''} ${highlighted >= 0 && flatList[highlighted]?.rxcui === drug.rxcui ? 'ring-2 ring-blue-300' : ''}`}\n                      />\n                      \n                      {/* Relevance and Special Indicators */}\n                      <div className=\"absolute top-2 right-2 flex items-center space-x-1\">\n                        {drug.isPopular && (\n                          <Tooltip content=\"Commonly prescribed medication with high usage frequency\">\n                            <div className=\"flex items-center space-x-1 px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium cursor-help\">\n                              <TrendingUp className=\"w-3 h-3\" />\n                              <span>Popular</span>\n                            </div>\n                          </Tooltip>\n                        )}\n                        {drug.isOncology && (\n                          <Tooltip content=\"Oncology/cancer treatment medication - requires specialized handling and monitoring\">\n                            <div className=\"flex items-center space-x-1 px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium cursor-help\">\n                              <Star className=\"w-3 h-3\" />\n                              <span>Oncology</span>\n                            </div>\n                          </Tooltip>\n                        )}\n                        {drug.relevanceScore >= 80 && (\n                          <Tooltip content=\"High relevance match based on search query similarity\">\n                            <div className=\"flex items-center space-x-1 px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium cursor-help\">\n                              <Clock className=\"w-3 h-3\" />\n                              <span>{drug.relevanceScore}% match</span>\n                            </div>\n                          </Tooltip>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      ) : (\n        /* Fallback to simple list */\n        <div className=\"space-y-4\">\n          {results.results.map((drug) => (\n            <div key={`${drug.rxcui}-${drug.tty}`} className=\"relative\">\n              <Tooltip content={pins[drug.rxcui] ? 'Unpin this drug' : 'Pin this drug'}>\n                <button\n                  type=\"button\"\n                  onClick={(e) => { e.stopPropagation(); togglePin(drug.rxcui, drug.name); setPinTick(t => t + 1); }}\n                  className={`absolute top-2 left-2 z-10 inline-flex items-center justify-center w-6 h-6 rounded-full border ${pins[drug.rxcui] ? 'bg-yellow-100 border-yellow-300 text-yellow-800' : 'bg-white border-gray-200 text-gray-500'} hover:bg-yellow-50`}\n                  aria-label={pins[drug.rxcui] ? 'Unpin' : 'Pin'}\n                >\n                  <Star className=\"w-3 h-3\" />\n                </button>\n              </Tooltip>\n              <DrugCard\n                drug={drug}\n                onClick={onDrugSelect}\n                className={pins[drug.rxcui] ? 'ring-2 ring-yellow-200' : ''}\n              />\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Load More (if needed) */}\n      {results.count > results.results.length && (\n        <div className=\"text-center\">\n          <button className=\"px-6 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 flex items-center space-x-2 mx-auto\">\n            <Database className=\"w-4 h-4\" />\n            <span>Load More Results ({results.count - results.results.length} remaining)</span>\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default DrugSearchResults;\n","import React, { useState, useMemo } from 'react';\nimport Card from '../UI/Card';\nimport {\n  Pill,\n  Activity,\n  Target,\n  Shield,\n  AlertTriangle,\n  CheckCircle,\n  Clock,\n  Star,\n  TrendingUp,\n  BarChart3,\n  Eye,\n  ExternalLink,\n  Heart,\n  Brain,\n  Zap,\n  Users,\n  Globe,\n  Award,\n  DollarSign,\n  Calendar,\n  Info,\n  ChevronDown,\n  ChevronUp,\n  Filter,\n  Grid,\n  List,\n  Bookmark,\n  Plus,\n  Share2,\n  Download\n} from 'lucide-react';\n\ninterface EnhancedDrug {\n  id: string;\n  name: string;\n  genericName?: string;\n  brandName?: string;\n  therapeuticClass: string;\n  mechanismOfAction: string;\n  indication: string[];\n  biomarkers?: string[];\n  fdaApproved: boolean;\n  approvalDate?: string;\n  clinicalTrialPhase?: string;\n  safetyScore: number;\n  efficacyScore: number;\n  evidenceLevel: 'high' | 'moderate' | 'low';\n  hasInteractions: boolean;\n  hasGenomicFactors: boolean;\n  requiresMonitoring: boolean;\n  blackBoxWarning?: boolean;\n  pregnancyCategory?: string;\n  costTier: 'low' | 'moderate' | 'high' | 'specialty';\n  routeOfAdministration: string[];\n  dosageForm: string[];\n  keyBenefits: string[];\n  keyRisks: string[];\n  commonSideEffects: string[];\n  monitoringRequirements: string[];\n  contraindications: string[];\n  patientSuitability: string[];\n  relatedDrugs: string[];\n  clinicalTrials: number;\n  publications: number;\n  patientReviews?: number;\n  isOncologyDrug: boolean;\n  isOrphanDrug: boolean;\n  thumbnailUrl?: string;\n}\n\ninterface EnhancedDrugResultsProps {\n  drugs: EnhancedDrug[];\n  loading?: boolean;\n  error?: string;\n  onDrugSelect: (drug: EnhancedDrug) => void;\n  onCompare?: (drugs: EnhancedDrug[]) => void;\n  viewMode?: 'grid' | 'list' | 'detailed';\n  sortBy?: string;\n  filterBy?: any;\n  onPin?: (drug: EnhancedDrug) => void;\n  onAddToInteractions?: (drug: EnhancedDrug) => void;\n}\n\nconst EnhancedDrugResults: React.FC<EnhancedDrugResultsProps> = ({\n  drugs,\n  loading,\n  error,\n  onDrugSelect,\n  onCompare,\n  viewMode = 'grid',\n  sortBy = 'relevance',\n  filterBy = {},\n  onPin,\n  onAddToInteractions\n}) => {\n  const [selectedDrugs, setSelectedDrugs] = useState<string[]>([]);\n  const [currentViewMode, setCurrentViewMode] = useState(viewMode);\n  const [currentSortBy, setCurrentSortBy] = useState(sortBy);\n  const [showFilters, setShowFilters] = useState(false);\n  const [expandedCards, setExpandedCards] = useState<string[]>([]);\n\n  const handleDrugToggle = (drugId: string) => {\n    setSelectedDrugs(prev => \n      prev.includes(drugId) \n        ? prev.filter(id => id !== drugId)\n        : [...prev, drugId]\n    );\n  };\n\n  const handleCardExpand = (drugId: string) => {\n    setExpandedCards(prev =>\n      prev.includes(drugId)\n        ? prev.filter(id => id !== drugId)\n        : [...prev, drugId]\n    );\n  };\n\n  const sortedAndFilteredDrugs = useMemo(() => {\n    let result = [...drugs];\n\n    // Apply filters\n    if (filterBy.fdaApproved !== undefined) {\n      result = result.filter(drug => drug.fdaApproved === filterBy.fdaApproved);\n    }\n    if (filterBy.isOncologyDrug !== undefined) {\n      result = result.filter(drug => drug.isOncologyDrug === filterBy.isOncologyDrug);\n    }\n    if (filterBy.therapeuticClass) {\n      result = result.filter(drug => drug.therapeuticClass === filterBy.therapeuticClass);\n    }\n    if (filterBy.evidenceLevel) {\n      result = result.filter(drug => drug.evidenceLevel === filterBy.evidenceLevel);\n    }\n\n    // Apply sorting\n    switch (currentSortBy) {\n      case 'name':\n        result.sort((a, b) => a.name.localeCompare(b.name));\n        break;\n      case 'safety':\n        result.sort((a, b) => b.safetyScore - a.safetyScore);\n        break;\n      case 'efficacy':\n        result.sort((a, b) => b.efficacyScore - a.efficacyScore);\n        break;\n      case 'approval_date':\n        result.sort((a, b) => {\n          if (!a.approvalDate) return 1;\n          if (!b.approvalDate) return -1;\n          return new Date(b.approvalDate).getTime() - new Date(a.approvalDate).getTime();\n        });\n        break;\n      case 'clinical_trials':\n        result.sort((a, b) => b.clinicalTrials - a.clinicalTrials);\n        break;\n      default:\n        // Keep original order for relevance\n        break;\n    }\n\n    return result;\n  }, [drugs, filterBy, currentSortBy]);\n\n  const getEvidenceBadge = (level: string) => {\n    const variants = {\n      high: 'bg-green-100 text-green-800',\n      moderate: 'bg-yellow-100 text-yellow-800',\n      low: 'bg-red-100 text-red-800'\n    };\n    return variants[level as keyof typeof variants] || variants.moderate;\n  };\n\n  const getCostBadge = (tier: string) => {\n    const variants = {\n      low: 'bg-green-100 text-green-800',\n      moderate: 'bg-yellow-100 text-yellow-800',\n      high: 'bg-orange-100 text-orange-800',\n      specialty: 'bg-purple-100 text-purple-800'\n    };\n    return variants[tier as keyof typeof variants] || variants.moderate;\n  };\n\n  // Local storage fallbacks for pin/add when no callbacks provided\n  const defaultPin = (drug: EnhancedDrug) => {\n    try {\n      const key = 'osrx_pinned_drugs';\n      const list = JSON.parse(localStorage.getItem(key) || '[]');\n      if (!list.find((d: any) => d.id === drug.id)) {\n        list.unshift({ id: drug.id, name: drug.name });\n        localStorage.setItem(key, JSON.stringify(list.slice(0, 20)));\n      }\n    } catch {}\n  };\n\n  const defaultAddToInteractions = (drug: EnhancedDrug) => {\n    try {\n      const key = 'osrx_interaction_basket';\n      const list = JSON.parse(localStorage.getItem(key) || '[]');\n      if (!list.find((d: any) => d.id === drug.id)) {\n        list.push({ id: drug.id, name: drug.name });\n        localStorage.setItem(key, JSON.stringify(list.slice(-10)));\n      }\n    } catch {}\n  };\n\n  const renderDrugCard = (drug: EnhancedDrug, isExpanded: boolean = false) => (\n    <Card key={drug.id} className={`transition-all duration-200 hover:shadow-lg ${\n      selectedDrugs.includes(drug.id) ? 'ring-2 ring-violet-500' : ''\n    }`}>\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center space-x-2 mb-2\">\n              <input\n                type=\"checkbox\"\n                checked={selectedDrugs.includes(drug.id)}\n                onChange={() => handleDrugToggle(drug.id)}\n                className=\"rounded border-gray-300 text-violet-600 focus:ring-violet-500\"\n              />\n              <CardTitle className=\"text-lg font-semibold text-gray-900\">\n                {drug.name}\n              </CardTitle>\n              {drug.blackBoxWarning && (\n                <Badge className=\"bg-red-100 text-red-800\">\n                  <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                  Black Box\n                </Badge>\n              )}\n            </div>\n            \n            {drug.genericName && drug.genericName !== drug.name && (\n              <p className=\"text-sm text-gray-600 mb-2\">\n                Generic: {drug.genericName}\n              </p>\n            )}\n            \n            <div className=\"flex flex-wrap gap-2 mb-3\">\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {drug.therapeuticClass}\n              </Badge>\n              <Badge className={getEvidenceBadge(drug.evidenceLevel)}>\n                {drug.evidenceLevel} evidence\n              </Badge>\n              {drug.fdaApproved && (\n                <Badge className=\"bg-blue-100 text-blue-800\">\n                  <CheckCircle className=\"h-3 w-3 mr-1\" />\n                  FDA Approved\n                </Badge>\n              )}\n              {drug.isOncologyDrug && (\n                <Badge className=\"bg-purple-100 text-purple-800\">\n                  <Target className=\"h-3 w-3 mr-1\" />\n                  Oncology\n                </Badge>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"flex flex-col items-end space-y-2\">\n            <div className=\"flex items-center space-x-1\">\n              <Star className=\"h-4 w-4 text-yellow-500\" />\n              <span className=\"text-sm font-medium\">{drug.efficacyScore}/100</span>\n            </div>\n            <Badge className={getCostBadge(drug.costTier)}>\n              <DollarSign className=\"h-3 w-3 mr-1\" />\n              {drug.costTier}\n            </Badge>\n            <div className=\"flex items-center gap-2\">\n              <button\n                title=\"Pin\"\n                onClick={() => (onPin ? onPin(drug) : defaultPin(drug))}\n                className=\"text-gray-500 hover:text-violet-700\"\n              >\n                <Bookmark className=\"h-4 w-4\" />\n              </button>\n              <button\n                title=\"Add to interactions\"\n                onClick={() => (onAddToInteractions ? onAddToInteractions(drug) : defaultAddToInteractions(drug))}\n                className=\"text-gray-500 hover:text-violet-700\"\n              >\n                <Plus className=\"h-4 w-4\" />\n              </button>\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-4\">\n        {/* Key Information */}\n        <div>\n          <h4 className=\"font-medium text-gray-900 mb-2\">Mechanism & Indications</h4>\n          <p className=\"text-sm text-gray-600 mb-2\">{drug.mechanismOfAction}</p>\n          <div className=\"flex flex-wrap gap-1\">\n            {drug.indication.slice(0, 3).map((indication, idx) => (\n              <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                {indication}\n              </Badge>\n            ))}\n            {drug.indication.length > 3 && (\n              <Badge variant=\"outline\" className=\"text-xs\">\n                +{drug.indication.length - 3} more\n              </Badge>\n            )}\n          </div>\n        </div>\n\n        {/* Scores Grid */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"text-center p-3 bg-green-50 rounded-lg\">\n            <div className=\"flex items-center justify-center space-x-1 mb-1\">\n              <Shield className=\"h-4 w-4 text-green-600\" />\n              <span className=\"text-sm font-medium text-green-800\">Safety</span>\n            </div>\n            <div className=\"text-lg font-bold text-green-800\">{drug.safetyScore}/100</div>\n          </div>\n          <div className=\"text-center p-3 bg-blue-50 rounded-lg\">\n            <div className=\"flex items-center justify-center space-x-1 mb-1\">\n              <TrendingUp className=\"h-4 w-4 text-blue-600\" />\n              <span className=\"text-sm font-medium text-blue-800\">Efficacy</span>\n            </div>\n            <div className=\"text-lg font-bold text-blue-800\">{drug.efficacyScore}/100</div>\n          </div>\n        </div>\n\n        {/* Biomarkers */}\n        {drug.biomarkers && drug.biomarkers.length > 0 && (\n          <div>\n            <h4 className=\"font-medium text-gray-900 mb-2 flex items-center space-x-1\">\n              <Activity className=\"h-4 w-4 text-purple-600\" />\n              <span>Biomarker Targets</span>\n            </h4>\n            <div className=\"flex flex-wrap gap-1\">\n              {drug.biomarkers.map((biomarker, idx) => (\n                <Badge key={idx} className=\"bg-purple-100 text-purple-800 text-xs\">\n                  {biomarker}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Expanded Information */}\n        {isExpanded && (\n          <div className=\"space-y-4 pt-4 border-t\">\n            {/* Key Benefits & Risks */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <h5 className=\"font-medium text-green-800 mb-2 flex items-center space-x-1\">\n                  <CheckCircle className=\"h-4 w-4\" />\n                  <span>Key Benefits</span>\n                </h5>\n                <ul className=\"text-xs text-gray-600 space-y-1\">\n                  {drug.keyBenefits.slice(0, 3).map((benefit, idx) => (\n                    <li key={idx}>• {benefit}</li>\n                  ))}\n                </ul>\n              </div>\n              <div>\n                <h5 className=\"font-medium text-red-800 mb-2 flex items-center space-x-1\">\n                  <AlertTriangle className=\"h-4 w-4\" />\n                  <span>Key Risks</span>\n                </h5>\n                <ul className=\"text-xs text-gray-600 space-y-1\">\n                  {drug.keyRisks.slice(0, 3).map((risk, idx) => (\n                    <li key={idx}>• {risk}</li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n\n            {/* Clinical Data */}\n            <div className=\"grid grid-cols-3 gap-4 text-center\">\n              <div className=\"p-2 bg-gray-50 rounded\">\n                <div className=\"text-lg font-bold text-gray-900\">{drug.clinicalTrials}</div>\n                <div className=\"text-xs text-gray-600\">Clinical Trials</div>\n              </div>\n              <div className=\"p-2 bg-gray-50 rounded\">\n                <div className=\"text-lg font-bold text-gray-900\">{drug.publications}</div>\n                <div className=\"text-xs text-gray-600\">Publications</div>\n              </div>\n              <div className=\"p-2 bg-gray-50 rounded\">\n                <div className=\"text-lg font-bold text-gray-900\">\n                  {drug.approvalDate ? new Date(drug.approvalDate).getFullYear() : 'N/A'}\n                </div>\n                <div className=\"text-xs text-gray-600\">FDA Approval</div>\n              </div>\n            </div>\n\n            {/* Monitoring Requirements */}\n            {drug.monitoringRequirements.length > 0 && (\n              <div>\n                <h5 className=\"font-medium text-orange-800 mb-2 flex items-center space-x-1\">\n                  <Clock className=\"h-4 w-4\" />\n                  <span>Monitoring Required</span>\n                </h5>\n                <div className=\"flex flex-wrap gap-1\">\n                  {drug.monitoringRequirements.slice(0, 3).map((req, idx) => (\n                    <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                      {req}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Action Buttons */}\n        <div className=\"flex items-center justify-between pt-4 border-t\">\n          <div className=\"flex items-center space-x-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => handleCardExpand(drug.id)}\n            >\n              {isExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n              {isExpanded ? 'Less' : 'More'}\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => onDrugSelect(drug)}\n            >\n              <Eye className=\"h-4 w-4 mr-1\" />\n              View Details\n            </Button>\n          </div>\n          \n          <div className=\"flex items-center space-x-1\">\n            <Button variant=\"ghost\" size=\"sm\">\n              <Bookmark className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"ghost\" size=\"sm\">\n              <Share2 className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-600\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <Card className=\"border-red-200\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center space-x-2 text-red-600\">\n            <AlertTriangle className=\"h-5 w-5\" />\n            <span>{error}</span>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Results Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">Search Results</h2>\n          <p className=\"text-gray-600\">\n            Found {sortedAndFilteredDrugs.length} drug{sortedAndFilteredDrugs.length !== 1 ? 's' : ''}\n          </p>\n        </div>\n        \n        <div className=\"flex items-center space-x-4\">\n          {/* Sort Controls */}\n          <Select value={currentSortBy} onValueChange={setCurrentSortBy}>\n            <SelectTrigger className=\"w-48\">\n              <SelectValue placeholder=\"Sort by...\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"relevance\">Relevance</SelectItem>\n              <SelectItem value=\"name\">Name (A-Z)</SelectItem>\n              <SelectItem value=\"safety\">Safety Score</SelectItem>\n              <SelectItem value=\"efficacy\">Efficacy Score</SelectItem>\n              <SelectItem value=\"approval_date\">Approval Date</SelectItem>\n              <SelectItem value=\"clinical_trials\">Clinical Trials</SelectItem>\n            </SelectContent>\n          </Select>\n\n          {/* View Mode Toggle */}\n          <div className=\"flex bg-gray-100 rounded-lg p-1\">\n            <Button\n              variant={currentViewMode === 'grid' ? 'default' : 'ghost'}\n              size=\"sm\"\n              onClick={() => setCurrentViewMode('grid')}\n            >\n              <Grid className=\"h-4 w-4\" />\n            </Button>\n            <Button\n              variant={currentViewMode === 'list' ? 'default' : 'ghost'}\n              size=\"sm\"\n              onClick={() => setCurrentViewMode('list')}\n            >\n              <List className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Selected Drugs Actions */}\n      {selectedDrugs.length > 0 && (\n        <Card className=\"border-violet-200 bg-violet-50\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"font-medium text-violet-800\">\n                {selectedDrugs.length} drug{selectedDrugs.length !== 1 ? 's' : ''} selected\n              </span>\n              <div className=\"flex items-center space-x-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => onCompare?.(drugs.filter(d => selectedDrugs.includes(d.id)))}\n                  disabled={selectedDrugs.length < 2}\n                >\n                  <BarChart3 className=\"h-4 w-4 mr-1\" />\n                  Compare\n                </Button>\n                <Button variant=\"outline\" size=\"sm\">\n                  <Download className=\"h-4 w-4 mr-1\" />\n                  Export\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setSelectedDrugs([])}\n                >\n                  Clear Selection\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Results Grid/List */}\n      <div className={\n        currentViewMode === 'grid' \n          ? 'grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6'\n          : 'space-y-4'\n      }>\n        {sortedAndFilteredDrugs.map(drug => \n          renderDrugCard(drug, expandedCards.includes(drug.id))\n        )}\n      </div>\n\n      {/* No Results */}\n      {sortedAndFilteredDrugs.length === 0 && (\n        <Card className=\"border-gray-200\">\n          <CardContent className=\"p-12 text-center\">\n            <Pill className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No drugs found</h3>\n            <p className=\"text-gray-600\">\n              Try adjusting your search criteria or filters to find more results.\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n};\n\nexport default EnhancedDrugResults;\n","import React, { useEffect, useMemo, useRef, useState } from 'react';\n\ntype Option = {\n  rxcui?: string | null;\n  id?: string | null;\n  name: string;\n  type?: 'drug' | 'indication' | 'mechanism' | 'biomarker' | 'gene' | 'class';\n};\n\ninterface Props {\n  placeholder?: string;\n  value: string;\n  onChange: (v: string) => void;\n  onSelect: (opt: { rxcui?: string | null; name: string }) => void;\n  maxResults?: number;\n  onOfflineChange?: (offline: boolean) => void;\n  onAutoResolve?: (opt: { rxcui?: string | null; name: string }) => void;\n}\n\nconst LOCAL: Option[] = [\n  { name: 'aspirin', type: 'drug' },\n  { name: 'acetaminophen', type: 'drug' },\n  { name: 'ibuprofen', type: 'drug' },\n  { name: 'clopidogrel', type: 'drug' },\n  { name: 'warfarin', type: 'drug' },\n  { name: 'omeprazole', type: 'drug' },\n  { name: 'simvastatin', type: 'drug' },\n  { name: 'levodopa', type: 'drug' },\n];\n\nexport default function SolidDrugSearch({ placeholder, value, onChange, onSelect, maxResults = 12, onOfflineChange, onAutoResolve }: Props) {\n  const [open, setOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [offline, setOffline] = useState(false);\n  const [options, setOptions] = useState<Option[]>([]);\n  const [highlight, setHighlight] = useState<number>(-1);\n  const rootRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const lastAutoFor = useRef<string>('');\n\n  // Outside click to close\n  useEffect(() => {\n    const onDocDown = (e: MouseEvent) => {\n      if (!rootRef.current) return;\n      if (!rootRef.current.contains(e.target as Node)) setOpen(false);\n    };\n    document.addEventListener('mousedown', onDocDown);\n    return () => document.removeEventListener('mousedown', onDocDown);\n  }, []);\n\n  // Fetch suggestions (debounced)\n  useEffect(() => {\n    let abort = false;\n    const q = value.trim();\n    if (q.length < 2) { setOptions([]); setOffline(false); onOfflineChange?.(false); return; }\n    setLoading(true);\n    const t = setTimeout(async () => {\n      try {\n        const resp = await fetch(`/api/drugs/suggestions?q=${encodeURIComponent(q)}&limit=${maxResults}`);\n        if (!resp.ok) throw new Error('HTTP ' + resp.status);\n        const data = await resp.json();\n        if (abort) return;\n        const opts = (data.suggestions || []).map((s: any) => ({ rxcui: s.rxcui, name: s.name, type: 'drug' }));\n        setOptions(opts);\n        setOffline(!!data.offline);\n        onOfflineChange?.(!!data.offline);\n\n        // Auto-resolve exact match: if user typed an exact drug name and we have a matching option\n        const val = q.toLowerCase();\n        const exact = opts.find(o => o.name.toLowerCase() === val);\n        if (exact && lastAutoFor.current !== val) {\n          lastAutoFor.current = val;\n          onAutoResolve?.({ rxcui: exact.rxcui || null, name: exact.name });\n        }\n\n        // Auto-resolve single strong suggestion: one result and it starts with the query\n        if (!exact && opts.length === 1) {\n          const only = opts[0];\n          if (only.name.toLowerCase().startsWith(val) && lastAutoFor.current !== val) {\n            lastAutoFor.current = val;\n            onAutoResolve?.({ rxcui: only.rxcui || null, name: only.name });\n          }\n        }\n      } catch {\n        if (!abort) {\n          const lc = q.toLowerCase();\n          const fallback = LOCAL.filter(o => o.name.includes(lc)).slice(0, maxResults);\n          setOptions(fallback);\n          setOffline(true);\n          onOfflineChange?.(true);\n\n          const exact = fallback.find(o => o.name.toLowerCase() === lc);\n          if (exact && lastAutoFor.current !== lc) {\n            lastAutoFor.current = lc;\n            onAutoResolve?.({ rxcui: exact.rxcui || null, name: exact.name });\n          }\n        }\n      } finally {\n        if (!abort) setLoading(false);\n      }\n    }, 200);\n    return () => { abort = true; clearTimeout(t); };\n  }, [value, maxResults, onOfflineChange]);\n\n  const onKeyDown = (e: React.KeyboardEvent) => {\n    if (!open) return;\n    if (e.key === 'ArrowDown') { \n      e.preventDefault(); \n      setHighlight(h => Math.min(h + 1, options.length - 1)); \n    }\n    else if (e.key === 'ArrowUp') { \n      e.preventDefault(); \n      setHighlight(h => Math.max(h - 1, 0)); \n    }\n    else if (e.key === 'Enter') { \n      e.preventDefault(); \n      if (highlight >= 0 && options[highlight]) {\n        commit(options[highlight]);\n      } else if (options.length === 1) {\n        // Auto-select if only one option\n        commit(options[0]);\n      }\n    }\n    else if (e.key === 'Escape') { \n      setOpen(false); \n      setHighlight(-1);\n    }\n  };\n\n  const commit = (opt: Option) => {\n    onChange(opt.name); // Update the input value to show selection\n    onSelect({ rxcui: opt.rxcui || null, name: opt.name });\n    setOpen(false);\n    setHighlight(-1);\n    inputRef.current?.blur(); // Remove focus to indicate selection is complete\n  };\n\n  const displayOptions = useMemo(() => options.slice(0, maxResults), [options, maxResults]);\n\n  return (\n    <div ref={rootRef} className=\"relative\">\n      <div className=\"relative\">\n        <input\n          ref={inputRef}\n          type=\"text\"\n          value={value}\n          onChange={(e) => { onChange(e.target.value); setOpen(true); }}\n          onFocus={() => setOpen(true)}\n          onKeyDown={onKeyDown}\n          placeholder={placeholder}\n          className=\"w-full pl-3 pr-10 py-3 text-lg border border-gray-300 rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-violet-500 bg-white\"\n          aria-autocomplete=\"list\"\n          aria-expanded={open}\n          aria-haspopup=\"listbox\"\n          role=\"combobox\"\n        />\n        <div className=\"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-400\">\n          {loading ? '...' : (offline ? 'offline' : '')}\n        </div>\n      </div>\n      {open && displayOptions.length > 0 && (\n        <ul role=\"listbox\" className=\"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-80 overflow-auto\">\n          {displayOptions.map((opt, idx) => (\n            <li key={`${opt.rxcui || opt.name}-${idx}`}>\n              <button\n                type=\"button\"\n                onMouseDown={(e) => e.preventDefault()}\n                onMouseEnter={() => setHighlight(idx)}\n                onClick={() => commit(opt)}\n                className={`w-full flex items-center justify-between px-4 py-3 text-left transition-all duration-150 ${\n                  idx === highlight \n                    ? 'bg-violet-50 border-l-4 border-violet-500 shadow-sm' \n                    : 'hover:bg-gray-50 border-l-4 border-transparent'\n                }`}\n                role=\"option\"\n                aria-selected={idx===highlight}\n              >\n                <div className=\"flex-1 min-w-0\">\n                  <span className=\"font-medium text-gray-900 block truncate\">{opt.name}</span>\n                  {opt.type && (\n                    <span className=\"text-xs text-gray-500 capitalize\">{opt.type}</span>\n                  )}\n                </div>\n                {opt.rxcui && (\n                  <div className=\"flex-shrink-0 ml-3\">\n                    <span className=\"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-700\">\n                      {opt.rxcui}\n                    </span>\n                  </div>\n                )}\n              </button>\n            </li>\n          ))}\n        </ul>\n      )}\n    </div>\n  );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport { ChevronDown, X, Check, Search } from 'lucide-react';\n\ninterface FilterOption {\n  value: string;\n  label: string;\n  description?: string;\n  count?: number;\n  category?: string;\n  popular?: boolean;\n}\n\ninterface FilterAutocompleteProps {\n  options: FilterOption[];\n  selectedValues: string[];\n  onSelectionChange: (values: string[]) => void;\n  placeholder?: string;\n  label?: string;\n  maxSelection?: number;\n  searchable?: boolean;\n  showCounts?: boolean;\n  className?: string;\n}\n\n// Comprehensive filter options for each category\nconst THERAPEUTIC_CLASS_OPTIONS: FilterOption[] = [\n  { value: 'antineoplastic', label: 'Antineoplastic Agents', description: 'Drugs that inhibit or prevent cancer growth', count: 1247, popular: true },\n  { value: 'immunotherapy', label: 'Immunotherapy', description: 'Treatments that use the immune system', count: 324, popular: true },\n  { value: 'targeted_therapy', label: 'Targeted Therapy', description: 'Drugs targeting specific cancer mechanisms', count: 456, popular: true },\n  { value: 'chemotherapy', label: 'Chemotherapy', description: 'Traditional cytotoxic agents', count: 892, popular: true },\n  { value: 'hormone_therapy', label: 'Hormone Therapy', description: 'Treatments that block hormones', count: 156 },\n  { value: 'supportive_care', label: 'Supportive Care', description: 'Drugs for managing side effects', count: 234 },\n  { value: 'pain_management', label: 'Pain Management', description: 'Analgesics and pain control', count: 187 },\n  { value: 'antiemetic', label: 'Antiemetic', description: 'Anti-nausea medications', count: 89 },\n  { value: 'growth_factor', label: 'Growth Factor', description: 'Stimulate blood cell production', count: 67 },\n  { value: 'bisphosphonate', label: 'Bisphosphonate', description: 'Bone strengthening agents', count: 45 },\n  { value: 'radioprotective', label: 'Radioprotective', description: 'Protect from radiation damage', count: 23 },\n  { value: 'differentiation_agent', label: 'Differentiation Agent', description: 'Promote cell maturation', count: 34 }\n];\n\nconst MECHANISM_OPTIONS: FilterOption[] = [\n  { value: 'kinase_inhibitor', label: 'Kinase Inhibitor', description: 'Blocks protein kinase enzymes', count: 234, popular: true },\n  { value: 'monoclonal_antibody', label: 'Monoclonal Antibody', description: 'Engineered antibodies', count: 187, popular: true },\n  { value: 'checkpoint_inhibitor', label: 'Checkpoint Inhibitor', description: 'Immune checkpoint blockade', count: 45, popular: true },\n  { value: 'alkylating_agent', label: 'Alkylating Agent', description: 'DNA crosslinking compounds', count: 156 },\n  { value: 'antimetabolite', label: 'Antimetabolite', description: 'Interferes with DNA/RNA synthesis', count: 123 },\n  { value: 'topoisomerase_inhibitor', label: 'Topoisomerase Inhibitor', description: 'Prevents DNA unwinding', count: 98 },\n  { value: 'proteasome_inhibitor', label: 'Proteasome Inhibitor', description: 'Blocks protein degradation', count: 34 },\n  { value: 'angiogenesis_inhibitor', label: 'Angiogenesis Inhibitor', description: 'Prevents blood vessel formation', count: 67 },\n  { value: 'histone_deacetylase_inhibitor', label: 'HDAC Inhibitor', description: 'Epigenetic modifier', count: 29 },\n  { value: 'mtor_inhibitor', label: 'mTOR Inhibitor', description: 'Blocks mTOR pathway', count: 23 },\n  { value: 'cyclin_dependent_kinase_inhibitor', label: 'CDK Inhibitor', description: 'Cell cycle inhibitor', count: 18 },\n  { value: 'poly_adp_ribose_polymerase_inhibitor', label: 'PARP Inhibitor', description: 'DNA repair inhibitor', count: 12 }\n];\n\nconst INDICATION_OPTIONS: FilterOption[] = [\n  { value: 'breast_cancer', label: 'Breast Cancer', description: 'Malignant breast tumors', count: 456, popular: true },\n  { value: 'lung_cancer', label: 'Lung Cancer', description: 'Non-small cell and small cell', count: 423, popular: true },\n  { value: 'colorectal_cancer', label: 'Colorectal Cancer', description: 'Colon and rectal cancers', count: 234, popular: true },\n  { value: 'melanoma', label: 'Melanoma', description: 'Malignant skin cancer', count: 156, popular: true },\n  { value: 'leukemia', label: 'Leukemia', description: 'Blood cancer varieties', count: 189 },\n  { value: 'lymphoma', label: 'Lymphoma', description: 'Lymphatic system cancers', count: 167 },\n  { value: 'prostate_cancer', label: 'Prostate Cancer', description: 'Male reproductive cancer', count: 145 },\n  { value: 'ovarian_cancer', label: 'Ovarian Cancer', description: 'Female reproductive cancer', count: 123 },\n  { value: 'pancreatic_cancer', label: 'Pancreatic Cancer', description: 'Digestive system cancer', count: 98 },\n  { value: 'renal_cell_carcinoma', label: 'Renal Cell Carcinoma', description: 'Kidney cancer', count: 87 },\n  { value: 'hepatocellular_carcinoma', label: 'Hepatocellular Carcinoma', description: 'Liver cancer', count: 76 },\n  { value: 'glioblastoma', label: 'Glioblastoma', description: 'Aggressive brain tumor', count: 65 },\n  { value: 'sarcoma', label: 'Sarcoma', description: 'Connective tissue cancer', count: 54 },\n  { value: 'multiple_myeloma', label: 'Multiple Myeloma', description: 'Plasma cell cancer', count: 43 },\n  { value: 'bladder_cancer', label: 'Bladder Cancer', description: 'Urinary system cancer', count: 32 }\n];\n\nconst BIOMARKER_OPTIONS: FilterOption[] = [\n  { value: 'her2_positive', label: 'HER2 Positive', description: 'HER2 protein overexpression', count: 234, popular: true },\n  { value: 'er_pr_positive', label: 'ER/PR Positive', description: 'Hormone receptor positive', count: 198, popular: true },\n  { value: 'triple_negative', label: 'Triple Negative', description: 'ER-, PR-, HER2- breast cancer', count: 123, popular: true },\n  { value: 'egfr_mutation', label: 'EGFR Mutation', description: 'EGFR gene alterations', count: 187, popular: true },\n  { value: 'kras_mutation', label: 'KRAS Mutation', description: 'KRAS oncogene mutations', count: 156 },\n  { value: 'brca_mutation', label: 'BRCA Mutation', description: 'BRCA1/2 gene mutations', count: 89 },\n  { value: 'pd_l1_positive', label: 'PD-L1 Positive', description: 'PD-L1 expression ≥1%', count: 167 },\n  { value: 'msi_high', label: 'MSI-High', description: 'Microsatellite instability', count: 78 },\n  { value: 'tmb_high', label: 'TMB-High', description: 'High tumor mutation burden', count: 67 },\n  { value: 'braf_mutation', label: 'BRAF Mutation', description: 'BRAF V600E mutations', count: 98 },\n  { value: 'alk_fusion', label: 'ALK Fusion', description: 'ALK gene rearrangements', count: 45 },\n  { value: 'ros1_fusion', label: 'ROS1 Fusion', description: 'ROS1 gene fusions', count: 23 },\n  { value: 'ntrk_fusion', label: 'NTRK Fusion', description: 'NTRK gene fusions', count: 18 },\n  { value: 'ret_fusion', label: 'RET Fusion', description: 'RET gene rearrangements', count: 34 },\n  { value: 'met_amplification', label: 'MET Amplification', description: 'MET gene amplification', count: 29 }\n];\n\nconst APPROVAL_STATUS_OPTIONS: FilterOption[] = [\n  { value: 'fda_approved', label: 'FDA Approved', description: 'Full FDA approval', count: 1456, popular: true },\n  { value: 'accelerated_approval', label: 'Accelerated Approval', description: 'FDA accelerated pathway', count: 89 },\n  { value: 'breakthrough_therapy', label: 'Breakthrough Therapy', description: 'FDA breakthrough designation', count: 67 },\n  { value: 'fast_track', label: 'Fast Track', description: 'FDA fast track status', count: 123 },\n  { value: 'orphan_drug', label: 'Orphan Drug', description: 'Rare disease designation', count: 234 },\n  { value: 'priority_review', label: 'Priority Review', description: 'Expedited FDA review', count: 156 },\n  { value: 'ema_approved', label: 'EMA Approved', description: 'European approval', count: 1234 },\n  { value: 'conditional_approval', label: 'Conditional Approval', description: 'Conditional marketing authorization', count: 45 },\n  { value: 'investigational', label: 'Investigational', description: 'In clinical trials', count: 567 }\n];\n\nconst CLINICAL_TRIAL_PHASE_OPTIONS: FilterOption[] = [\n  { value: 'approved', label: 'FDA Approved', description: 'Marketed drugs', count: 1456, popular: true },\n  { value: 'phase_4', label: 'Phase IV', description: 'Post-marketing surveillance', count: 234 },\n  { value: 'phase_3', label: 'Phase III', description: 'Large-scale efficacy trials', count: 345, popular: true },\n  { value: 'phase_2', label: 'Phase II', description: 'Dose-finding and efficacy', count: 567 },\n  { value: 'phase_1', label: 'Phase I', description: 'First-in-human safety', count: 789 },\n  { value: 'phase_1_2', label: 'Phase I/II', description: 'Combined early phases', count: 123 },\n  { value: 'phase_2_3', label: 'Phase II/III', description: 'Combined late phases', count: 89 },\n  { value: 'investigational', label: 'Investigational', description: 'All trial phases', count: 1234 }\n];\n\nconst FilterAutocomplete: React.FC<FilterAutocompleteProps> = ({\n  options,\n  selectedValues,\n  onSelectionChange,\n  placeholder = \"Select options...\",\n  label,\n  maxSelection,\n  searchable = true,\n  showCounts = true,\n  className = \"\"\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filteredOptions, setFilteredOptions] = useState(options);\n  \n  const containerRef = useRef<HTMLDivElement>(null);\n  const searchInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (!searchTerm.trim()) {\n      // Show popular options first when no search\n      const sorted = [...options].sort((a, b) => {\n        if (a.popular && !b.popular) return -1;\n        if (!a.popular && b.popular) return 1;\n        return (b.count || 0) - (a.count || 0);\n      });\n      setFilteredOptions(sorted);\n    } else {\n      const filtered = options.filter(option =>\n        option.label.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        option.description?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        option.value.toLowerCase().includes(searchTerm.toLowerCase())\n      );\n      setFilteredOptions(filtered);\n    }\n  }, [searchTerm, options]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleOptionToggle = (value: string) => {\n    const isSelected = selectedValues.includes(value);\n    let newValues: string[];\n\n    if (isSelected) {\n      newValues = selectedValues.filter(v => v !== value);\n    } else {\n      if (maxSelection && selectedValues.length >= maxSelection) {\n        return; // Don't add if max selection reached\n      }\n      newValues = [...selectedValues, value];\n    }\n\n    onSelectionChange(newValues);\n  };\n\n  const removeValue = (value: string) => {\n    onSelectionChange(selectedValues.filter(v => v !== value));\n  };\n\n  const clearAll = () => {\n    onSelectionChange([]);\n  };\n\n  const getSelectedLabels = () => {\n    return selectedValues.map(value => {\n      const option = options.find(opt => opt.value === value);\n      return option?.label || value;\n    });\n  };\n\n  return (\n    <div ref={containerRef} className={`relative ${className}`}>\n      {label && (\n        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n          {label}\n        </label>\n      )}\n      \n      {/* Selected Values Display */}\n      {selectedValues.length > 0 && (\n        <div className=\"flex flex-wrap gap-1 mb-2\">\n          {selectedValues.map(value => {\n            const option = options.find(opt => opt.value === value);\n            return (\n              <span\n                key={value}\n                className=\"inline-flex items-center px-2 py-1 rounded-full text-xs bg-violet-100 text-violet-800\"\n              >\n                {option?.label || value}\n                <button\n                  onClick={() => removeValue(value)}\n                  className=\"ml-1 text-violet-600 hover:text-violet-800\"\n                >\n                  <X className=\"h-3 w-3\" />\n                </button>\n              </span>\n            );\n          })}\n          {selectedValues.length > 1 && (\n            <button\n              onClick={clearAll}\n              className=\"inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-600 hover:bg-gray-200\"\n            >\n              Clear all\n            </button>\n          )}\n        </div>\n      )}\n\n      {/* Trigger Button */}\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"w-full flex items-center justify-between px-3 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-50 focus:ring-2 focus:ring-violet-500 focus:border-violet-500\"\n      >\n        <span className={`text-sm ${selectedValues.length === 0 ? 'text-gray-500' : 'text-gray-900'}`}>\n          {selectedValues.length === 0 \n            ? placeholder \n            : `${selectedValues.length} selected`\n          }\n        </span>\n        <ChevronDown className={`h-4 w-4 text-gray-400 transition-transform ${isOpen ? 'rotate-180' : ''}`} />\n      </button>\n\n      {/* Dropdown */}\n      {isOpen && (\n        <div className=\"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-80 overflow-hidden\">\n          {/* Search Input */}\n          {searchable && (\n            <div className=\"p-3 border-b\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                <input\n                  ref={searchInputRef}\n                  type=\"text\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  placeholder=\"Search options...\"\n                  className=\"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-violet-500 focus:border-violet-500\"\n                />\n              </div>\n            </div>\n          )}\n\n          {/* Options List */}\n          <div className=\"max-h-60 overflow-y-auto\">\n            {filteredOptions.length > 0 ? (\n              filteredOptions.map(option => (\n                <button\n                  key={option.value}\n                  onMouseDown={(e) => { e.preventDefault(); /* avoid input blur swallowing click */ }}\n                  onClick={() => handleOptionToggle(option.value)}\n                  className=\"w-full flex items-center justify-between px-3 py-2 text-left hover:bg-gray-50 focus:bg-gray-50\"\n                  disabled={maxSelection && selectedValues.length >= maxSelection && !selectedValues.includes(option.value)}\n                >\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center space-x-2\">\n                      <span className={`text-sm font-medium ${\n                        selectedValues.includes(option.value) ? 'text-violet-700' : 'text-gray-900'\n                      }`}>\n                        {option.label}\n                      </span>\n                      {option.popular && (\n                        <span className=\"px-1.5 py-0.5 text-xs bg-yellow-100 text-yellow-800 rounded-full\">\n                          Popular\n                        </span>\n                      )}\n                    </div>\n                    {option.description && (\n                      <p className=\"text-xs text-gray-500 mt-0.5 truncate\">\n                        {option.description}\n                      </p>\n                    )}\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2 ml-2\">\n                    {showCounts && option.count && (\n                      <span className=\"text-xs text-gray-400\">\n                        {option.count}\n                      </span>\n                    )}\n                    {selectedValues.includes(option.value) && (\n                      <Check className=\"h-4 w-4 text-violet-600\" />\n                    )}\n                  </div>\n                </button>\n              ))\n            ) : (\n              <div className=\"px-3 py-4 text-center text-gray-500\">\n                <Search className=\"h-6 w-6 mx-auto mb-2 text-gray-300\" />\n                <p className=\"text-sm\">No options found</p>\n              </div>\n            )}\n          </div>\n\n          {/* Footer */}\n          {filteredOptions.length > 0 && (\n            <div className=\"px-3 py-2 bg-gray-50 border-t text-xs text-gray-500 text-center\">\n              {selectedValues.length > 0 && (\n                <span>{selectedValues.length} selected • </span>\n              )}\n              {filteredOptions.length} option{filteredOptions.length !== 1 ? 's' : ''}\n              {maxSelection && (\n                <span> • Max {maxSelection}</span>\n              )}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default FilterAutocomplete;\nexport {\n  THERAPEUTIC_CLASS_OPTIONS,\n  MECHANISM_OPTIONS,\n  INDICATION_OPTIONS,\n  BIOMARKER_OPTIONS,\n  APPROVAL_STATUS_OPTIONS,\n  CLINICAL_TRIAL_PHASE_OPTIONS\n};\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport {\n  Search,\n  Brain,\n  Target,\n  Zap,\n  Activity,\n  Microscope,\n  Pill,\n  Heart,\n  Shield,\n  Sparkles,\n  Filter,\n  TrendingUp,\n  Clock,\n  CheckCircle,\n  AlertTriangle,\n  BookOpen,\n  BarChart3,\n  Users,\n  Globe,\n  RefreshCw,\n  Download,\n  Upload,\n  Settings,\n  Info,\n  Star,\n  ChevronDown,\n  ChevronUp,\n  X,\n  Plus,\n  Minus\n} from 'lucide-react';\nimport Card from '../UI/Card';\nimport EnhancedDrugResults from './EnhancedDrugResults';\nimport { togglePin } from '../../utils/pins';\nimport SolidDrugSearch from './SolidDrugSearch';\nimport FilterAutocomplete, {\n  THERAPEUTIC_CLASS_OPTIONS,\n  MECHANISM_OPTIONS,\n  INDICATION_OPTIONS,\n  BIOMARKER_OPTIONS,\n  APPROVAL_STATUS_OPTIONS,\n  CLINICAL_TRIAL_PHASE_OPTIONS\n} from './FilterAutocomplete';\n\ninterface DrugSearchFilters {\n  query: string;\n  drugType: string[];\n  therapeuticClass: string[];\n  mechanismOfAction: string[];\n  indication: string[];\n  biomarker: string[];\n  approvalStatus: string[];\n  clinicalTrialPhase: string[];\n  hasInteractions: boolean;\n  hasGenomicFactors: boolean;\n  requiresMonitoring: boolean;\n  isOncologyDrug: boolean;\n  isOrphanDrug: boolean;\n  hasBlackBoxWarning: boolean;\n}\n\ninterface AISearchSuggestion {\n  type: 'drug' | 'indication' | 'mechanism' | 'biomarker' | 'class' | 'symptom';\n  text: string;\n  confidence: number;\n  category: string;\n  description?: string;\n  relevantDrugs?: string[];\n  alternativeTerms?: string[];\n}\n\ninterface SmartRecommendation {\n  id: string;\n  title: string;\n  description: string;\n  type: 'similar_drugs' | 'alternative_therapy' | 'combination' | 'monitoring' | 'contraindication';\n  confidence: number;\n  evidence_level: 'high' | 'moderate' | 'low';\n  drug_suggestions?: string[];\n  reasoning: string;\n}\n\nconst ImprovedDrugSearch: React.FC<{ onOfflineChange?: (offline: boolean) => void }> = ({ onOfflineChange }) => {\n  const navigate = useNavigate();\n  const [filters, setFilters] = useState<DrugSearchFilters>({\n    query: '',\n    drugType: [],\n    therapeuticClass: [],\n    mechanismOfAction: [],\n    indication: [],\n    biomarker: [],\n    approvalStatus: [],\n    clinicalTrialPhase: [],\n    hasInteractions: false,\n    hasGenomicFactors: false,\n    requiresMonitoring: false,\n    isOncologyDrug: false,\n    isOrphanDrug: false,\n    hasBlackBoxWarning: false\n  });\n\n  const [searchSuggestions, setSearchSuggestions] = useState<AISearchSuggestion[]>([]);\n  const [recommendations, setRecommendations] = useState<SmartRecommendation[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);\n  const [aiMode, setAiMode] = useState<'search' | 'recommend' | 'analyze'>('search');\n  const [activeTab, setActiveTab] = useState('therapeutic');\n  const [serverSuggestions, setServerSuggestions] = useState<Array<{ name: string; rxcui?: string | null }>>([]);\n  const [serverSuggestionsOffline, setServerSuggestionsOffline] = useState<boolean>(false);\n  const [serverSuggestionsLoading, setServerSuggestionsLoading] = useState<boolean>(false);\n  const [searchLoading, setSearchLoading] = useState<boolean>(false);\n  const [searchError, setSearchError] = useState<string | null>(null);\n  const [searchResults, setSearchResults] = useState<any[]>([]);\n  const [pinnedOnly, setPinnedOnly] = useState<boolean>(false);\n  const [selectedRxcui, setSelectedRxcui] = useState<string | null>(null);\n  const [variants, setVariants] = useState<Array<{ rxcui: string; name: string; tty: string }>>([]);\n  const [variantError, setVariantError] = useState<string | null>(null);\n  const [variantLoading, setVariantLoading] = useState<boolean>(false);\n  const [details, setDetails] = useState<any | null>(null);\n  const [detailsLoading, setDetailsLoading] = useState<boolean>(false);\n  const [detailsError, setDetailsError] = useState<string | null>(null);\n  const [interactionSummary, setInteractionSummary] = useState<{ total: number; major: number; moderate: number; minor: number } | null>(null);\n  const [interactionLoading, setInteractionLoading] = useState<boolean>(false);\n  const [interactionError, setInteractionError] = useState<string | null>(null);\n\n  const filterOptions = {\n    drugType: [\n      { value: 'brand', label: 'Brand Name' },\n      { value: 'generic', label: 'Generic' },\n      { value: 'biosimilar', label: 'Biosimilar' },\n      { value: 'combination', label: 'Combination' },\n      { value: 'investigational', label: 'Investigational' }\n    ],\n    therapeuticClass: [\n      { value: 'antineoplastic', label: 'Antineoplastic Agents' },\n      { value: 'immunotherapy', label: 'Immunotherapy' },\n      { value: 'targeted_therapy', label: 'Targeted Therapy' },\n      { value: 'chemotherapy', label: 'Chemotherapy' },\n      { value: 'hormone_therapy', label: 'Hormone Therapy' },\n      { value: 'supportive_care', label: 'Supportive Care' },\n      { value: 'pain_management', label: 'Pain Management' },\n      { value: 'antiemetic', label: 'Antiemetic' }\n    ],\n    mechanismOfAction: [\n      { value: 'kinase_inhibitor', label: 'Kinase Inhibitor' },\n      { value: 'monoclonal_antibody', label: 'Monoclonal Antibody' },\n      { value: 'checkpoint_inhibitor', label: 'Checkpoint Inhibitor' },\n      { value: 'alkylating_agent', label: 'Alkylating Agent' },\n      { value: 'antimetabolite', label: 'Antimetabolite' },\n      { value: 'topoisomerase_inhibitor', label: 'Topoisomerase Inhibitor' },\n      { value: 'proteasome_inhibitor', label: 'Proteasome Inhibitor' },\n      { value: 'angiogenesis_inhibitor', label: 'Angiogenesis Inhibitor' }\n    ],\n    indication: [\n      { value: 'breast_cancer', label: 'Breast Cancer' },\n      { value: 'lung_cancer', label: 'Lung Cancer' },\n      { value: 'colorectal_cancer', label: 'Colorectal Cancer' },\n      { value: 'melanoma', label: 'Melanoma' },\n      { value: 'leukemia', label: 'Leukemia' },\n      { value: 'lymphoma', label: 'Lymphoma' },\n      { value: 'prostate_cancer', label: 'Prostate Cancer' },\n      { value: 'ovarian_cancer', label: 'Ovarian Cancer' },\n      { value: 'pancreatic_cancer', label: 'Pancreatic Cancer' },\n      { value: 'brain_tumor', label: 'Brain Tumor' }\n    ],\n    biomarker: [\n      { value: 'her2_positive', label: 'HER2+' },\n      { value: 'er_pr_positive', label: 'ER/PR+' },\n      { value: 'triple_negative', label: 'Triple Negative' },\n      { value: 'egfr_mutation', label: 'EGFR Mutation' },\n      { value: 'kras_mutation', label: 'KRAS Mutation' },\n      { value: 'brca_mutation', label: 'BRCA1/2 Mutation' },\n      { value: 'pd_l1_positive', label: 'PD-L1+' },\n      { value: 'msi_high', label: 'MSI-H' },\n      { value: 'tmb_high', label: 'TMB-H' }\n    ],\n    approvalStatus: [\n      { value: 'fda_approved', label: 'FDA Approved' },\n      { value: 'ema_approved', label: 'EMA Approved' },\n      { value: 'breakthrough_therapy', label: 'Breakthrough Therapy' },\n      { value: 'fast_track', label: 'Fast Track' },\n      { value: 'orphan_drug', label: 'Orphan Drug' },\n      { value: 'conditional_approval', label: 'Conditional Approval' }\n    ],\n    clinicalTrialPhase: [\n      { value: 'phase_1', label: 'Phase I' },\n      { value: 'phase_2', label: 'Phase II' },\n      { value: 'phase_3', label: 'Phase III' },\n      { value: 'phase_4', label: 'Phase IV' },\n      { value: 'post_marketing', label: 'Post-Marketing' }\n    ]\n  };\n\n  const generateAISuggestions = async (query: string): Promise<AISearchSuggestion[]> => {\n    if (!query || query.length < 2) return [];\n\n    const mockSuggestions: AISearchSuggestion[] = [\n      {\n        type: 'drug',\n        text: 'pembrolizumab',\n        confidence: 0.95,\n        category: 'PD-1 Inhibitor',\n        description: 'Checkpoint inhibitor for multiple cancer types',\n        relevantDrugs: ['nivolumab', 'atezolizumab'],\n        alternativeTerms: ['Keytruda', 'PD-1 inhibitor']\n      },\n      {\n        type: 'indication',\n        text: 'non-small cell lung cancer',\n        confidence: 0.88,\n        category: 'Oncology',\n        description: 'Most common type of lung cancer',\n        relevantDrugs: ['osimertinib', 'erlotinib', 'gefitinib']\n      },\n      {\n        type: 'mechanism',\n        text: 'EGFR tyrosine kinase inhibitor',\n        confidence: 0.82,\n        category: 'Targeted Therapy',\n        description: 'Targets EGFR signaling pathway',\n        relevantDrugs: ['osimertinib', 'erlotinib', 'afatinib']\n      }\n    ];\n\n    return mockSuggestions.filter(s => \n      s.text.toLowerCase().includes(query.toLowerCase()) ||\n      s.category.toLowerCase().includes(query.toLowerCase()) ||\n      s.alternativeTerms?.some(term => term.toLowerCase().includes(query.toLowerCase()))\n    );\n  };\n\n  useEffect(() => {\n    const timer = setTimeout(async () => {\n      if (filters.query) {\n        const suggestions = await generateAISuggestions(filters.query);\n        setSearchSuggestions(suggestions);\n      }\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [filters.query]);\n\n  // Fetch server suggestions for the visible query (debounced)\n  useEffect(() => {\n    let abort = false;\n    if (!filters.query || filters.query.trim().length < 2) {\n      setServerSuggestions([]);\n      setServerSuggestionsOffline(false);\n      return;\n    }\n    setServerSuggestionsLoading(true);\n    const t = setTimeout(async () => {\n      try {\n        const resp = await fetch(`/api/drugs/suggestions?q=${encodeURIComponent(filters.query)}&limit=8`);\n        if (!resp.ok) throw new Error('suggestions failed');\n        const data = await resp.json();\n        if (abort) return;\n        setServerSuggestions((data.suggestions || []).map((s: any) => ({ name: s.name, rxcui: s.rxcui })));\n        setServerSuggestionsOffline(!!data.offline);\n        onOfflineChange?.(!!data.offline);\n      } catch {\n        if (!abort) {\n          // Graceful offline fallback with a small local list\n          const LOCAL: Array<{ name: string; rxcui?: string | null }> = [\n            { name: 'aspirin' },\n            { name: 'ibuprofen' },\n            { name: 'acetaminophen' },\n            { name: 'clopidogrel' },\n            { name: 'warfarin' },\n            { name: 'omeprazole' },\n            { name: 'simvastatin' },\n            { name: 'levodopa' },\n          ];\n          const q = filters.query.toLowerCase();\n          const fallback = LOCAL.filter(d => d.name.includes(q)).slice(0, 8);\n          setServerSuggestions(fallback);\n          setServerSuggestionsOffline(true);\n          onOfflineChange?.(true);\n        }\n      } finally {\n        if (!abort) setServerSuggestionsLoading(false);\n      }\n    }, 300);\n    return () => { abort = true; clearTimeout(t); };\n  }, [filters.query, onOfflineChange]);\n\n  const handleFilterChange = (category: keyof DrugSearchFilters, value: any) => {\n    setFilters(prev => ({\n      ...prev,\n      [category]: value\n    }));\n  };\n\n  const handleMultiSelectFilter = (category: keyof DrugSearchFilters, value: string) => {\n    setFilters(prev => {\n      const currentValues = prev[category] as string[];\n      const newValues = currentValues.includes(value)\n        ? currentValues.filter(v => v !== value)\n        : [...currentValues, value];\n      \n      return {\n        ...prev,\n        [category]: newValues\n      };\n    });\n  };\n\n  const runSearch = async () => {\n    const q = (filters.query || '').trim();\n    if (q.length < 2) return;\n    setSearchLoading(true);\n    setSearchError(null);\n    setSearchResults([]);\n    try {\n      const resp = await fetch(`/api/drugs/search?q=${encodeURIComponent(q)}`);\n      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n      const data = await resp.json();\n      const results = Array.isArray(data?.results) ? data.results : [];\n      setSearchResults(results);\n    } catch (e: any) {\n      setSearchError(e?.message || 'Search failed');\n    } finally {\n      setSearchLoading(false);\n    }\n  };\n\n  // Load variants on selected RXCUI change\n  useEffect(() => {\n    const loadVariants = async () => {\n      if (!selectedRxcui) { setVariants([]); setVariantError(null); return; }\n      setVariantLoading(true);\n      setVariantError(null);\n      try {\n        const resp = await fetch(`/api/drugs/${encodeURIComponent(selectedRxcui)}/variants`);\n        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n        const data = await resp.json();\n        setVariants(Array.isArray(data?.variants) ? data.variants : []);\n      } catch (e: any) {\n        setVariantError(e?.message || 'Failed to load variations');\n        setVariants([]);\n      } finally {\n        setVariantLoading(false);\n      }\n    };\n    loadVariants();\n  }, [selectedRxcui]);\n\n  // Load details for selected RXCUI\n  useEffect(() => {\n    const loadDetails = async () => {\n      if (!selectedRxcui) { setDetails(null); setDetailsError(null); return; }\n      setDetailsLoading(true);\n      setDetailsError(null);\n      try {\n        const resp = await fetch(`/api/drugs/${encodeURIComponent(selectedRxcui)}`);\n        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n        const data = await resp.json();\n        setDetails(data);\n      } catch (e: any) {\n        setDetailsError(e?.message || 'Failed to load details');\n        setDetails(null);\n      } finally {\n        setDetailsLoading(false);\n      }\n    };\n    loadDetails();\n  }, [selectedRxcui]);\n\n  // Load interaction summary for selected RXCUI\n  useEffect(() => {\n    const load = async () => {\n      if (!selectedRxcui) { setInteractionSummary(null); setInteractionError(null); return; }\n      setInteractionLoading(true);\n      setInteractionError(null);\n      try {\n        const resp = await fetch(`/api/drugs/${encodeURIComponent(selectedRxcui)}/interactions`);\n        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n        const data = await resp.json();\n        const stored = data?.interactions?.stored || [];\n        const external = data?.interactions?.external || [];\n        const all = [...stored, ...external];\n        const sev = (s: any) => String(s || '').toLowerCase();\n        const major = all.filter((i: any) => sev(i.severity).includes('major') || sev(i.severity).includes('high')).length;\n        const moderate = all.filter((i: any) => sev(i.severity).includes('moderate')).length;\n        const minor = all.filter((i: any) => sev(i.severity).includes('minor') || sev(i.severity).includes('low')).length;\n        setInteractionSummary({ total: all.length, major, moderate, minor });\n      } catch (e: any) {\n        setInteractionError(e?.message || 'Failed to load interaction summary');\n        setInteractionSummary(null);\n      } finally {\n        setInteractionLoading(false);\n      }\n    };\n    load();\n  }, [selectedRxcui]);\n\n  // duplicate variants loader removed\n\n  const clearAllFilters = () => {\n    setFilters({\n      query: '',\n      drugType: [],\n      therapeuticClass: [],\n      mechanismOfAction: [],\n      indication: [],\n      biomarker: [],\n      approvalStatus: [],\n      clinicalTrialPhase: [],\n      hasInteractions: false,\n      hasGenomicFactors: false,\n      requiresMonitoring: false,\n      isOncologyDrug: false,\n      isOrphanDrug: false,\n      hasBlackBoxWarning: false\n    });\n  };\n\n  const getActiveFiltersCount = () => {\n    let count = 0;\n    Object.entries(filters).forEach(([key, value]) => {\n      if (key === 'query') return;\n      if (Array.isArray(value) && value.length > 0) count++;\n      if (typeof value === 'boolean' && value) count++;\n    });\n    return count;\n  };\n\n  const renderEnhancedFilter = (\n    category: keyof DrugSearchFilters,\n    options: any[],\n    title: string,\n    icon: React.ReactNode\n  ) => {\n    const selectedValues = filters[category] as string[];\n    \n    return (\n      <Card className=\"p-4\">\n        <div className=\"flex items-center space-x-2 mb-3\">\n          {icon}\n          <h4 className=\"font-medium text-gray-900\">{title}</h4>\n        </div>\n        <FilterAutocomplete\n          options={options}\n          selectedValues={selectedValues}\n          onSelectionChange={(values) => {\n            setFilters(prev => ({ ...prev, [category]: values }));\n          }}\n          placeholder={`Select ${title.toLowerCase()}...`}\n          searchable={true}\n          showCounts={true}\n          maxSelection={5}\n        />\n      </Card>\n    );\n  };\n\n  const TabButton = ({ isActive, onClick, children }: { isActive: boolean; onClick: () => void; children: React.ReactNode }) => (\n    <button\n      onClick={onClick}\n      className={`px-4 py-2 text-sm font-medium rounded-lg ${\n        isActive \n          ? 'bg-violet-100 text-violet-700 border border-violet-200' \n          : 'text-gray-600 hover:text-gray-800 hover:bg-gray-100'\n      }`}\n    >\n      {children}\n    </button>\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* AI-Powered Search Interface */}\n      <Card className=\"border-violet-200 bg-gradient-to-r from-violet-50 to-indigo-50\">\n        <div className=\"p-6\">\n          <div className=\"flex items-center space-x-2 mb-4\">\n            <Brain className=\"h-6 w-6 text-violet-600\" />\n            <h2 className=\"text-xl font-bold text-violet-800\">AI-Enhanced Drug Search</h2>\n            <span className=\"px-3 py-1 bg-violet-100 text-violet-800 rounded-full text-sm font-medium\">\n              Neural Engine v2.0\n            </span>\n          </div>\n          \n          {/* Main Search Input with Autocomplete */}\n          <div className=\"mb-4\">\n            <SolidDrugSearch\n              placeholder=\"Search by drug name, indication, mechanism, biomarker, or ask a question...\"\n              value={filters.query}\n              onChange={(v) => handleFilterChange('query', v)}\n              onSelect={(opt) => {\n                handleFilterChange('query', opt.name);\n                if (opt.rxcui && /^\\d+$/.test(String(opt.rxcui))) {\n                  setSelectedRxcui(String(opt.rxcui));\n                }\n              }}\n              maxResults={12}\n              onOfflineChange={onOfflineChange}\n              onAutoResolve={(opt) => {\n                // Auto-populate choices when user input exactly matches a drug\n                handleFilterChange('query', opt.name);\n                if (opt.rxcui && /^\\d+$/.test(String(opt.rxcui))) {\n                  setSelectedRxcui(String(opt.rxcui));\n                }\n              }}\n            />\n          </div>\n\n          {/* Server suggestions panel removed: SolidDrugSearch handles suggestions */}\n\n          {/* AI Search Suggestions */}\n          {searchSuggestions.length > 0 && (\n            <div className=\"bg-white border border-gray-200 rounded-lg shadow-lg mb-4\">\n              <div className=\"p-3 border-b border-gray-100\">\n                <div className=\"flex items-center space-x-2\">\n                  <Sparkles className=\"h-4 w-4 text-violet-600\" />\n                  <span className=\"text-sm font-medium text-gray-700\">AI Suggestions</span>\n                </div>\n              </div>\n              <div className=\"max-h-64 overflow-y-auto\">\n                {searchSuggestions.map((suggestion, index) => (\n                  <button\n                    key={index}\n                    onClick={() => handleFilterChange('query', suggestion.text)}\n                    className=\"w-full flex items-center space-x-3 p-3 hover:bg-gray-50 text-left\"\n                  >\n                    <div className=\"flex-shrink-0\">\n                      {suggestion.type === 'drug' && <Pill className=\"h-4 w-4 text-blue-500\" />}\n                      {suggestion.type === 'indication' && <Target className=\"h-4 w-4 text-red-500\" />}\n                      {suggestion.type === 'mechanism' && <Zap className=\"h-4 w-4 text-purple-500\" />}\n                      {suggestion.type === 'biomarker' && <Activity className=\"h-4 w-4 text-green-500\" />}\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"font-medium text-gray-900\">{suggestion.text}</div>\n                      <div className=\"text-xs text-gray-500\">{suggestion.category}</div>\n                      {suggestion.description && (\n                        <div className=\"text-xs text-gray-400 mt-1\">{suggestion.description}</div>\n                      )}\n                    </div>\n                    <div className=\"text-xs text-gray-400\">\n                      {Math.round(suggestion.confidence * 100)}%\n                    </div>\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* AI Mode Selector */}\n          <div className=\"flex items-center space-x-2\">\n            <span className=\"text-sm font-medium text-gray-700\">AI Mode:</span>\n            <div className=\"flex bg-gray-100 rounded-lg p-1\">\n              {[\n                { mode: 'search', label: 'Smart Search', icon: Search },\n                { mode: 'recommend', label: 'Recommendations', icon: Target },\n                { mode: 'analyze', label: 'Deep Analysis', icon: BarChart3 }\n              ].map(({ mode, label, icon: Icon }) => (\n                <button\n                  key={mode}\n                  onClick={() => setAiMode(mode as typeof aiMode)}\n                  className={`flex items-center space-x-2 px-3 py-1 rounded-md text-sm font-medium transition-all ${\n                    aiMode === mode\n                      ? 'bg-white text-violet-600 shadow-sm'\n                      : 'text-gray-600 hover:text-gray-800'\n                  }`}\n                >\n                  <Icon className=\"h-4 w-4\" />\n                  <span>{label}</span>\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n      </Card>\n\n      {/* Advanced Filters */}\n      <Card>\n        <div className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center space-x-2\">\n              <Filter className=\"h-5 w-5 text-gray-600\" />\n              <h2 className=\"text-xl font-bold text-gray-900\">Advanced Filters</h2>\n              {getActiveFiltersCount() > 0 && (\n                <span className=\"px-2 py-1 bg-violet-100 text-violet-800 rounded-full text-sm font-medium\">\n                  {getActiveFiltersCount()} active\n                </span>\n              )}\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <button\n                onClick={clearAllFilters}\n                className=\"px-3 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50\"\n              >\n                Clear All\n              </button>\n              <button\n                onClick={() => setShowAdvancedFilters(!showAdvancedFilters)}\n                className=\"px-3 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center space-x-1\"\n              >\n                {showAdvancedFilters ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                <span>{showAdvancedFilters ? 'Hide' : 'Show'} Filters</span>\n              </button>\n            </div>\n          </div>\n          \n          {showAdvancedFilters && (\n            <div className=\"space-y-4\">\n              <div className=\"flex space-x-2 mb-4\">\n                <TabButton isActive={activeTab === 'therapeutic'} onClick={() => setActiveTab('therapeutic')}>\n                  Therapeutic\n                </TabButton>\n                <TabButton isActive={activeTab === 'molecular'} onClick={() => setActiveTab('molecular')}>\n                  Molecular\n                </TabButton>\n                <TabButton isActive={activeTab === 'clinical'} onClick={() => setActiveTab('clinical')}>\n                  Clinical\n                </TabButton>\n                <TabButton isActive={activeTab === 'regulatory'} onClick={() => setActiveTab('regulatory')}>\n                  Regulatory\n                </TabButton>\n                <TabButton isActive={activeTab === 'safety'} onClick={() => setActiveTab('safety')}>\n                  Safety\n                </TabButton>\n              </div>\n\n              {activeTab === 'therapeutic' && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {renderEnhancedFilter(\n                    'therapeuticClass',\n                    THERAPEUTIC_CLASS_OPTIONS,\n                    'Therapeutic Class',\n                    <Heart className=\"h-4 w-4 text-red-500\" />\n                  )}\n                  {renderEnhancedFilter(\n                    'indication',\n                    INDICATION_OPTIONS,\n                    'Cancer Indication',\n                    <Target className=\"h-4 w-4 text-blue-500\" />\n                  )}\n                  {renderEnhancedFilter(\n                    'mechanismOfAction',\n                    MECHANISM_OPTIONS,\n                    'Mechanism of Action',\n                    <Zap className=\"h-4 w-4 text-purple-500\" />\n                  )}\n                </div>\n              )}\n\n              {activeTab === 'molecular' && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {renderEnhancedFilter(\n                    'biomarker',\n                    BIOMARKER_OPTIONS,\n                    'Biomarker Targets',\n                    <Activity className=\"h-4 w-4 text-green-500\" />\n                  )}\n                  <Card className=\"p-4\">\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center space-x-2\">\n                        <Microscope className=\"h-4 w-4 text-blue-500\" />\n                        <h4 className=\"font-medium text-gray-900\">Molecular Features</h4>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"flex items-center space-x-2 cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={filters.hasGenomicFactors}\n                            onChange={(e) => handleFilterChange('hasGenomicFactors', e.target.checked)}\n                            className=\"rounded border-gray-300 text-violet-600 focus:ring-violet-500\"\n                          />\n                          <span className=\"text-sm text-gray-700\">Has Genomic Factors</span>\n                        </label>\n                        <label className=\"flex items-center space-x-2 cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={filters.hasInteractions}\n                            onChange={(e) => handleFilterChange('hasInteractions', e.target.checked)}\n                            className=\"rounded border-gray-300 text-violet-600 focus:ring-violet-500\"\n                          />\n                          <span className=\"text-sm text-gray-700\">Has Drug Interactions</span>\n                        </label>\n                      </div>\n                    </div>\n                  </Card>\n                </div>\n              )}\n\n              {activeTab === 'clinical' && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {renderEnhancedFilter(\n                    'clinicalTrialPhase',\n                    CLINICAL_TRIAL_PHASE_OPTIONS,\n                    'Clinical Trial Phase',\n                    <Clock className=\"h-4 w-4 text-orange-500\" />\n                  )}\n                  <Card className=\"p-4\">\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center space-x-2\">\n                        <Users className=\"h-4 w-4 text-purple-500\" />\n                        <h4 className=\"font-medium text-gray-900\">Patient Factors</h4>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"flex items-center space-x-2 cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={filters.requiresMonitoring}\n                            onChange={(e) => handleFilterChange('requiresMonitoring', e.target.checked)}\n                            className=\"rounded border-gray-300 text-violet-600 focus:ring-violet-500\"\n                          />\n                          <span className=\"text-sm text-gray-700\">Requires Monitoring</span>\n                        </label>\n                        <label className=\"flex items-center space-x-2 cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={filters.isOncologyDrug}\n                            onChange={(e) => handleFilterChange('isOncologyDrug', e.target.checked)}\n                            className=\"rounded border-gray-300 text-violet-600 focus:ring-violet-500\"\n                          />\n                          <span className=\"text-sm text-gray-700\">Oncology Drugs Only</span>\n                        </label>\n                      </div>\n                    </div>\n                  </Card>\n                </div>\n              )}\n\n              {activeTab === 'regulatory' && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {renderEnhancedFilter(\n                    'approvalStatus',\n                    APPROVAL_STATUS_OPTIONS,\n                    'Approval Status',\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                  )}\n                  <Card className=\"p-4\">\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center space-x-2\">\n                        <Globe className=\"h-4 w-4 text-blue-500\" />\n                        <h4 className=\"font-medium text-gray-900\">Regulatory Features</h4>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"flex items-center space-x-2 cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={filters.isOrphanDrug}\n                            onChange={(e) => handleFilterChange('isOrphanDrug', e.target.checked)}\n                            className=\"rounded border-gray-300 text-violet-600 focus:ring-violet-500\"\n                          />\n                          <span className=\"text-sm text-gray-700\">Orphan Drug Status</span>\n                        </label>\n                      </div>\n                    </div>\n                  </Card>\n                </div>\n              )}\n\n              {activeTab === 'safety' && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  <Card className=\"p-4\">\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center space-x-2\">\n                        <Shield className=\"h-4 w-4 text-red-500\" />\n                        <h4 className=\"font-medium text-gray-900\">Safety Alerts</h4>\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"flex items-center space-x-2 cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={filters.hasBlackBoxWarning}\n                            onChange={(e) => handleFilterChange('hasBlackBoxWarning', e.target.checked)}\n                            className=\"rounded border-gray-300 text-violet-600 focus:ring-violet-500\"\n                          />\n                          <span className=\"text-sm text-gray-700\">Black Box Warning</span>\n                        </label>\n                      </div>\n                    </div>\n                  </Card>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </Card>\n\n      {/* Search Actions */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-4\">\n          <button\n            onClick={runSearch}\n            disabled={searchLoading || !filters.query || filters.query.trim().length < 2}\n            className=\"bg-gradient-to-r from-violet-600 to-indigo-600 disabled:opacity-50 text-white px-6 py-3 rounded-lg hover:from-violet-700 hover:to-indigo-700 flex items-center space-x-2\"\n          >\n            <Search className=\"h-4 w-4\" />\n            <span>Search Drugs</span>\n          </button>\n          <button className=\"border border-gray-300 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 flex items-center space-x-2\">\n            <Brain className=\"h-4 w-4\" />\n            <span>Get AI Recommendations</span>\n          </button>\n          <button className=\"border border-gray-300 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 flex items-center space-x-2\">\n            <Download className=\"h-4 w-4\" />\n            <span>Export Results</span>\n          </button>\n        </div>\n        <div className=\"text-sm text-gray-500\">\n          Powered by OncoSafeRx Neural Engine\n        </div>\n      </div>\n\n      {/* Inline Results Panel */}\n      <div className=\"mt-4\">\n        {/* Variations panel */}\n        {selectedRxcui && (\n          <div className=\"mb-3 p-3 bg-white border border-gray-200 rounded-lg\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <div className=\"text-sm font-medium text-gray-700\">Variations for RXCUI {selectedRxcui}</div>\n              {variantLoading && <div className=\"text-xs text-gray-500\">Loading…</div>}\n            </div>\n            {variantError && (\n              <div className=\"text-xs text-red-600\">{variantError}</div>\n            )}\n            {!variantError && variants.length === 0 && !variantLoading && (\n              <div className=\"text-xs text-gray-500\">No variations found</div>\n            )}\n            {variants.length > 0 && (\n              <div className=\"flex flex-wrap gap-2\">\n                {variants.slice(0, 30).map(v => (\n                  <button\n                    key={v.rxcui}\n                    onClick={() => setSelectedRxcui(v.rxcui)}\n                    className=\"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800 hover:bg-gray-200\"\n                    title={v.tty}\n                  >\n                    {v.name}\n                  </button>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Selected variant details */}\n        {selectedRxcui && (\n          <div className=\"mb-3 p-3 bg-white border border-gray-200 rounded-lg\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <div className=\"text-sm font-medium text-gray-700\">Details</div>\n              {detailsLoading && <div className=\"text-xs text-gray-500\">Loading…</div>}\n            </div>\n            {detailsError && <div className=\"text-xs text-red-600\">{detailsError}</div>}\n            {!detailsError && !detailsLoading && details && (\n              <div className=\"text-sm text-gray-800 space-y-1\">\n                <div><span className=\"text-gray-500\">Name:</span> {details.name}</div>\n                {details.generic_name && (\n                  <div><span className=\"text-gray-500\">Generic:</span> {details.generic_name}</div>\n                )}\n                {Array.isArray(details.brand_names) && details.brand_names.length > 0 && (\n                  <div><span className=\"text-gray-500\">Brands:</span> {details.brand_names.join(', ')}</div>\n                )}\n                {Array.isArray(details.dosage_forms) && details.dosage_forms.length > 0 && (\n                  <div><span className=\"text-gray-500\">Dosage forms:</span> {details.dosage_forms.join(', ')}</div>\n                )}\n                {Array.isArray(details.strengths) && details.strengths.length > 0 && (\n                  <div><span className=\"text-gray-500\">Strengths:</span> {details.strengths.join(', ')}</div>\n                )}\n                <div className=\"pt-2\">\n                  <div className=\"text-xs text-gray-500\">Interaction summary</div>\n                  {interactionLoading && <div className=\"text-xs text-gray-500\">Checking…</div>}\n                  {interactionError && <div className=\"text-xs text-red-600\">{interactionError}</div>}\n                  {!interactionLoading && !interactionError && interactionSummary && (\n                    <div className=\"flex gap-3 text-xs text-gray-700\">\n                      <span>Total: {interactionSummary.total}</span>\n                      <span>Major: {interactionSummary.major}</span>\n                      <span>Moderate: {interactionSummary.moderate}</span>\n                      <span>Minor: {interactionSummary.minor}</span>\n                    </div>\n                  )}\n                  <div className=\"mt-2 flex items-center gap-2\">\n                    <button\n                      type=\"button\"\n                      className=\"text-xs px-3 py-1 border border-gray-300 rounded hover:bg-gray-50\"\n                      onClick={() => {\n                        try {\n                          const key = 'osrx_interaction_basket';\n                          const list = JSON.parse(localStorage.getItem(key) || '[]');\n                          console.log('🔍 Adding drug to basket:', { selectedRxcui, drugName: details.name, currentBasket: list });\n                          \n                          if (!list.find((d: any) => d.id === selectedRxcui)) {\n                            list.push({ id: selectedRxcui, name: details.name });\n                            localStorage.setItem(key, JSON.stringify(list.slice(-10)));\n                            console.log('🔍 Drug added to basket:', { newBasket: list, stored: localStorage.getItem(key) });\n                          } else {\n                            console.log('🔍 Drug already in basket, not adding');\n                          }\n                          \n                          // Ensure localStorage write completes before navigation\n                          setTimeout(() => {\n                            console.log('🔍 Navigating to interactions page...');\n                            if (window.location.pathname !== '/interactions') {\n                              navigate('/interactions');\n                            }\n                          }, 150);\n                        } catch (err) {\n                          console.error('🔍 Error adding drug to basket:', err);\n                        }\n                      }}\n                    >\n                      Check interactions for this drug\n                    </button>\n                    <button\n                      type=\"button\"\n                      className=\"text-xs px-3 py-1 border border-gray-300 rounded hover:bg-gray-50\"\n                      onClick={() => {\n                        try { localStorage.setItem('osrx_selected_drug', JSON.stringify(details)); } catch {}\n                        setTimeout(() => navigate('/database'), 100);\n                      }}\n                    >\n                      View full profile\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n        {/* Inline results toolbar */}\n        <div className=\"flex items-center justify-between mb-2\">\n          <div className=\"flex items-center gap-3\">\n            <label className=\"inline-flex items-center gap-2 text-sm text-gray-700\">\n              <input\n                type=\"checkbox\"\n                checked={pinnedOnly}\n                onChange={(e) => setPinnedOnly(e.target.checked)}\n                className=\"rounded border-gray-300 text-violet-600 focus:ring-violet-500\"\n              />\n              Pinned only\n            </label>\n          </div>\n          <div>\n            <button\n              type=\"button\"\n              onClick={() => { if (window.location.pathname !== '/interactions') setTimeout(() => navigate('/interactions'), 100); }}\n              className=\"text-sm px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50\"\n            >\n              Go to Interactions\n            </button>\n          </div>\n        </div>\n        {searchLoading && (\n          <div className=\"text-sm text-gray-600\">Searching…</div>\n        )}\n        {searchError && (\n          <div className=\"text-sm text-red-600\">{searchError}</div>\n        )}\n        {!searchLoading && !searchError && searchResults.length > 0 && (\n          <EnhancedDrugResults\n            drugs={searchResults\n              .map((d: any) => ({\n              id: d.rxcui || d.id || d.name,\n              name: d.name,\n              genericName: d.generic_name || d.genericName || d.name,\n              therapeuticClass: d.insights?.therapeuticClass || d.therapeutic_class || 'Unknown',\n              mechanismOfAction: d.insights?.mechanism || d.mechanism || 'Unknown',\n              indication: d.insights?.indications || (d.indication ? [d.indication] : []),\n              fdaApproved: true,\n              safetyScore: 0,\n              efficacyScore: 0,\n              evidenceLevel: 'moderate',\n              hasInteractions: false,\n              hasGenomicFactors: false,\n              requiresMonitoring: false,\n              costTier: 'moderate',\n              routeOfAdministration: [],\n              dosageForm: [],\n              keyBenefits: [],\n              keyRisks: [],\n              commonSideEffects: [],\n              monitoringRequirements: [],\n              contraindications: [],\n              patientSuitability: [],\n              relatedDrugs: [],\n              clinicalTrials: 0,\n              publications: 0,\n              isOncologyDrug: !!d.insights?.isOncologyDrug,\n              isOrphanDrug: !!d.insights?.isOrphanDrug,\n            }))\n            .filter((drug: any) => {\n              if (!pinnedOnly) return true;\n              try {\n                const pins = JSON.parse(localStorage.getItem('oncosaferx_pins') || '{}');\n                return !!pins[String(drug.id)];\n              } catch { return false; }\n            })}\n            loading={false}\n            error={undefined}\n            onDrugSelect={(drug) => {\n              // Set the query and load details for the selected RXCUI if available\n              setFilters(prev => ({ ...prev, query: drug.name }));\n              if (drug?.id && /^\\d+$/.test(String(drug.id))) {\n                setSelectedRxcui(String(drug.id));\n              }\n            }}\n            onPin={(drug) => {\n              if (drug?.id && drug?.name) {\n                togglePin(String(drug.id), String(drug.name));\n              }\n            }}\n            onAddToInteractions={(drug) => {\n              try {\n                const key = 'osrx_interaction_basket';\n                const list = JSON.parse(localStorage.getItem(key) || '[]');\n                console.log('🔍 EnhancedDrugResults - Adding drug to basket:', { drugId: drug.id, drugName: drug.name, currentBasket: list });\n                \n                if (!list.find((d: any) => d.id === drug.id)) {\n                  list.push({ id: drug.id, name: drug.name });\n                  localStorage.setItem(key, JSON.stringify(list.slice(-10)));\n                  console.log('🔍 EnhancedDrugResults - Drug added to basket:', { newBasket: list, stored: localStorage.getItem(key) });\n                } else {\n                  console.log('🔍 EnhancedDrugResults - Drug already in basket, not adding');\n                }\n                \n                // Navigate to interactions page with proper timing\n                setTimeout(() => {\n                  console.log('🔍 EnhancedDrugResults - Navigating to interactions page...');\n                  if (window.location.pathname !== '/interactions') {\n                    navigate('/interactions');\n                  }\n                }, 150);\n              } catch (err) {\n                console.error('🔍 EnhancedDrugResults - Error adding drug to basket:', err);\n              }\n            }}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ImprovedDrugSearch;\n","import React, { useState, useEffect, useMemo, useRef } from 'react';\nimport {\n  Search,\n  ChevronDown,\n  X,\n  Pill,\n  Target,\n  Zap,\n  Activity,\n  Heart,\n  Users,\n  AlertTriangle,\n  CheckCircle,\n  Star,\n  Clock,\n  Loader2\n} from 'lucide-react';\n\ninterface AutocompleteOption {\n  id: string;\n  label: string;\n  value: string;\n  type: 'drug' | 'indication' | 'mechanism' | 'biomarker' | 'class' | 'symptom' | 'gene';\n  category: string;\n  description?: string;\n  aliases?: string[];\n  frequency?: number;\n  fdaApproved?: boolean;\n  isOncology?: boolean;\n  targetGenes?: string[];\n  relatedTerms?: string[];\n}\n\ninterface AutocompleteSearchProps {\n  placeholder?: string;\n  onSelect: (option: AutocompleteOption) => void;\n  onInputChange?: (value: string) => void;\n  value?: string;\n  maxResults?: number;\n  showCategories?: boolean;\n  allowMultiple?: boolean;\n  selectedOptions?: AutocompleteOption[];\n  disabled?: boolean;\n  loading?: boolean;\n  className?: string;\n  onOfflineChange?: (offline: boolean) => void;\n}\n\n// Comprehensive drug and medical terms database\nconst COMPREHENSIVE_OPTIONS: AutocompleteOption[] = [\n  // Popular Cancer Drugs\n  {\n    id: 'pembrolizumab',\n    label: 'Pembrolizumab (Keytruda)',\n    value: 'pembrolizumab',\n    type: 'drug',\n    category: 'PD-1 Inhibitor',\n    description: 'Immune checkpoint inhibitor for various cancers',\n    aliases: ['keytruda', 'mk-3475'],\n    frequency: 95,\n    fdaApproved: true,\n    isOncology: true,\n    targetGenes: ['PD1', 'PDL1'],\n    relatedTerms: ['immunotherapy', 'checkpoint inhibitor', 'PD-1']\n  },\n  {\n    id: 'nivolumab',\n    label: 'Nivolumab (Opdivo)',\n    value: 'nivolumab',\n    type: 'drug',\n    category: 'PD-1 Inhibitor',\n    description: 'Anti-PD-1 monoclonal antibody',\n    aliases: ['opdivo', 'bms-936558'],\n    frequency: 88,\n    fdaApproved: true,\n    isOncology: true,\n    targetGenes: ['PD1'],\n    relatedTerms: ['immunotherapy', 'melanoma', 'lung cancer']\n  },\n  {\n    id: 'trastuzumab',\n    label: 'Trastuzumab (Herceptin)',\n    value: 'trastuzumab',\n    type: 'drug',\n    category: 'HER2 Inhibitor',\n    description: 'Monoclonal antibody targeting HER2',\n    aliases: ['herceptin'],\n    frequency: 92,\n    fdaApproved: true,\n    isOncology: true,\n    targetGenes: ['HER2', 'ERBB2'],\n    relatedTerms: ['breast cancer', 'HER2 positive', 'targeted therapy']\n  },\n  {\n    id: 'imatinib',\n    label: 'Imatinib (Gleevec)',\n    value: 'imatinib',\n    type: 'drug',\n    category: 'Tyrosine Kinase Inhibitor',\n    description: 'BCR-ABL tyrosine kinase inhibitor',\n    aliases: ['gleevec', 'sti571'],\n    frequency: 85,\n    fdaApproved: true,\n    isOncology: true,\n    targetGenes: ['BCR-ABL', 'KIT', 'PDGFR'],\n    relatedTerms: ['CML', 'leukemia', 'GIST']\n  },\n  {\n    id: 'osimertinib',\n    label: 'Osimertinib (Tagrisso)',\n    value: 'osimertinib',\n    type: 'drug',\n    category: 'EGFR Inhibitor',\n    description: 'Third-generation EGFR inhibitor',\n    aliases: ['tagrisso', 'azd9291'],\n    frequency: 82,\n    fdaApproved: true,\n    isOncology: true,\n    targetGenes: ['EGFR', 'T790M'],\n    relatedTerms: ['NSCLC', 'lung cancer', 'EGFR mutation']\n  },\n  {\n    id: 'bevacizumab',\n    label: 'Bevacizumab (Avastin)',\n    value: 'bevacizumab',\n    type: 'drug',\n    category: 'VEGF Inhibitor',\n    description: 'Anti-VEGF monoclonal antibody',\n    aliases: ['avastin'],\n    frequency: 89,\n    fdaApproved: true,\n    isOncology: true,\n    targetGenes: ['VEGF'],\n    relatedTerms: ['angiogenesis', 'colorectal cancer', 'anti-angiogenic']\n  },\n  {\n    id: 'rituximab',\n    label: 'Rituximab (Rituxan)',\n    value: 'rituximab',\n    type: 'drug',\n    category: 'CD20 Inhibitor',\n    description: 'Anti-CD20 monoclonal antibody',\n    aliases: ['rituxan', 'mabthera'],\n    frequency: 87,\n    fdaApproved: true,\n    isOncology: true,\n    targetGenes: ['CD20'],\n    relatedTerms: ['lymphoma', 'B-cell', 'hematologic malignancy']\n  },\n  {\n    id: 'paclitaxel',\n    label: 'Paclitaxel (Taxol)',\n    value: 'paclitaxel',\n    type: 'drug',\n    category: 'Taxane',\n    description: 'Microtubule stabilizing agent',\n    aliases: ['taxol'],\n    frequency: 91,\n    fdaApproved: true,\n    isOncology: true,\n    relatedTerms: ['chemotherapy', 'breast cancer', 'ovarian cancer']\n  },\n  {\n    id: 'doxorubicin',\n    label: 'Doxorubicin (Adriamycin)',\n    value: 'doxorubicin',\n    type: 'drug',\n    category: 'Anthracycline',\n    description: 'DNA intercalating agent',\n    aliases: ['adriamycin'],\n    frequency: 86,\n    fdaApproved: true,\n    isOncology: true,\n    relatedTerms: ['chemotherapy', 'cardiotoxicity', 'sarcoma']\n  },\n  {\n    id: 'carboplatin',\n    label: 'Carboplatin',\n    value: 'carboplatin',\n    type: 'drug',\n    category: 'Platinum Compound',\n    description: 'DNA crosslinking agent',\n    frequency: 84,\n    fdaApproved: true,\n    isOncology: true,\n    relatedTerms: ['chemotherapy', 'ovarian cancer', 'lung cancer']\n  },\n\n  // Common/OTC Drugs\n  {\n    id: 'aspirin',\n    label: 'Aspirin (Acetylsalicylic Acid)',\n    value: 'aspirin',\n    type: 'drug',\n    category: 'NSAID',\n    description: 'Anti-inflammatory, pain reliever, blood thinner',\n    aliases: ['acetylsalicylic acid', 'ASA', 'asa', 'asp'],\n    frequency: 99,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['pain relief', 'inflammation', 'heart disease', 'blood thinner', 'stroke prevention']\n  },\n  {\n    id: 'acetaminophen',\n    label: 'Acetaminophen (Tylenol)',\n    value: 'acetaminophen',\n    type: 'drug',\n    category: 'Analgesic',\n    description: 'Pain reliever and fever reducer',\n    aliases: ['tylenol', 'paracetamol', 'acet'],\n    frequency: 98,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['pain relief', 'fever', 'headache']\n  },\n  {\n    id: 'ibuprofen',\n    label: 'Ibuprofen (Advil, Motrin)',\n    value: 'ibuprofen',\n    type: 'drug',\n    category: 'NSAID',\n    description: 'Anti-inflammatory pain reliever',\n    aliases: ['advil', 'motrin', 'ibu'],\n    frequency: 97,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['pain relief', 'inflammation', 'fever', 'arthritis']\n  },\n  {\n    id: 'naproxen',\n    label: 'Naproxen (Aleve)',\n    value: 'naproxen',\n    type: 'drug',\n    category: 'NSAID',\n    description: 'Long-acting anti-inflammatory',\n    aliases: ['aleve', 'naprosyn'],\n    frequency: 85,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['pain relief', 'inflammation', 'arthritis']\n  },\n  {\n    id: 'diphenhydramine',\n    label: 'Diphenhydramine (Benadryl)',\n    value: 'diphenhydramine',\n    type: 'drug',\n    category: 'Antihistamine',\n    description: 'Allergy relief and sleep aid',\n    aliases: ['benadryl', 'dph'],\n    frequency: 82,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['allergy', 'sleep', 'antihistamine', 'itching']\n  },\n  {\n    id: 'loratadine',\n    label: 'Loratadine (Claritin)',\n    value: 'loratadine',\n    type: 'drug',\n    category: 'Antihistamine',\n    description: 'Non-drowsy allergy medication',\n    aliases: ['claritin'],\n    frequency: 78,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['allergy', 'antihistamine', 'non-drowsy']\n  },\n  {\n    id: 'cetirizine',\n    label: 'Cetirizine (Zyrtec)',\n    value: 'cetirizine',\n    type: 'drug',\n    category: 'Antihistamine',\n    description: 'Allergy and hives treatment',\n    aliases: ['zyrtec'],\n    frequency: 76,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['allergy', 'hives', 'antihistamine']\n  },\n  {\n    id: 'omeprazole',\n    label: 'Omeprazole (Prilosec)',\n    value: 'omeprazole',\n    type: 'drug',\n    category: 'PPI',\n    description: 'Proton pump inhibitor for acid reflux',\n    aliases: ['prilosec', 'ppi'],\n    frequency: 89,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['acid reflux', 'heartburn', 'GERD', 'stomach acid']\n  },\n  {\n    id: 'ranitidine',\n    label: 'Ranitidine (Zantac)',\n    value: 'ranitidine',\n    type: 'drug',\n    category: 'H2 Blocker',\n    description: 'Histamine H2 receptor antagonist',\n    aliases: ['zantac'],\n    frequency: 75,\n    fdaApproved: false,\n    isOncology: false,\n    relatedTerms: ['acid reflux', 'heartburn', 'H2 blocker']\n  },\n  {\n    id: 'simvastatin',\n    label: 'Simvastatin (Zocor)',\n    value: 'simvastatin',\n    type: 'drug',\n    category: 'Statin',\n    description: 'Cholesterol-lowering medication',\n    aliases: ['zocor'],\n    frequency: 88,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['cholesterol', 'statin', 'heart disease', 'lipids']\n  },\n\n  // Psychology & Mental Health Drugs\n  {\n    id: 'sertraline',\n    label: 'Sertraline (Zoloft)',\n    value: 'sertraline',\n    type: 'drug',\n    category: 'Antidepressant',\n    description: 'SSRI for depression and anxiety',\n    aliases: ['zoloft', 'lustral'],\n    frequency: 95,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['depression', 'anxiety', 'SSRI', 'mental health']\n  },\n  {\n    id: 'fluoxetine',\n    label: 'Fluoxetine (Prozac)',\n    value: 'fluoxetine',\n    type: 'drug',\n    category: 'Antidepressant',\n    description: 'SSRI for depression and OCD',\n    aliases: ['prozac'],\n    frequency: 93,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['depression', 'OCD', 'SSRI', 'mental health']\n  },\n  {\n    id: 'escitalopram',\n    label: 'Escitalopram (Lexapro)',\n    value: 'escitalopram',\n    type: 'drug',\n    category: 'Antidepressant',\n    description: 'SSRI for depression and anxiety disorders',\n    aliases: ['lexapro', 'cipralex'],\n    frequency: 91,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['depression', 'anxiety', 'SSRI', 'panic disorder']\n  },\n  {\n    id: 'alprazolam',\n    label: 'Alprazolam (Xanax)',\n    value: 'alprazolam',\n    type: 'drug',\n    category: 'Benzodiazepine',\n    description: 'Short-acting benzodiazepine for anxiety',\n    aliases: ['xanax'],\n    frequency: 89,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['anxiety', 'panic disorder', 'benzodiazepine']\n  },\n  {\n    id: 'lorazepam',\n    label: 'Lorazepam (Ativan)',\n    value: 'lorazepam',\n    type: 'drug',\n    category: 'Benzodiazepine',\n    description: 'Benzodiazepine for anxiety and seizures',\n    aliases: ['ativan'],\n    frequency: 87,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['anxiety', 'seizures', 'benzodiazepine']\n  },\n  {\n    id: 'risperidone',\n    label: 'Risperidone (Risperdal)',\n    value: 'risperidone',\n    type: 'drug',\n    category: 'Antipsychotic',\n    description: 'Atypical antipsychotic',\n    aliases: ['risperdal'],\n    frequency: 83,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['schizophrenia', 'bipolar', 'antipsychotic']\n  },\n  {\n    id: 'quetiapine',\n    label: 'Quetiapine (Seroquel)',\n    value: 'quetiapine',\n    type: 'drug',\n    category: 'Antipsychotic',\n    description: 'Atypical antipsychotic for bipolar and schizophrenia',\n    aliases: ['seroquel'],\n    frequency: 85,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['bipolar disorder', 'schizophrenia', 'antipsychotic']\n  },\n  {\n    id: 'bupropion',\n    label: 'Bupropion (Wellbutrin)',\n    value: 'bupropion',\n    type: 'drug',\n    category: 'Antidepressant',\n    description: 'Atypical antidepressant and smoking cessation aid',\n    aliases: ['wellbutrin', 'zyban'],\n    frequency: 88,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['depression', 'smoking cessation', 'NDRI']\n  },\n\n  // Neurology Drugs\n  {\n    id: 'levodopa',\n    label: 'Levodopa/Carbidopa (Sinemet)',\n    value: 'levodopa',\n    type: 'drug',\n    category: 'Neurological',\n    description: 'Dopamine precursor for Parkinson\\'s disease',\n    aliases: ['sinemet', 'l-dopa'],\n    frequency: 90,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['parkinsons', 'dopamine', 'movement disorder']\n  },\n  {\n    id: 'gabapentin',\n    label: 'Gabapentin (Neurontin)',\n    value: 'gabapentin',\n    type: 'drug',\n    category: 'Anticonvulsant',\n    description: 'Anticonvulsant for neuropathic pain and seizures',\n    aliases: ['neurontin'],\n    frequency: 92,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['neuropathic pain', 'seizures', 'epilepsy']\n  },\n  {\n    id: 'pregabalin',\n    label: 'Pregabalin (Lyrica)',\n    value: 'pregabalin',\n    type: 'drug',\n    category: 'Anticonvulsant',\n    description: 'Anticonvulsant for neuropathic pain and fibromyalgia',\n    aliases: ['lyrica'],\n    frequency: 89,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['neuropathic pain', 'fibromyalgia', 'seizures']\n  },\n  {\n    id: 'phenytoin',\n    label: 'Phenytoin (Dilantin)',\n    value: 'phenytoin',\n    type: 'drug',\n    category: 'Anticonvulsant',\n    description: 'Classic anticonvulsant for epilepsy',\n    aliases: ['dilantin'],\n    frequency: 85,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['epilepsy', 'seizures', 'anticonvulsant']\n  },\n  {\n    id: 'valproic_acid',\n    label: 'Valproic Acid (Depakote)',\n    value: 'valproic acid',\n    type: 'drug',\n    category: 'Anticonvulsant',\n    description: 'Anticonvulsant and mood stabilizer',\n    aliases: ['depakote', 'divalproex'],\n    frequency: 87,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['epilepsy', 'bipolar disorder', 'migraine prevention']\n  },\n  {\n    id: 'donepezil',\n    label: 'Donepezil (Aricept)',\n    value: 'donepezil',\n    type: 'drug',\n    category: 'Cholinesterase Inhibitor',\n    description: 'Cholinesterase inhibitor for Alzheimer\\'s disease',\n    aliases: ['aricept'],\n    frequency: 88,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['alzheimers', 'dementia', 'cognitive impairment']\n  },\n\n  // Pain Relief Drugs\n  {\n    id: 'morphine',\n    label: 'Morphine',\n    value: 'morphine',\n    type: 'drug',\n    category: 'Opioid',\n    description: 'Strong opioid for severe pain',\n    aliases: ['ms contin', 'kadian'],\n    frequency: 90,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['severe pain', 'opioid', 'cancer pain']\n  },\n  {\n    id: 'oxycodone',\n    label: 'Oxycodone (OxyContin)',\n    value: 'oxycodone',\n    type: 'drug',\n    category: 'Opioid',\n    description: 'Opioid for moderate to severe pain',\n    aliases: ['oxycontin', 'percocet', 'roxicodone'],\n    frequency: 89,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['moderate pain', 'severe pain', 'opioid']\n  },\n  {\n    id: 'hydrocodone',\n    label: 'Hydrocodone (Vicodin)',\n    value: 'hydrocodone',\n    type: 'drug',\n    category: 'Opioid',\n    description: 'Opioid for moderate pain',\n    aliases: ['vicodin', 'norco', 'lortab'],\n    frequency: 88,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['moderate pain', 'opioid', 'dental pain']\n  },\n  {\n    id: 'fentanyl',\n    label: 'Fentanyl',\n    value: 'fentanyl',\n    type: 'drug',\n    category: 'Opioid',\n    description: 'Potent opioid for severe pain',\n    aliases: ['duragesic', 'actiq'],\n    frequency: 85,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['severe pain', 'cancer pain', 'breakthrough pain']\n  },\n  {\n    id: 'tramadol',\n    label: 'Tramadol (Ultram)',\n    value: 'tramadol',\n    type: 'drug',\n    category: 'Opioid',\n    description: 'Mild opioid for moderate pain',\n    aliases: ['ultram', 'conzip'],\n    frequency: 87,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['moderate pain', 'chronic pain', 'weak opioid']\n  },\n  {\n    id: 'celecoxib',\n    label: 'Celecoxib (Celebrex)',\n    value: 'celecoxib',\n    type: 'drug',\n    category: 'COX-2 Inhibitor',\n    description: 'Selective COX-2 inhibitor for pain and inflammation',\n    aliases: ['celebrex'],\n    frequency: 86,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['arthritis', 'inflammation', 'COX-2', 'joint pain']\n  },\n  {\n    id: 'diclofenac',\n    label: 'Diclofenac (Voltaren)',\n    value: 'diclofenac',\n    type: 'drug',\n    category: 'NSAID',\n    description: 'NSAID for pain and inflammation',\n    aliases: ['voltaren', 'cataflam'],\n    frequency: 84,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['arthritis', 'inflammation', 'topical pain relief']\n  },\n\n  // Additional Depression/Anxiety Drugs\n  {\n    id: 'venlafaxine',\n    label: 'Venlafaxine (Effexor)',\n    value: 'venlafaxine',\n    type: 'drug',\n    category: 'SNRI',\n    description: 'SNRI for depression and anxiety',\n    aliases: ['effexor'],\n    frequency: 86,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['depression', 'anxiety', 'SNRI']\n  },\n  {\n    id: 'duloxetine',\n    label: 'Duloxetine (Cymbalta)',\n    value: 'duloxetine',\n    type: 'drug',\n    category: 'SNRI',\n    description: 'SNRI for depression and neuropathic pain',\n    aliases: ['cymbalta'],\n    frequency: 85,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['depression', 'neuropathic pain', 'fibromyalgia']\n  },\n  {\n    id: 'citalopram',\n    label: 'Citalopram (Celexa)',\n    value: 'citalopram',\n    type: 'drug',\n    category: 'Antidepressant',\n    description: 'SSRI for depression',\n    aliases: ['celexa'],\n    frequency: 83,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['depression', 'SSRI']\n  },\n  {\n    id: 'paroxetine',\n    label: 'Paroxetine (Paxil)',\n    value: 'paroxetine',\n    type: 'drug',\n    category: 'Antidepressant',\n    description: 'SSRI for depression and anxiety',\n    aliases: ['paxil'],\n    frequency: 82,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['depression', 'anxiety', 'SSRI']\n  },\n  {\n    id: 'lithium',\n    label: 'Lithium',\n    value: 'lithium',\n    type: 'drug',\n    category: 'Mood Stabilizer',\n    description: 'Mood stabilizer for bipolar disorder',\n    aliases: ['lithobid', 'eskalith'],\n    frequency: 81,\n    fdaApproved: true,\n    isOncology: false,\n    relatedTerms: ['bipolar disorder', 'mood stabilizer', 'mania']\n  },\n\n  // Cancer Indications\n  {\n    id: 'breast_cancer',\n    label: 'Breast Cancer',\n    value: 'breast cancer',\n    type: 'indication',\n    category: 'Solid Tumor',\n    description: 'Most common cancer in women',\n    frequency: 95,\n    relatedTerms: ['HER2', 'ER', 'PR', 'triple negative', 'ductal carcinoma']\n  },\n  {\n    id: 'lung_cancer',\n    label: 'Lung Cancer',\n    value: 'lung cancer',\n    type: 'indication',\n    category: 'Solid Tumor',\n    description: 'Leading cause of cancer death',\n    frequency: 93,\n    relatedTerms: ['NSCLC', 'SCLC', 'EGFR', 'ALK', 'smoking']\n  },\n  {\n    id: 'colorectal_cancer',\n    label: 'Colorectal Cancer',\n    value: 'colorectal cancer',\n    type: 'indication',\n    category: 'Solid Tumor',\n    description: 'Cancer of colon or rectum',\n    frequency: 88,\n    relatedTerms: ['KRAS', 'BRAF', 'MSI', 'CRC', 'adenocarcinoma']\n  },\n  {\n    id: 'melanoma',\n    label: 'Melanoma',\n    value: 'melanoma',\n    type: 'indication',\n    category: 'Skin Cancer',\n    description: 'Aggressive skin cancer',\n    frequency: 86,\n    relatedTerms: ['BRAF', 'MEK', 'immunotherapy', 'metastatic']\n  },\n  {\n    id: 'leukemia',\n    label: 'Leukemia',\n    value: 'leukemia',\n    type: 'indication',\n    category: 'Hematologic Malignancy',\n    description: 'Blood cancer affecting white blood cells',\n    frequency: 84,\n    relatedTerms: ['AML', 'CML', 'ALL', 'CLL', 'bone marrow']\n  },\n  {\n    id: 'lymphoma',\n    label: 'Lymphoma',\n    value: 'lymphoma',\n    type: 'indication',\n    category: 'Hematologic Malignancy',\n    description: 'Cancer of lymphatic system',\n    frequency: 82,\n    relatedTerms: ['Hodgkin', 'non-Hodgkin', 'B-cell', 'T-cell']\n  },\n  {\n    id: 'prostate_cancer',\n    label: 'Prostate Cancer',\n    value: 'prostate cancer',\n    type: 'indication',\n    category: 'Solid Tumor',\n    description: 'Most common cancer in men',\n    frequency: 89,\n    relatedTerms: ['PSA', 'androgen', 'hormone therapy', 'Gleason score']\n  },\n  {\n    id: 'ovarian_cancer',\n    label: 'Ovarian Cancer',\n    value: 'ovarian cancer',\n    type: 'indication',\n    category: 'Solid Tumor',\n    description: 'Gynecologic malignancy',\n    frequency: 78,\n    relatedTerms: ['BRCA', 'PARP', 'CA-125', 'serous carcinoma']\n  },\n  {\n    id: 'pancreatic_cancer',\n    label: 'Pancreatic Cancer',\n    value: 'pancreatic cancer',\n    type: 'indication',\n    category: 'Solid Tumor',\n    description: 'Aggressive digestive system cancer',\n    frequency: 75,\n    relatedTerms: ['KRAS', 'BRCA2', 'gemcitabine', 'poor prognosis']\n  },\n  {\n    id: 'renal_cell_carcinoma',\n    label: 'Renal Cell Carcinoma',\n    value: 'renal cell carcinoma',\n    type: 'indication',\n    category: 'Solid Tumor',\n    description: 'Most common kidney cancer',\n    frequency: 73,\n    relatedTerms: ['VHL', 'clear cell', 'sunitinib', 'immunotherapy']\n  },\n\n  // Mechanisms of Action\n  {\n    id: 'checkpoint_inhibitor',\n    label: 'Checkpoint Inhibitor',\n    value: 'checkpoint inhibitor',\n    type: 'mechanism',\n    category: 'Immunotherapy',\n    description: 'Blocks immune checkpoint proteins',\n    frequency: 92,\n    relatedTerms: ['PD-1', 'PD-L1', 'CTLA-4', 'immunotherapy']\n  },\n  {\n    id: 'tyrosine_kinase_inhibitor',\n    label: 'Tyrosine Kinase Inhibitor',\n    value: 'tyrosine kinase inhibitor',\n    type: 'mechanism',\n    category: 'Targeted Therapy',\n    description: 'Inhibits tyrosine kinase enzymes',\n    frequency: 90,\n    relatedTerms: ['EGFR', 'BCR-ABL', 'VEGFR', 'targeted therapy']\n  },\n  {\n    id: 'monoclonal_antibody',\n    label: 'Monoclonal Antibody',\n    value: 'monoclonal antibody',\n    type: 'mechanism',\n    category: 'Targeted Therapy',\n    description: 'Engineered antibodies targeting specific antigens',\n    frequency: 88,\n    relatedTerms: ['mAb', 'targeted therapy', 'binding', 'specificity']\n  },\n  {\n    id: 'alkylating_agent',\n    label: 'Alkylating Agent',\n    value: 'alkylating agent',\n    type: 'mechanism',\n    category: 'Chemotherapy',\n    description: 'Forms covalent bonds with DNA',\n    frequency: 85,\n    relatedTerms: ['DNA damage', 'cyclophosphamide', 'cisplatin']\n  },\n  {\n    id: 'antimetabolite',\n    label: 'Antimetabolite',\n    value: 'antimetabolite',\n    type: 'mechanism',\n    category: 'Chemotherapy',\n    description: 'Interferes with DNA/RNA synthesis',\n    frequency: 83,\n    relatedTerms: ['folate antagonist', 'purine analog', 'pyrimidine analog']\n  },\n  {\n    id: 'topoisomerase_inhibitor',\n    label: 'Topoisomerase Inhibitor',\n    value: 'topoisomerase inhibitor',\n    type: 'mechanism',\n    category: 'Chemotherapy',\n    description: 'Prevents DNA unwinding',\n    frequency: 81,\n    relatedTerms: ['topotecan', 'irinotecan', 'etoposide']\n  },\n  {\n    id: 'proteasome_inhibitor',\n    label: 'Proteasome Inhibitor',\n    value: 'proteasome inhibitor',\n    type: 'mechanism',\n    category: 'Targeted Therapy',\n    description: 'Blocks protein degradation pathway',\n    frequency: 76,\n    relatedTerms: ['bortezomib', 'carfilzomib', 'protein degradation']\n  },\n  {\n    id: 'angiogenesis_inhibitor',\n    label: 'Angiogenesis Inhibitor',\n    value: 'angiogenesis inhibitor',\n    type: 'mechanism',\n    category: 'Targeted Therapy',\n    description: 'Prevents blood vessel formation',\n    frequency: 79,\n    relatedTerms: ['VEGF', 'bevacizumab', 'anti-angiogenic']\n  },\n\n  // Biomarkers\n  {\n    id: 'her2_positive',\n    label: 'HER2 Positive',\n    value: 'HER2 positive',\n    type: 'biomarker',\n    category: 'Protein Expression',\n    description: 'Overexpression of HER2 protein',\n    frequency: 94,\n    relatedTerms: ['breast cancer', 'trastuzumab', 'pertuzumab']\n  },\n  {\n    id: 'er_pr_positive',\n    label: 'ER/PR Positive',\n    value: 'ER/PR positive',\n    type: 'biomarker',\n    category: 'Hormone Receptor',\n    description: 'Estrogen/Progesterone receptor positive',\n    frequency: 92,\n    relatedTerms: ['breast cancer', 'hormone therapy', 'tamoxifen']\n  },\n  {\n    id: 'triple_negative',\n    label: 'Triple Negative',\n    value: 'triple negative',\n    type: 'biomarker',\n    category: 'Receptor Status',\n    description: 'ER-, PR-, HER2- breast cancer',\n    frequency: 87,\n    relatedTerms: ['breast cancer', 'chemotherapy', 'BRCA']\n  },\n  {\n    id: 'egfr_mutation',\n    label: 'EGFR Mutation',\n    value: 'EGFR mutation',\n    type: 'biomarker',\n    category: 'Genetic Mutation',\n    description: 'Epidermal growth factor receptor mutations',\n    frequency: 89,\n    relatedTerms: ['lung cancer', 'osimertinib', 'erlotinib']\n  },\n  {\n    id: 'kras_mutation',\n    label: 'KRAS Mutation',\n    value: 'KRAS mutation',\n    type: 'biomarker',\n    category: 'Genetic Mutation',\n    description: 'Kirsten rat sarcoma viral oncogene mutations',\n    frequency: 85,\n    relatedTerms: ['colorectal cancer', 'lung cancer', 'pancreatic cancer']\n  },\n  {\n    id: 'brca_mutation',\n    label: 'BRCA Mutation',\n    value: 'BRCA mutation',\n    type: 'biomarker',\n    category: 'Genetic Mutation',\n    description: 'BRCA1/2 tumor suppressor gene mutations',\n    frequency: 88,\n    relatedTerms: ['breast cancer', 'ovarian cancer', 'PARP inhibitor']\n  },\n  {\n    id: 'pd_l1_positive',\n    label: 'PD-L1 Positive',\n    value: 'PD-L1 positive',\n    type: 'biomarker',\n    category: 'Protein Expression',\n    description: 'Programmed death-ligand 1 expression',\n    frequency: 86,\n    relatedTerms: ['immunotherapy', 'pembrolizumab', 'checkpoint inhibitor']\n  },\n  {\n    id: 'msi_high',\n    label: 'MSI-High',\n    value: 'MSI-high',\n    type: 'biomarker',\n    category: 'Molecular Feature',\n    description: 'Microsatellite instability high',\n    frequency: 83,\n    relatedTerms: ['colorectal cancer', 'immunotherapy', 'mismatch repair']\n  },\n  {\n    id: 'tmb_high',\n    label: 'TMB-High',\n    value: 'TMB-high',\n    type: 'biomarker',\n    category: 'Molecular Feature',\n    description: 'Tumor mutational burden high',\n    frequency: 81,\n    relatedTerms: ['immunotherapy', 'checkpoint inhibitor', 'mutation load']\n  },\n\n  // Gene Targets\n  {\n    id: 'braf',\n    label: 'BRAF',\n    value: 'BRAF',\n    type: 'gene',\n    category: 'Oncogene',\n    description: 'Proto-oncogene B-Raf',\n    frequency: 84,\n    relatedTerms: ['melanoma', 'colorectal cancer', 'dabrafenib']\n  },\n  {\n    id: 'alk',\n    label: 'ALK',\n    value: 'ALK',\n    type: 'gene',\n    category: 'Fusion Gene',\n    description: 'Anaplastic lymphoma kinase',\n    frequency: 78,\n    relatedTerms: ['lung cancer', 'crizotinib', 'alectinib']\n  },\n  {\n    id: 'ros1',\n    label: 'ROS1',\n    value: 'ROS1',\n    type: 'gene',\n    category: 'Fusion Gene',\n    description: 'ROS proto-oncogene 1',\n    frequency: 72,\n    relatedTerms: ['lung cancer', 'crizotinib', 'entrectinib']\n  },\n  {\n    id: 'ntrk',\n    label: 'NTRK',\n    value: 'NTRK',\n    type: 'gene',\n    category: 'Fusion Gene',\n    description: 'Neurotrophic tyrosine receptor kinase',\n    frequency: 68,\n    relatedTerms: ['solid tumors', 'larotrectinib', 'entrectinib']\n  },\n  {\n    id: 'ret',\n    label: 'RET',\n    value: 'RET',\n    type: 'gene',\n    category: 'Fusion Gene',\n    description: 'Rearranged during transfection',\n    frequency: 70,\n    relatedTerms: ['lung cancer', 'thyroid cancer', 'selpercatinib']\n  }\n];\n\nconst AutocompleteSearch: React.FC<AutocompleteSearchProps> = ({\n  placeholder = \"Search drugs, indications, mechanisms...\",\n  onSelect,\n  onInputChange,\n  value = \"\",\n  maxResults = 10,\n  showCategories = true,\n  allowMultiple = false,\n  selectedOptions = [],\n  disabled = false,\n  loading = false,\n  className = \"\",\n  onOfflineChange\n}) => {\n  const [inputValue, setInputValue] = useState(value);\n  const [isOpen, setIsOpen] = useState(false);\n  const [filteredOptions, setFilteredOptions] = useState<AutocompleteOption[]>([]);\n  const [highlightedIndex, setHighlightedIndex] = useState(-1);\n  const [recentSearches, setRecentSearches] = useState<string[]>([]);\n  const [serverOptions, setServerOptions] = useState<AutocompleteOption[]>([]);\n  const [serverOffline, setServerOffline] = useState<boolean>(false);\n  \n  const inputRef = useRef<HTMLInputElement>(null);\n  const listRef = useRef<HTMLUListElement>(null);\n\n  // Load recent searches from localStorage\n  useEffect(() => {\n    const saved = localStorage.getItem('oncosaferx_recent_searches');\n    if (saved) {\n      try {\n        setRecentSearches(JSON.parse(saved));\n      } catch (e) {\n        console.warn('Failed to parse recent searches:', e);\n      }\n    }\n  }, []);\n\n  // Fetch server suggestions when typing (debounced minimal)\n  useEffect(() => {\n    let abort = false;\n    if (inputValue.trim().length < 2) { setServerOptions([]); setServerOffline(false); return; }\n    const t = setTimeout(async () => {\n      try {\n        const resp = await fetch(`/api/drugs/search?q=${encodeURIComponent(inputValue)}`);\n        if (!resp.ok) throw new Error('suggestions failed');\n        const data = await resp.json();\n        const opts: AutocompleteOption[] = (data.results || []).slice(0, maxResults).map((s: any) => ({\n          id: s.id || s.rxcui || s.name,\n          label: s.name,\n          value: s.name,\n          type: 'drug',\n          category: 'Drug'\n        }));\n        if (!abort) {\n          setServerOptions(opts);\n          // Check if we're offline based on RxNorm data availability\n          const isOffline = !data.sources?.rxnorm || data.sources.rxnorm === 0;\n          setServerOffline(isOffline);\n          onOfflineChange?.(isOffline);\n        }\n      } catch {\n        if (!abort) { setServerOptions([]); }\n      }\n    }, 250);\n    return () => { abort = true; clearTimeout(t); };\n  }, [inputValue, maxResults, onOfflineChange]);\n\n  // Filter options based on input (combine server + local)\n  useEffect(() => {\n    if (!inputValue.trim()) {\n      // Show recent searches and popular options when empty\n      const popular = COMPREHENSIVE_OPTIONS\n        .filter(opt => opt.type === 'drug' && opt.frequency && opt.frequency > 80)\n        .sort((a, b) => (b.frequency || 0) - (a.frequency || 0))\n        .slice(0, maxResults);\n      setFilteredOptions(popular);\n      return;\n    }\n\n    const searchTerm = inputValue.toLowerCase().trim();\n    \n    // Enhanced fuzzy matching function\n    const fuzzyMatch = (text: string, search: string): { matches: boolean; score: number } => {\n      text = text.toLowerCase();\n      search = search.toLowerCase();\n      \n      // Exact match - highest score\n      if (text === search) return { matches: true, score: 100 };\n      \n      // Starts with - very high score\n      if (text.startsWith(search)) return { matches: true, score: 90 };\n      \n      // Contains - high score\n      if (text.includes(search)) return { matches: true, score: 80 };\n      \n      // Fuzzy matching for partial typing (e.g., \"a-s-p\" for \"aspirin\")\n      if (search.includes('-') || search.includes(' ') || search.includes('.')) {\n        const cleanSearch = search.replace(/[-\\s.]/g, '');\n        if (text.includes(cleanSearch)) return { matches: true, score: 70 };\n      }\n      \n      // Acronym matching (e.g., \"asp\" for \"aspirin\")\n      if (search.length >= 2) {\n        const words = text.split(/[\\s-()]/);\n        const acronym = words.map(word => word.charAt(0)).join('');\n        if (acronym.includes(search)) return { matches: true, score: 60 };\n        \n        // Check if search is prefix of first letters\n        let charIndex = 0;\n        for (const char of search) {\n          const foundIndex = text.indexOf(char, charIndex);\n          if (foundIndex === -1) break;\n          charIndex = foundIndex + 1;\n          if (charIndex >= text.length) break;\n        }\n        if (charIndex > 0 && search.length >= 3) {\n          return { matches: true, score: 50 };\n        }\n      }\n      \n      // Levenshtein-inspired partial matching\n      if (search.length >= 3) {\n        let matches = 0;\n        let lastIndex = -1;\n        for (const char of search) {\n          const index = text.indexOf(char, lastIndex + 1);\n          if (index > lastIndex) {\n            matches++;\n            lastIndex = index;\n          }\n        }\n        if (matches / search.length >= 0.7) {\n          return { matches: true, score: 40 };\n        }\n      }\n      \n      return { matches: false, score: 0 };\n    };\n\n    const matches = COMPREHENSIVE_OPTIONS.filter(option => {\n      // Only show drugs, not indications/cancer types\n      if (option.type !== 'drug') return false;\n      \n      // Check main label with fuzzy matching\n      const labelMatch = fuzzyMatch(option.label, searchTerm);\n      if (labelMatch.matches) return true;\n      \n      // Check value\n      const valueMatch = fuzzyMatch(option.value, searchTerm);\n      if (valueMatch.matches) return true;\n      \n      // Check aliases with fuzzy matching\n      if (option.aliases?.some(alias => fuzzyMatch(alias, searchTerm).matches)) return true;\n      \n      // Check related terms\n      if (option.relatedTerms?.some(term => fuzzyMatch(term, searchTerm).matches)) return true;\n      \n      // Check description\n      if (option.description && fuzzyMatch(option.description, searchTerm).matches) return true;\n      \n      // Check category\n      if (fuzzyMatch(option.category, searchTerm).matches) return true;\n      \n      return false;\n    }).map(option => {\n      // Calculate relevance score for sorting\n      const labelMatch = fuzzyMatch(option.label, searchTerm);\n      const valueMatch = fuzzyMatch(option.value, searchTerm);\n      const aliasMatch = option.aliases ? Math.max(...option.aliases.map(alias => fuzzyMatch(alias, searchTerm).score)) : 0;\n      const score = Math.max(labelMatch.score, valueMatch.score, aliasMatch);\n      \n      return { ...option, relevanceScore: score };\n    });\n\n    // Sort by relevance using fuzzy match scores\n    const sorted = matches.sort((a: any, b: any) => {\n      // Sort by relevance score first\n      if (a.relevanceScore !== b.relevanceScore) {\n        return b.relevanceScore - a.relevanceScore;\n      }\n      \n      // For equal relevance scores, prefer FDA approved drugs\n      if (a.type === 'drug' && b.type === 'drug') {\n        if (a.fdaApproved && !b.fdaApproved) return -1;\n        if (!a.fdaApproved && b.fdaApproved) return 1;\n      }\n      \n      // Then sort by frequency\n      return (b.frequency || 0) - (a.frequency || 0);\n    });\n\n    // Prefer server options when available; fallback to local sorted\n    const combined = serverOptions.length > 0 ? serverOptions.slice(0, maxResults) : sorted.slice(0, maxResults);\n    setFilteredOptions(combined);\n    setHighlightedIndex(-1);\n  }, [inputValue, maxResults, serverOptions]);\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n    setInputValue(newValue);\n    onInputChange?.(newValue);\n    setIsOpen(true);\n  };\n\n  const handleOptionSelect = (option: AutocompleteOption) => {\n    if (allowMultiple) {\n      if (!selectedOptions.find(opt => opt.id === option.id)) {\n        onSelect(option);\n      }\n    } else {\n      setInputValue(option.label);\n      onSelect(option);\n    }\n    \n    // Save to recent searches\n    const updated = [option.value, ...recentSearches.filter(s => s !== option.value)].slice(0, 10);\n    setRecentSearches(updated);\n    localStorage.setItem('oncosaferx_recent_searches', JSON.stringify(updated));\n    \n    setIsOpen(false);\n    setHighlightedIndex(-1);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (!isOpen) return;\n\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        setHighlightedIndex(prev => \n          prev < filteredOptions.length - 1 ? prev + 1 : prev\n        );\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        setHighlightedIndex(prev => prev > 0 ? prev - 1 : prev);\n        break;\n      case 'Enter':\n        e.preventDefault();\n        if (highlightedIndex >= 0 && filteredOptions[highlightedIndex]) {\n          handleOptionSelect(filteredOptions[highlightedIndex]);\n        }\n        break;\n      case 'Escape':\n        setIsOpen(false);\n        setHighlightedIndex(-1);\n        inputRef.current?.blur();\n        break;\n    }\n  };\n\n  const getOptionIcon = (type: string) => {\n    switch (type) {\n      case 'drug': return <Pill className=\"h-4 w-4 text-blue-500\" />;\n      case 'indication': return <Target className=\"h-4 w-4 text-red-500\" />;\n      case 'mechanism': return <Zap className=\"h-4 w-4 text-purple-500\" />;\n      case 'biomarker': return <Activity className=\"h-4 w-4 text-green-500\" />;\n      case 'gene': return <Heart className=\"h-4 w-4 text-pink-500\" />;\n      case 'class': return <Users className=\"h-4 w-4 text-orange-500\" />;\n      default: return <Search className=\"h-4 w-4 text-gray-500\" />;\n    }\n  };\n\n  const removeSelectedOption = (optionId: string) => {\n    // This would be handled by parent component\n    console.log('Remove option:', optionId);\n  };\n\n  return (\n    <div className={`relative ${className}`}>\n      {/* Selected Options (for multiple selection) */}\n      {allowMultiple && selectedOptions.length > 0 && (\n        <div className=\"flex flex-wrap gap-2 mb-2\">\n          {selectedOptions.map(option => (\n            <div\n              key={option.id}\n              className=\"flex items-center space-x-1 px-3 py-1 bg-violet-100 text-violet-800 rounded-full text-sm\"\n            >\n              {getOptionIcon(option.type)}\n              <span>{option.label}</span>\n              <button\n                onClick={() => removeSelectedOption(option.id)}\n                className=\"text-violet-600 hover:text-violet-800\"\n              >\n                <X className=\"h-3 w-3\" />\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Search Input */}\n      <div className=\"relative\">\n        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n        <input\n          ref={inputRef}\n          type=\"text\"\n          value={inputValue}\n          onChange={handleInputChange}\n          onKeyDown={handleKeyDown}\n          onFocus={() => setIsOpen(true)}\n          onBlur={() => setTimeout(() => setIsOpen(false), 200)}\n          placeholder={placeholder}\n          disabled={disabled || loading}\n          className={`w-full pl-10 pr-10 py-3 text-lg border border-gray-300 rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-violet-500 ${\n            disabled ? 'bg-gray-100 cursor-not-allowed' : 'bg-white'\n          }`}\n        />\n        \n        {loading && (\n          <Loader2 className=\"absolute right-8 top-1/2 transform -translate-y-1/2 h-5 w-5 text-violet-600 animate-spin\" />\n        )}\n        \n        <ChevronDown className={`absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 transition-transform ${\n          isOpen ? 'rotate-180' : ''\n        }`} />\n      </div>\n\n      {/* Dropdown Options */}\n      {isOpen && (\n        <div className=\"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-96 overflow-hidden\">\n          {/* Header */}\n          {inputValue.trim() === '' && (\n            <div className=\"px-4 py-2 bg-gray-50 border-b text-sm text-gray-600\">\n              {recentSearches.length > 0 ? 'Recent searches & Popular options' : 'Popular options'}\n            </div>\n          )}\n          \n          {filteredOptions.length > 0 ? (\n            <ul ref={listRef} className=\"max-h-80 overflow-y-auto\">\n              {filteredOptions.map((option, index) => (\n                <li key={option.id}>\n                  <button\n                    onMouseDown={(e) => { e.preventDefault(); /* ensure click before blur */ }}\n                    onClick={() => handleOptionSelect(option)}\n                    className={`w-full flex items-center space-x-3 px-4 py-3 text-left hover:bg-gray-50 ${\n                      index === highlightedIndex ? 'bg-violet-50 border-l-4 border-violet-500' : ''\n                    }`}\n                  >\n                    {getOptionIcon(option.type)}\n                    \n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center space-x-2 mb-1\">\n                        <span className=\"font-medium text-gray-900 truncate\">\n                          {option.label}\n                        </span>\n                        {option.fdaApproved && (\n                          <CheckCircle className=\"h-3 w-3 text-green-500 flex-shrink-0\" />\n                        )}\n                        {option.isOncology && (\n                          <Target className=\"h-3 w-3 text-red-500 flex-shrink-0\" />\n                        )}\n                      </div>\n                      \n                      {showCategories && (\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"text-xs text-gray-500 capitalize\">\n                            {option.type} • {option.category}\n                          </span>\n                          {option.frequency && option.frequency > 85 && (\n                            <div className=\"flex items-center space-x-1\">\n                              <Star className=\"h-3 w-3 text-yellow-500\" />\n                              <span className=\"text-xs text-yellow-600\">Popular</span>\n                            </div>\n                          )}\n                        </div>\n                      )}\n                      \n                      {option.description && (\n                        <p className=\"text-xs text-gray-400 mt-1 truncate\">\n                          {option.description}\n                        </p>\n                      )}\n                    </div>\n                    \n                    {option.type === 'drug' && (\n                      <div className=\"text-right flex-shrink-0\">\n                        <div className=\"text-xs text-gray-500\">\n                          {option.fdaApproved ? 'FDA Approved' : 'Investigational'}\n                        </div>\n                      </div>\n                    )}\n                  </button>\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <div className=\"px-4 py-6 text-center text-gray-500\">\n              <Search className=\"h-8 w-8 mx-auto mb-2 text-gray-300\" />\n              <p>No matches found</p>\n              <p className=\"text-xs mt-1\">Try a different search term</p>\n            </div>\n          )}\n          \n          {/* Footer */}\n          {filteredOptions.length > 0 && (\n            <div className=\"px-4 py-2 bg-gray-50 border-t text-xs text-gray-500 text-center\">\n              Showing {filteredOptions.length} result{filteredOptions.length !== 1 ? 's' : ''} \n              {inputValue.trim() && ` for \"${inputValue}\"`}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AutocompleteSearch;\n","import { useState, useEffect, useCallback } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\n\ntype SerializableValue = string | number | boolean | null | undefined;\ntype StateValue = SerializableValue | SerializableValue[] | Record<string, SerializableValue>;\n\ninterface UseUrlStateOptions {\n  defaultValue?: StateValue;\n  serialize?: (value: StateValue) => string;\n  deserialize?: (value: string) => StateValue;\n  replace?: boolean; // Use replace instead of push for navigation\n}\n\n/**\n * Hook for managing state in URL search parameters\n * Automatically syncs state with URL and provides type-safe updates\n */\nexport function useUrlState<T extends StateValue>(\n  key: string,\n  options: UseUrlStateOptions = {}\n): [T, (value: T | ((prev: T) => T)) => void] {\n  const navigate = useNavigate();\n  const location = useLocation();\n  \n  const {\n    defaultValue,\n    serialize = defaultSerialize,\n    deserialize = defaultDeserialize,\n    replace = false\n  } = options;\n\n  // Get initial value from URL or use default\n  const getInitialValue = useCallback((): T => {\n    const searchParams = new URLSearchParams(location.search);\n    const urlValue = searchParams.get(key);\n    \n    if (urlValue !== null) {\n      try {\n        return deserialize(urlValue) as T;\n      } catch (error) {\n        console.warn(`Failed to deserialize URL parameter \"${key}\":`, error);\n      }\n    }\n    \n    return (defaultValue ?? null) as T;\n  }, [key, location.search, defaultValue, deserialize]);\n\n  const [state, setState] = useState<T>(getInitialValue);\n\n  // Update URL when state changes\n  const updateUrl = useCallback((newValue: T) => {\n    const searchParams = new URLSearchParams(location.search);\n    \n    if (newValue === null || newValue === undefined || newValue === '') {\n      searchParams.delete(key);\n    } else {\n      try {\n        const serialized = serialize(newValue);\n        searchParams.set(key, serialized);\n      } catch (error) {\n        console.warn(`Failed to serialize value for URL parameter \"${key}\":`, error);\n        return;\n      }\n    }\n    \n    const newSearch = searchParams.toString();\n    const newUrl = `${location.pathname}${newSearch ? `?${newSearch}` : ''}`;\n    \n    if (replace) {\n      navigate(newUrl, { replace: true });\n    } else {\n      navigate(newUrl);\n    }\n  }, [key, location.pathname, location.search, navigate, replace, serialize]);\n\n  // Sync state with URL when location changes\n  useEffect(() => {\n    const newValue = getInitialValue();\n    setState(newValue);\n  }, [getInitialValue]);\n\n  // Update function that also updates URL\n  const updateState = useCallback((value: T | ((prev: T) => T)) => {\n    setState(prevState => {\n      const newValue = typeof value === 'function' ? (value as (prev: T) => T)(prevState) : value;\n      // Defer URL update to avoid setState during render\n      setTimeout(() => updateUrl(newValue), 0);\n      return newValue;\n    });\n  }, [updateUrl]);\n\n  return [state, updateState];\n}\n\n// Default serializers\nfunction defaultSerialize(value: StateValue): string {\n  if (value === null || value === undefined) {\n    return '';\n  }\n  \n  if (typeof value === 'string') {\n    return value;\n  }\n  \n  if (typeof value === 'number' || typeof value === 'boolean') {\n    return String(value);\n  }\n  \n  if (Array.isArray(value) || typeof value === 'object') {\n    return JSON.stringify(value);\n  }\n  \n  return String(value);\n}\n\nfunction defaultDeserialize(value: string): StateValue {\n  if (!value) {\n    return null;\n  }\n  \n  // Try to parse as JSON first\n  try {\n    return JSON.parse(value);\n  } catch {\n    // If JSON parsing fails, try other formats\n    if (value === 'true') return true;\n    if (value === 'false') return false;\n    if (!isNaN(Number(value)) && value !== '') return Number(value);\n    return value;\n  }\n}\n\n/**\n * Hook for managing filter state with URL persistence\n */\nexport function useUrlFilters<T extends Record<string, StateValue>>(\n  defaultFilters: T,\n  options: { replace?: boolean } = {}\n): [T, (filters: Partial<T> | ((prev: T) => Partial<T>)) => void, () => void] {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { replace = true } = options;\n\n  const getFiltersFromUrl = useCallback((): T => {\n    const searchParams = new URLSearchParams(location.search);\n    const filters = { ...defaultFilters };\n    \n    Object.keys(defaultFilters).forEach(key => {\n      const urlValue = searchParams.get(key);\n      if (urlValue !== null) {\n        try {\n          filters[key as keyof T] = defaultDeserialize(urlValue) as T[keyof T];\n        } catch (error) {\n          console.warn(`Failed to parse filter \"${key}\" from URL:`, error);\n        }\n      }\n    });\n    \n    return filters;\n  }, [location.search]);\n\n  const [filters, setFilters] = useState<T>(getFiltersFromUrl);\n\n  // Update URL when filters change\n  const updateUrl = useCallback((newFilters: T) => {\n    const searchParams = new URLSearchParams(location.search);\n    \n    Object.entries(newFilters).forEach(([key, value]) => {\n      if (value === null || value === undefined || value === '' || \n          (Array.isArray(value) && value.length === 0) ||\n          value === defaultFilters[key as keyof T]) {\n        searchParams.delete(key);\n      } else {\n        try {\n          searchParams.set(key, defaultSerialize(value));\n        } catch (error) {\n          console.warn(`Failed to serialize filter \"${key}\":`, error);\n        }\n      }\n    });\n    \n    const newSearch = searchParams.toString();\n    const newUrl = `${location.pathname}${newSearch ? `?${newSearch}` : ''}`;\n    \n    if (replace) {\n      navigate(newUrl, { replace: true });\n    } else {\n      navigate(newUrl);\n    }\n  }, [location.pathname, location.search, navigate, replace]);\n\n  // Sync filters with URL changes\n  useEffect(() => {\n    const newFilters = getFiltersFromUrl();\n    setFilters(newFilters);\n  }, [getFiltersFromUrl]);\n\n  // Update filters function\n  const updateFilters = useCallback((newFilters: Partial<T> | ((prev: T) => Partial<T>)) => {\n    setFilters(prevFilters => {\n      const updates = typeof newFilters === 'function' ? newFilters(prevFilters) : newFilters;\n      const updatedFilters = { ...prevFilters, ...updates };\n      // Defer URL update to avoid setState during render\n      setTimeout(() => updateUrl(updatedFilters), 0);\n      return updatedFilters;\n    });\n  }, [updateUrl]);\n\n  // Clear all filters\n  const clearFilters = useCallback(() => {\n    setFilters(defaultFilters);\n    // Defer URL update to avoid setState during render\n    setTimeout(() => updateUrl(defaultFilters), 0);\n  }, [updateUrl, defaultFilters]);\n\n  return [filters, updateFilters, clearFilters];\n}\n\n/**\n * Hook for managing pagination state with URL persistence\n */\nexport function useUrlPagination(defaultPage: number = 1, defaultPageSize: number = 20) {\n  const [page, setPage] = useUrlState<number>('page', { \n    defaultValue: defaultPage,\n    replace: true \n  });\n  const [pageSize, setPageSize] = useUrlState<number>('pageSize', { \n    defaultValue: defaultPageSize,\n    replace: true \n  });\n\n  const resetPagination = useCallback(() => {\n    setPage(defaultPage);\n  }, [setPage, defaultPage]);\n\n  return {\n    page: page || defaultPage,\n    pageSize: pageSize || defaultPageSize,\n    setPage,\n    setPageSize,\n    resetPagination\n  };\n}\n\n/**\n * Hook for managing sort state with URL persistence\n */\nexport function useUrlSort<T extends string>(defaultSort?: T, defaultDirection: 'asc' | 'desc' = 'asc') {\n  const [sortBy, setSortBy] = useUrlState<T | null>('sortBy', { \n    defaultValue: defaultSort || null,\n    replace: true \n  });\n  const [sortDirection, setSortDirection] = useUrlState<'asc' | 'desc'>('sortDirection', { \n    defaultValue: defaultDirection,\n    replace: true \n  });\n\n  const updateSort = useCallback((field: T | null, direction?: 'asc' | 'desc') => {\n    setSortBy(field);\n    if (direction) {\n      setSortDirection(direction);\n    } else if (field === sortBy) {\n      // Toggle direction if same field\n      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      // Default to asc for new field\n      setSortDirection('asc');\n    }\n  }, [sortBy, sortDirection, setSortBy, setSortDirection]);\n\n  return {\n    sortBy,\n    sortDirection: sortDirection || defaultDirection,\n    updateSort,\n    setSortBy,\n    setSortDirection\n  };\n}","import { useState, useEffect, useCallback } from 'react';\n\ntype SetValue<T> = T | ((val: T) => T);\n\n/**\n * Hook for managing state with localStorage persistence\n * Automatically syncs with localStorage and handles JSON serialization\n */\nexport function useLocalStorage<T>(\n  key: string,\n  initialValue: T,\n  options: {\n    serialize?: (value: T) => string;\n    deserialize?: (value: string) => T;\n    syncAcrossTabs?: boolean;\n  } = {}\n): [T, (value: SetValue<T>) => void, () => void] {\n  const {\n    serialize = JSON.stringify,\n    deserialize = JSON.parse,\n    syncAcrossTabs = true\n  } = options;\n\n  // Get value from localStorage or use initial value\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    try {\n      const item = window.localStorage.getItem(key);\n      if (item !== null) {\n        return deserialize(item);\n      }\n      return initialValue;\n    } catch (error) {\n      console.warn(`Error reading localStorage key \"${key}\":`, error);\n      return initialValue;\n    }\n  });\n\n  // Return a wrapped version of useState's setter function that persists to localStorage\n  const setValue = useCallback((value: SetValue<T>) => {\n    try {\n      // Allow value to be a function so we have the same API as useState\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\n      \n      // Save state\n      setStoredValue(valueToStore);\n      \n      // Save to localStorage\n      if (valueToStore === undefined) {\n        window.localStorage.removeItem(key);\n      } else {\n        window.localStorage.setItem(key, serialize(valueToStore));\n      }\n    } catch (error) {\n      console.warn(`Error setting localStorage key \"${key}\":`, error);\n    }\n  }, [key, serialize, storedValue]);\n\n  // Remove from localStorage\n  const removeValue = useCallback(() => {\n    try {\n      window.localStorage.removeItem(key);\n      setStoredValue(initialValue);\n    } catch (error) {\n      console.warn(`Error removing localStorage key \"${key}\":`, error);\n    }\n  }, [key, initialValue]);\n\n  // Listen for changes to localStorage from other tabs\n  useEffect(() => {\n    if (!syncAcrossTabs) return;\n\n    const handleStorageChange = (e: StorageEvent) => {\n      if (e.key === key && e.newValue !== null) {\n        try {\n          setStoredValue(deserialize(e.newValue));\n        } catch (error) {\n          console.warn(`Error parsing localStorage change for key \"${key}\":`, error);\n        }\n      } else if (e.key === key && e.newValue === null) {\n        setStoredValue(initialValue);\n      }\n    };\n\n    window.addEventListener('storage', handleStorageChange);\n    return () => window.removeEventListener('storage', handleStorageChange);\n  }, [key, deserialize, initialValue, syncAcrossTabs]);\n\n  return [storedValue, setValue, removeValue];\n}\n\n/**\n * Hook for managing user preferences with localStorage\n */\nexport function useUserPreferences<T extends Record<string, any>>(\n  defaultPreferences: T,\n  storageKey: string = 'user_preferences'\n) {\n  const [preferences, setPreferences, clearPreferences] = useLocalStorage(\n    storageKey,\n    defaultPreferences\n  );\n\n  const updatePreference = useCallback(<K extends keyof T>(\n    key: K,\n    value: T[K]\n  ) => {\n    setPreferences(prev => ({\n      ...prev,\n      [key]: value\n    }));\n  }, [setPreferences]);\n\n  const updatePreferences = useCallback((updates: Partial<T>) => {\n    setPreferences(prev => ({\n      ...prev,\n      ...updates\n    }));\n  }, [setPreferences]);\n\n  const resetPreferences = useCallback(() => {\n    setPreferences(defaultPreferences);\n  }, [setPreferences, defaultPreferences]);\n\n  return {\n    preferences,\n    updatePreference,\n    updatePreferences,\n    resetPreferences,\n    clearPreferences\n  };\n}\n\n/**\n * Hook for managing recent searches with localStorage\n */\nexport function useRecentSearches(\n  maxItems: number = 10,\n  storageKey: string = 'recent_searches'\n) {\n  const [searches, setSearches] = useLocalStorage<string[]>(storageKey, []);\n\n  const addSearch = useCallback((search: string) => {\n    const trimmedSearch = search.trim();\n    if (!trimmedSearch) return;\n\n    setSearches(prev => {\n      const filtered = prev.filter(s => s !== trimmedSearch);\n      return [trimmedSearch, ...filtered].slice(0, maxItems);\n    });\n  }, [setSearches, maxItems]);\n\n  const removeSearch = useCallback((search: string) => {\n    setSearches(prev => prev.filter(s => s !== search));\n  }, [setSearches]);\n\n  const clearSearches = useCallback(() => {\n    setSearches([]);\n  }, [setSearches]);\n\n  return {\n    searches,\n    addSearch,\n    removeSearch,\n    clearSearches\n  };\n}\n\n/**\n * Hook for managing view state (collapsed panels, table columns, etc.)\n */\nexport function useViewState<T extends Record<string, any>>(\n  defaultState: T,\n  storageKey: string\n) {\n  const [viewState, setViewState] = useLocalStorage(storageKey, defaultState);\n\n  const updateViewState = useCallback(<K extends keyof T>(\n    key: K,\n    value: T[K]\n  ) => {\n    setViewState(prev => ({\n      ...prev,\n      [key]: value\n    }));\n  }, [setViewState]);\n\n  const toggleViewState = useCallback(<K extends keyof T>(key: K) => {\n    setViewState(prev => ({\n      ...prev,\n      [key]: !prev[key]\n    }));\n  }, [setViewState]);\n\n  const resetViewState = useCallback(() => {\n    setViewState(defaultState);\n  }, [setViewState, defaultState]);\n\n  return {\n    viewState,\n    updateViewState,\n    toggleViewState,\n    resetViewState\n  };\n}\n\n/**\n * Hook for managing form state with localStorage backup\n */\nexport function useFormState<T extends Record<string, any>>(\n  formId: string,\n  defaultValues: T,\n  options: {\n    autosave?: boolean;\n    debounceMs?: number;\n  } = {}\n) {\n  const { autosave = true, debounceMs = 1000 } = options;\n  const storageKey = `form_state_${formId}`;\n  \n  const [values, setValues] = useLocalStorage(storageKey, defaultValues);\n  const [isDirty, setIsDirty] = useState(false);\n\n  // Update form value\n  const setValue = useCallback(<K extends keyof T>(\n    key: K,\n    value: T[K]\n  ) => {\n    setValues(prev => ({\n      ...prev,\n      [key]: value\n    }));\n    setIsDirty(true);\n  }, [setValues]);\n\n  // Update multiple values\n  const setValues_ = useCallback((updates: Partial<T>) => {\n    setValues(prev => ({\n      ...prev,\n      ...updates\n    }));\n    setIsDirty(true);\n  }, [setValues]);\n\n  // Reset form to default values\n  const resetForm = useCallback(() => {\n    setValues(defaultValues);\n    setIsDirty(false);\n  }, [setValues, defaultValues]);\n\n  // Clear saved form state\n  const clearSavedState = useCallback(() => {\n    window.localStorage.removeItem(storageKey);\n    setValues(defaultValues);\n    setIsDirty(false);\n  }, [storageKey, setValues, defaultValues]);\n\n  // Mark form as saved\n  const markSaved = useCallback(() => {\n    setIsDirty(false);\n  }, []);\n\n  return {\n    values,\n    setValue,\n    setValues: setValues_,\n    resetForm,\n    clearSavedState,\n    markSaved,\n    isDirty\n  };\n}","import React, { useEffect, useMemo, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Drug, DrugSearchResult } from '../types';\nimport { drugService } from '../services/api';\nimport SimpleDrugSearch from '../components/DrugSearch/SimpleDrugSearch';\nimport PredictiveSearchBar from '../components/DrugSearch/PredictiveSearchBar';\nimport DrugSearchResults from '../components/DrugSearch/DrugSearchResults';\nimport DrugCard from '../components/DrugSearch/DrugCard';\nimport SearchWithFavorites from '../components/Search/SearchWithFavorites';\nimport ImprovedDrugSearch from '../components/DrugSearch/ImprovedDrugSearch';\nimport AutocompleteSearch from '../components/DrugSearch/AutocompleteSearch';\nimport FeatureErrorBoundary from '../components/ErrorBoundary/FeatureErrorBoundary';\nimport Card from '../components/UI/Card';\nimport Alert from '../components/UI/Alert';\n// Using existing UI components instead of shadcn\nimport { \n  Search, History, Star, Database, Filter, X, Brain, Zap, Target, \n  Activity, TrendingUp, Clock, CheckCircle, AlertTriangle, \n  BookOpen, Microscope, Pill, Heart, Shield, Sparkles,\n  ChevronDown, ChevronUp, BarChart3, Users, Globe,\n  RefreshCw, Download, Upload, Settings, Info\n} from 'lucide-react';\nimport { useSelection } from '../context/SelectionContext';\nimport { analytics } from '../utils/analytics';\nimport { getPins, clearPins, togglePin, reorderPins } from '../utils/pins';\nimport { SearchFilter as AdvancedSearchFilter } from '../hooks/useAdvancedSearch';\nimport { useUrlState, useUrlFilters, useUrlPagination, useUrlSort } from '../hooks/useUrlState';\nimport { useUserPreferences, useRecentSearches } from '../hooks/useLocalStorage';\n\ninterface SearchFilters {\n  drugType?: string;\n  category?: string;\n  hasInteractions?: boolean;\n  hasGenomics?: boolean;\n  approvalStatus?: string;\n  sortBy?: string;\n}\n\nconst DrugSearchInner: React.FC = () => {\n  const selection = useSelection();\n  \n  // Search state with URL persistence\n  const [searchQuery, setSearchQuery] = useUrlState<string>('q', { defaultValue: '' });\n  \n  // Filter state with URL persistence\n  const [filters, updateFilters, clearFilters] = useUrlFilters({\n    onlyOncology: false,\n    onlyPinned: false,\n    drugType: '',\n    category: '',\n    hasInteractions: false,\n    hasGenomics: false,\n    approvalStatus: '',\n    BN: false,\n    SCD: false,\n    SBD: false,\n    IN: false,\n    MIN: false\n  });\n  \n  // Pagination with URL persistence\n  const { page, pageSize, setPage, setPageSize, resetPagination } = useUrlPagination(1, 20);\n  \n  // Sort state with URL persistence\n  const { sortBy, sortDirection, updateSort } = useUrlSort<string>('relevance', 'desc');\n  \n  // User preferences in localStorage\n  const { preferences, updatePreference } = useUserPreferences({\n    defaultPageSize: 20,\n    showDescriptions: true,\n    compactView: false\n  }, 'drug_search_preferences');\n  \n  // Recent searches in localStorage\n  const { searches: searchHistory, addSearch } = useRecentSearches(10, 'drug_search_history');\n  \n  // Component state\n  const navigate = useNavigate();\n  const [searchResults, setSearchResults] = useState<DrugSearchResult | null>(null);\n  const [selectedDrug, setSelectedDrug] = useState<Drug | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [pinsTick, setPinsTick] = useState(0);\n  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);\n  const [searchMode, setSearchMode] = useState<'basic' | 'advanced' | 'ai'>('advanced');\n  const [aiInsights, setAiInsights] = useState<any>(null);\n  const [drugAnalytics, setDrugAnalytics] = useState<any>(null);\n  const [searchSuggestions, setSearchSuggestions] = useState<string[]>([]);\n  const [recentInteractions, setRecentInteractions] = useState<any[]>([]);\n  const [rxnormOfflineToast, setRxnormOfflineToast] = useState<boolean>(false);\n  const [rxnormToastDismissed, setRxnormToastDismissed] = useState<boolean>(false);\n  const [connStatus, setConnStatus] = useState<'unknown'|'online'|'offline'|'error'>('unknown');\n  const [connTesting, setConnTesting] = useState<boolean>(false);\n  const [connCheckedAt, setConnCheckedAt] = useState<string | null>(null);\n  const [basicSuggestions, setBasicSuggestions] = useState<Array<{ name: string; rxcui?: string | null }>>([]);\n  const [basicSuggestionsOffline, setBasicSuggestionsOffline] = useState<boolean>(false);\n  const [basicSuggestionsLoading, setBasicSuggestionsLoading] = useState<boolean>(false);\n\n  useEffect(() => {\n    const dismissed = localStorage.getItem('rxnorm_offline_toast_dismissed') === '1';\n    setRxnormToastDismissed(dismissed);\n    // Test connectivity on component mount\n    testConnectivity();\n  }, []);\n\n  async function testConnectivity() {\n    try {\n      setConnTesting(true);\n      const resp = await fetch(`/api/drugs/search?q=aspirin`, { method: 'GET' });\n      if (!resp.ok) {\n        setConnStatus('error');\n      } else {\n        const data = await resp.json();\n        // Check if we have RxNorm data (online) or local data only (offline)\n        const isOnline = data?.sources?.rxnorm > 0;\n        setConnStatus(isOnline ? 'online' : 'offline');\n      }\n      setConnCheckedAt(new Date().toLocaleTimeString());\n    } catch (e) {\n      console.error('Connectivity test failed:', e);\n      setConnStatus('error');\n      setConnCheckedAt(new Date().toLocaleTimeString());\n    } finally {\n      setConnTesting(false);\n    }\n  }\n  \n  // Derived state\n  const activeTtySet = useMemo(() => new Set(\n    Object.entries(filters)\n      .filter(([key, value]) => ['BN', 'SCD', 'SBD', 'IN', 'MIN'].includes(key) && value)\n      .map(([key]) => key)\n  ), [filters]);\n  const pinnedList = useMemo(() => Object.entries(getPins()).map(([rxcui, v]) => ({ rxcui, name: v.name })), [pinsTick]);\n\n  const handleAdvancedSearch = async (query: string, advancedFilters?: AdvancedSearchFilter) => {\n    // Update URL state\n    setSearchQuery(query);\n    \n    // Add to search history\n    if (query && String(query).trim()) {\n      addSearch(String(query).trim());\n    }\n    \n    // Reset pagination when searching\n    resetPagination();\n    \n    // Convert advanced filters to our search filters format and update state\n    if (advancedFilters?.category) {\n      updateFilters({ category: advancedFilters.category });\n    }\n    \n    return handleSearch(query);\n  };\n\n  const handleSearch = async (query: string) => {\n    setLoading(true);\n    setError(null);\n    setSelectedDrug(null);\n\n    try {\n      // Build search parameters with filters\n      const searchParams = new URLSearchParams({ q: query });\n      \n      if (filters?.drugType) searchParams.append('type', filters.drugType);\n      if (filters?.category) searchParams.append('category', filters.category);\n      if (filters?.hasInteractions) searchParams.append('hasInteractions', 'true');\n      if (filters?.hasGenomics) searchParams.append('hasGenomics', 'true');\n      if (filters?.sortBy) searchParams.append('sort', filters.sortBy);\n\n      const results = await drugService.searchDrugs(query);\n      \n      // Apply client-side filtering and sorting if needed\n      let filteredResults = results.results;\n      \n      // Sort results based on filter\n      if (filters?.sortBy) {\n        switch (filters.sortBy) {\n          case 'name':\n            filteredResults.sort((a, b) => a.name.localeCompare(b.name));\n            break;\n          case 'recent':\n            // This would require additional backend support\n            break;\n          case 'popular':\n            // This would require usage statistics\n            break;\n          default:\n            // Keep default relevance order\n            break;\n        }\n      }\n      \n      const finalResults = { ...results, results: filteredResults };\n      setSearchResults(finalResults);\n      try { analytics.logSearch(query, finalResults?.count); } catch {}\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to search drugs');\n      setSearchResults(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDrugSelectFromSearch = (drug: Drug) => {\n    // When user selects from autocomplete, show detailed view directly\n    handleDrugSelect(drug);\n  };\n\n\n  const handleDrugSelect = async (drug: Drug) => {\n    setSelectedDrug(drug);\n    selection.addDrug(drug);\n    setLoading(true);\n    \n    // Try to get detailed information\n    try {\n      const details = await drugService.getDrugDetails(drug.rxcui);\n      setSelectedDrug({ ...drug, ...details });\n    } catch (err) {\n      console.warn('Failed to load drug details:', err);\n      // Keep the basic drug info from search results\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleBackToResults = () => {\n    setSelectedDrug(null);\n  };\n\n  // Keyboard shortcuts: \"/\" to focus input, Esc clears view\n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      if (e.key === '/') {\n        const el = document.getElementById('drug-search-input') as HTMLInputElement | null;\n        if (el) { e.preventDefault(); el.focus(); }\n      } else if (e.key === 'Escape') {\n        setSelectedDrug(null);\n        setSearchResults(null);\n      } else if (e.key.toLowerCase() === 'r' && !e.metaKey && !e.ctrlKey) {\n        // Reset filters\n        updateFilters({ BN: false, SCD: false, SBD: false, IN: false, MIN: false, onlyOncology: false });\n      } else if (e.key.toLowerCase() === 'o' && !e.metaKey && !e.ctrlKey) {\n        // Toggle oncology filter\n        updateFilters({ onlyOncology: !filters.onlyOncology });\n      }\n    };\n    window.addEventListener('keydown', handler);\n    return () => window.removeEventListener('keydown', handler);\n  }, []);\n\n  // Fetch suggestions for basic mode panel\n  useEffect(() => {\n    let abort = false;\n    if (searchMode !== 'basic' || !searchQuery || String(searchQuery).trim().length < 2) {\n      setBasicSuggestions([]);\n      setBasicSuggestionsOffline(false);\n      return;\n    }\n    setBasicSuggestionsLoading(true);\n    const t = setTimeout(async () => {\n      try {\n        const resp = await fetch(`/api/drugs/search?q=${encodeURIComponent(searchQuery)}`);\n        if (!resp.ok) throw new Error('suggestions failed');\n        const data = await resp.json();\n        if (abort) return;\n        setBasicSuggestions((data.results || []).slice(0, 8).map((s: any) => ({ name: s.name, rxcui: s.rxcui })));\n        setBasicSuggestionsOffline(!data.sources?.rxnorm || data.sources.rxnorm === 0);\n      } catch {\n        if (!abort) { setBasicSuggestions([]); setBasicSuggestionsOffline(false); }\n      } finally {\n        if (!abort) setBasicSuggestionsLoading(false);\n      }\n    }, 300);\n    return () => { abort = true; clearTimeout(t); };\n  }, [searchMode, searchQuery]);\n\n  const handleQuickSearch = (query: string) => {\n    handleSearch(query);\n  };\n\n  if (selectedDrug) {\n    return (\n      <div className=\"space-y-6\">\n        {/* Success Banner */}\n        <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n          <div className=\"flex items-center space-x-3\">\n            <CheckCircle className=\"h-6 w-6 text-green-600\" />\n            <div>\n              <h3 className=\"font-medium text-green-800\">Drug Selected Successfully!</h3>\n              <p className=\"text-sm text-green-700\">\n                You've selected <strong>{selectedDrug.name}</strong>. Explore the options below to analyze interactions, genomics, or clinical protocols.\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Back Button */}\n        <button\n          onClick={handleBackToResults}\n          className=\"flex items-center space-x-2 text-primary-600 hover:text-primary-700 font-medium\"\n        >\n          <span>←</span>\n          <span>Back to Search Results</span>\n        </button>\n\n        {/* Drug Details */}\n        {loading ? (\n          <Card>\n            <div className=\"flex items-center justify-center p-8\">\n              <div className=\"text-center\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4\"></div>\n                <p className=\"text-gray-600\">Loading drug details...</p>\n              </div>\n            </div>\n          </Card>\n        ) : (\n          <DrugCard drug={selectedDrug} showDetails={true} />\n        )}\n\n        {/* Additional Actions */}\n        <div className=\"grid md:grid-cols-3 gap-4\">\n          <Card padding=\"sm\" className=\"text-center\">\n            <div className=\"text-primary-600 mb-2\">\n              <Search className=\"w-6 h-6 mx-auto\" />\n            </div>\n            <h3 className=\"font-medium text-gray-900 mb-1\">View Interactions</h3>\n            <p className=\"text-sm text-gray-600 mb-3\">Check drug-drug interactions</p>\n            <button \n              onClick={() => setTimeout(() => navigate(`/interactions?drug=${selectedDrug.rxcui}`), 100)}\n              className=\"text-sm text-primary-600 hover:text-primary-700 font-medium\"\n            >\n              Check Interactions →\n            </button>\n          </Card>\n\n          <Card padding=\"sm\" className=\"text-center\">\n            <div className=\"text-purple-600 mb-2\">\n              <Star className=\"w-6 h-6 mx-auto\" />\n            </div>\n            <h3 className=\"font-medium text-gray-900 mb-1\">Genomic Analysis</h3>\n            <p className=\"text-sm text-gray-600 mb-3\">View pharmacogenomic factors</p>\n            <button \n              onClick={() => setTimeout(() => navigate(`/genomics?drug=${selectedDrug.rxcui}`), 100)}\n              className=\"text-sm text-purple-600 hover:text-purple-700 font-medium\"\n            >\n              Analyze Genomics →\n            </button>\n          </Card>\n\n          <Card padding=\"sm\" className=\"text-center\">\n            <div className=\"text-green-600 mb-2\">\n              <History className=\"w-6 h-6 mx-auto\" />\n            </div>\n            <h3 className=\"font-medium text-gray-900 mb-1\">Clinical Trials</h3>\n            <p className=\"text-sm text-gray-600 mb-3\">Find relevant studies</p>\n            <button \n              onClick={() => setTimeout(() => navigate(`/protocols?drug=${selectedDrug.name}`), 100)}\n              className=\"text-sm text-green-600 hover:text-green-700 font-medium\"\n            >\n              View Trials →\n            </button>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      {/* RxNorm Offline Toast (one-time) */}\n      {rxnormOfflineToast && !rxnormToastDismissed && (\n        <div className=\"p-3 border border-amber-200 bg-amber-50 text-amber-800 rounded flex items-start justify-between\">\n          <div>\n            <div className=\"font-medium\">Using offline suggestions</div>\n            <div className=\"text-sm\">RxNorm appears unreachable. Typeahead uses a limited offline list; full results may be reduced.</div>\n          </div>\n          <button\n            className=\"text-amber-800 hover:text-amber-900 text-sm ml-4\"\n            onClick={() => { setRxnormOfflineToast(false); setRxnormToastDismissed(true); localStorage.setItem('rxnorm_offline_toast_dismissed','1'); }}\n            aria-label=\"Dismiss offline notice\"\n          >\n            Dismiss\n          </button>\n        </div>\n      )}\n      {/* Enhanced Header with AI Insights */}\n      <div className=\"relative\">\n        <div className=\"absolute inset-0 bg-gradient-to-r from-violet-600/10 via-blue-600/10 to-indigo-600/10 rounded-2xl\" />\n        <div className=\"relative p-8 text-center\">\n          <div className=\"flex items-center justify-center space-x-3 mb-6\">\n            <div className=\"p-3 bg-gradient-to-r from-violet-600 to-indigo-600 rounded-xl\">\n              <Database className=\"w-8 h-8 text-white\" />\n            </div>\n            <h1 className=\"text-4xl font-bold bg-gradient-to-r from-violet-600 to-indigo-600 bg-clip-text text-transparent\">\n              Intelligent Drug Discovery\n            </h1>\n            <div className=\"flex items-center space-x-2\">\n              <Brain className=\"w-6 h-6 text-violet-600\" />\n              <span className=\"px-3 py-1 bg-violet-100 text-violet-800 rounded-full text-sm font-medium\">\n                AI-Powered\n              </span>\n            </div>\n          </div>\n          <p className=\"text-xl text-gray-600 max-w-4xl mx-auto mb-6\">\n            Advanced drug search with AI-powered insights, molecular analysis, and personalized recommendations\n          </p>\n          \n          {/* Quick Stats */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 max-w-4xl mx-auto\">\n            <div className=\"bg-white/80 backdrop-blur-sm rounded-lg p-4 border border-violet-200\">\n              <div className=\"flex items-center space-x-2 text-violet-600 mb-2\">\n                <Pill className=\"w-5 h-5\" />\n                <span className=\"font-medium\">Drug Database</span>\n              </div>\n              <div className=\"text-2xl font-bold text-gray-900\">50,000+</div>\n              <div className=\"text-sm text-gray-600\">Medications</div>\n            </div>\n            <div className=\"bg-white/80 backdrop-blur-sm rounded-lg p-4 border border-blue-200\">\n              <div className=\"flex items-center space-x-2 text-blue-600 mb-2\">\n                <Activity className=\"w-5 h-5\" />\n                <span className=\"font-medium\">Interactions</span>\n              </div>\n              <div className=\"text-2xl font-bold text-gray-900\">2.5M+</div>\n              <div className=\"text-sm text-gray-600\">Drug Pairs</div>\n            </div>\n            <div className=\"bg-white/80 backdrop-blur-sm rounded-lg p-4 border border-green-200\">\n              <div className=\"flex items-center space-x-2 text-green-600 mb-2\">\n                <Microscope className=\"w-5 h-5\" />\n                <span className=\"font-medium\">Clinical Trials</span>\n              </div>\n              <div className=\"text-2xl font-bold text-gray-900\">25,000+</div>\n              <div className=\"text-sm text-gray-600\">Active Studies</div>\n            </div>\n            <div className=\"bg-white/80 backdrop-blur-sm rounded-lg p-4 border border-purple-200\">\n              <div className=\"flex items-center space-x-2 text-purple-600 mb-2\">\n                <Heart className=\"w-5 h-5\" />\n                <span className=\"font-medium\">Oncology Focus</span>\n              </div>\n              <div className=\"text-2xl font-bold text-gray-900\">5,000+</div>\n              <div className=\"text-sm text-gray-600\">Cancer Drugs</div>\n            </div>\n          </div>\n          \n          {pinnedList.length > 0 && (\n            <div className=\"mt-6 flex items-center justify-center space-x-2\">\n              <Star className=\"w-5 h-5 text-yellow-500\" />\n              <span className=\"text-lg font-medium text-gray-700\">\n                {pinnedList.length} Pinned Medication{pinnedList.length !== 1 ? 's' : ''}\n              </span>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Connectivity status + test */}\n      <div className=\"flex items-center justify-center mt-2\">\n        <div className=\"inline-flex items-center gap-3 text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded px-3 py-2\">\n          <div className=\"inline-flex items-center gap-2\">\n            <span className={`inline-block w-2.5 h-2.5 rounded-full ${\n              connStatus === 'online' ? 'bg-green-500' : connStatus === 'offline' ? 'bg-amber-500' : connStatus === 'error' ? 'bg-red-500' : 'bg-gray-400'\n            }`} />\n            <span>\n              {connStatus === 'online' && 'RxNorm connectivity: Online'}\n              {connStatus === 'offline' && 'RxNorm connectivity: Offline (fallback)'}\n              {connStatus === 'error' && 'RxNorm connectivity: Error'}\n              {connStatus === 'unknown' && 'RxNorm connectivity: Unknown'}\n              {connCheckedAt ? ` • Checked ${connCheckedAt}` : ''}\n            </span>\n          </div>\n          <button\n            onClick={testConnectivity}\n            disabled={connTesting}\n            className=\"text-blue-700 hover:text-blue-800 underline disabled:opacity-60\"\n          >\n            {connTesting ? 'Testing…' : 'Test connectivity'}\n          </button>\n        </div>\n      </div>\n\n      {/* Search Mode Selector */}\n      <div className=\"flex items-center justify-center space-x-4\">\n        <div className=\"flex bg-gray-100 rounded-lg p-1\">\n          {[\n            { mode: 'basic', label: 'Basic Search', icon: Search },\n            { mode: 'advanced', label: 'Advanced Filters', icon: Filter },\n            { mode: 'ai', label: 'AI Assistant', icon: Brain }\n          ].map(({ mode, label, icon: Icon }) => (\n            <button\n              key={mode}\n              onClick={() => setSearchMode(mode as typeof searchMode)}\n              className={`flex items-center space-x-2 px-4 py-2 rounded-md text-sm font-medium transition-all ${\n                searchMode === mode\n                  ? 'bg-white text-violet-600 shadow-sm'\n                  : 'text-gray-600 hover:text-gray-800'\n              }`}\n            >\n              <Icon className=\"w-4 h-4\" />\n              <span>{label}</span>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Search Interface Based on Mode */}\n      {searchMode === 'basic' && (\n        <div className=\"max-w-4xl mx-auto\">\n          <AutocompleteSearch\n            placeholder=\"Search drugs by name, indication, or mechanism...\"\n            onSelect={(option) => {\n              setSearchQuery(option.value);\n              // If this is a drug option, treat it as a direct drug selection\n              if (option.type === 'drug') {\n                // Create a drug object from the autocomplete option\n                const drug: Drug = {\n                  rxcui: option.id,\n                  name: option.label,\n                  synonym: option.value,\n                  tty: 'SBD'\n                };\n                handleDrugSelect(drug);\n              } else {\n                // For non-drug options (indications, mechanisms), do a search\n                handleSearch(option.value);\n              }\n            }}\n            onInputChange={(value) => setSearchQuery(value)}\n            value={searchQuery}\n            loading={loading}\n            maxResults={8}\n            showCategories={true}\n            className=\"w-full\"\n            onOfflineChange={(offline) => {\n              if (offline) {\n                if (!rxnormToastDismissed) setRxnormOfflineToast(true);\n              } else {\n                setRxnormOfflineToast(false);\n              }\n            }}\n          />\n          <div className=\"flex items-center justify-center mt-4\">\n            <button \n              onClick={() => handleSearch(searchQuery)}\n              disabled={loading || !searchQuery || !String(searchQuery).trim()}\n              className=\"bg-gradient-to-r from-violet-600 to-indigo-600 text-white px-8 py-3 text-lg rounded-lg hover:from-violet-700 hover:to-indigo-700 disabled:opacity-50 flex items-center space-x-2\"\n            >\n              <Search className=\"h-5 w-5\" />\n              <span>Search Drugs</span>\n            </button>\n          </div>\n          {/* Top matches after analyzing */}\n          {searchQuery && String(searchQuery).trim().length >= 2 && (\n            <div className=\"mt-4 bg-white border border-gray-200 rounded-lg shadow-sm\">\n              <div className=\"px-3 py-2 border-b flex items-center justify-between\">\n                <div className=\"text-sm font-medium text-gray-700\">Top matches</div>\n                {basicSuggestionsOffline && (\n                  <div className=\"text-[11px] text-gray-500\">Using offline suggestions</div>\n                )}\n              </div>\n              <div className=\"p-3\">\n                {basicSuggestionsLoading ? (\n                  <div className=\"text-xs text-gray-500\">Analyzing…</div>\n                ) : basicSuggestions.length > 0 ? (\n                  <div className=\"flex flex-wrap gap-2\">\n                    {basicSuggestions.map((s, i) => (\n                      <button\n                        key={`${s.rxcui || s.name}-${i}`}\n                        onClick={() => setSearchQuery(s.name)}\n                        className=\"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800 hover:bg-gray-200\"\n                        title={s.rxcui ? `RXCUI ${s.rxcui}` : s.name}\n                      >\n                        {s.name}\n                      </button>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-xs text-gray-500\">No matches</div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n      \n      {searchMode === 'advanced' && (\n        <ImprovedDrugSearch onOfflineChange={(offline) => {\n          if (offline) {\n            if (!rxnormToastDismissed) setRxnormOfflineToast(true);\n          } else {\n            setRxnormOfflineToast(false);\n          }\n        }} />\n      )}\n      \n      {searchMode === 'ai' && (\n        <div className=\"space-y-6\">\n          <Card className=\"border-violet-200 bg-gradient-to-r from-violet-50 to-indigo-50\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center space-x-2 mb-6\">\n                <Brain className=\"h-6 w-6 text-violet-600\" />\n                <h2 className=\"text-xl font-bold text-violet-800\">AI Drug Discovery Assistant</h2>\n                <span className=\"px-2 py-1 bg-violet-100 text-violet-800 rounded-full text-sm font-medium\">\n                  Beta\n                </span>\n              </div>\n              \n              <div className=\"text-center mb-6\">\n                <div className=\"flex items-center justify-center space-x-2 mb-4\">\n                  <Sparkles className=\"h-8 w-8 text-violet-600\" />\n                  <span className=\"text-2xl font-bold text-violet-800\">Ask the AI</span>\n                </div>\n                <p className=\"text-gray-600 mb-6\">\n                  Describe your patient case, treatment goals, or ask questions about drug therapy\n                </p>\n              </div>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n                <div className=\"p-4 cursor-pointer hover:bg-blue-50 border border-blue-200 rounded-lg bg-white\">\n                  <div className=\"flex items-center space-x-2 text-blue-600 mb-2\">\n                    <Target className=\"h-5 w-5\" />\n                    <span className=\"font-medium\">Find Similar Drugs</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600\">\n                    \"Find drugs similar to pembrolizumab for lung cancer\"\n                  </p>\n                </div>\n                \n                <div className=\"p-4 cursor-pointer hover:bg-green-50 border border-green-200 rounded-lg bg-white\">\n                  <div className=\"flex items-center space-x-2 text-green-600 mb-2\">\n                    <Activity className=\"h-5 w-5\" />\n                    <span className=\"font-medium\">Biomarker Matching</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600\">\n                    \"What drugs target HER2-positive breast cancer?\"\n                  </p>\n                </div>\n                \n                <div className=\"p-4 cursor-pointer hover:bg-purple-50 border border-purple-200 rounded-lg bg-white\">\n                  <div className=\"flex items-center space-x-2 text-purple-600 mb-2\">\n                    <Zap className=\"h-5 w-5\" />\n                    <span className=\"font-medium\">Drug Interactions</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600\">\n                    \"Check interactions between warfarin and chemotherapy\"\n                  </p>\n                </div>\n              </div>\n              \n              <div className=\"relative\">\n                <textarea\n                  id=\"ai-input\"\n                  placeholder=\"Describe your patient case or ask a question about drug therapy...\"\n                  className=\"w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500 h-32 resize-none\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                />\n                <div className=\"flex items-center justify-between mt-4\">\n                  <div className=\"flex items-center space-x-2 text-sm text-gray-500\">\n                    <Info className=\"h-4 w-4\" />\n                    <span>AI responses are for educational purposes only</span>\n                  </div>\n                  <button \n                    onClick={() => {\n                      if (searchQuery && String(searchQuery).trim()) {\n                        setAiInsights({ \n                          query: searchQuery,\n                          response: \"AI assistant is currently in development. For now, please use the basic or advanced search modes to find specific drugs and their interactions.\",\n                          suggestions: [\n                            \"Try searching for specific drug names\",\n                            \"Use the advanced filters to narrow your search\",\n                            \"Check drug interactions in the interaction checker\"\n                          ]\n                        });\n                      }\n                    }}\n                    disabled={!searchQuery || !String(searchQuery).trim() || loading}\n                    className=\"bg-gradient-to-r from-violet-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-violet-700 hover:to-indigo-700 flex items-center space-x-2 disabled:opacity-50\"\n                  >\n                    <Brain className=\"h-4 w-4\" />\n                    <span>Ask AI Assistant</span>\n                  </button>\n                </div>\n              </div>\n              \n              {/* AI Response */}\n              {aiInsights && (\n                <div className=\"mt-6 p-4 bg-violet-50 border border-violet-200 rounded-lg\">\n                  <div className=\"flex items-center space-x-2 mb-3\">\n                    <Brain className=\"h-5 w-5 text-violet-600\" />\n                    <span className=\"font-medium text-violet-800\">AI Response</span>\n                  </div>\n                  <p className=\"text-gray-700 mb-4\">{aiInsights.response}</p>\n                  {aiInsights.suggestions && (\n                    <div>\n                      <h4 className=\"font-medium text-gray-900 mb-2\">Suggestions:</h4>\n                      <ul className=\"list-disc list-inside space-y-1\">\n                        {aiInsights.suggestions.map((suggestion, index) => (\n                          <li key={index} className=\"text-sm text-gray-600\">{suggestion}</li>\n                        ))}\n                      </ul>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </Card>\n        </div>\n      )}\n\n      {/* Quick Access Pills and Filters - Only show for basic/advanced modes */}\n      {(searchMode === 'basic' || searchMode === 'advanced') && (\n        <div className=\"space-y-4\">\n        {/* Pinned quick access chips */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex flex-wrap gap-2 items-center\">\n            <span className=\"text-sm text-gray-600 mr-1\">Pinned:</span>\n            {pinnedList.length === 0 ? (\n              <span className=\"text-xs text-gray-400\">No pinned drugs yet</span>\n            ) : (\n              pinnedList.slice(0, 10).map((p, idx) => (\n                <div\n                  key={p.rxcui}\n                  className=\"inline-flex items-center pl-2 pr-1 py-1 rounded-full text-xs bg-yellow-50 text-yellow-800 border border-yellow-200\"\n                  title={`Pinned: ${p.name}`}\n                  draggable\n                  onDragStart={(e) => { e.dataTransfer.setData('text/plain', p.rxcui); e.dataTransfer.effectAllowed = 'move'; }}\n                  onDragOver={(e) => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; }}\n                  onDrop={(e) => {\n                    e.preventDefault();\n                    const dragged = e.dataTransfer.getData('text/plain');\n                    if (!dragged || dragged === p.rxcui) return;\n                    const list = pinnedList.slice(0, 10).map(x => x.rxcui);\n                    const from = list.indexOf(dragged);\n                    const to = idx;\n                    if (from === -1 || to === -1) return;\n                    list.splice(to, 0, list.splice(from, 1)[0]);\n                    reorderPins(list);\n                    setPinsTick(x => x + 1);\n                  }}\n                >\n                  <button\n                    onClick={() => handleSearch(p.name)}\n                    className=\"px-0.5 mr-1 hover:underline\"\n                    aria-label={`Search for ${p.name}`}\n                  >\n                    {p.name}\n                  </button>\n                  <button\n                    onClick={(e) => { e.stopPropagation(); togglePin(p.rxcui, p.name); setPinsTick((x) => x + 1); }}\n                    className=\"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full hover:bg-yellow-100\"\n                    aria-label={`Unpin ${p.name}`}\n                    title=\"Unpin\"\n                  >\n                    <X className=\"w-3 h-3\" />\n                  </button>\n                </div>\n              ))\n            )}\n          </div>\n          <div className=\"flex items-center space-x-3\">\n            <button\n              type=\"button\"\n              className={`text-xs px-2 py-1 rounded-full border ${filters.onlyPinned ? 'bg-yellow-100 text-yellow-800 border-yellow-200' : 'text-gray-600 bg-gray-50 border-gray-200 hover:text-gray-800'}`}\n              onClick={() => updateFilters({ onlyPinned: !filters.onlyPinned })}\n              aria-pressed={filters.onlyPinned}\n              aria-label={`Show only pinned ${filters.onlyPinned ? 'on' : 'off'}`}\n              title=\"Show only pinned in results\"\n            >\n              Show only pinned\n            </button>\n            <button\n              type=\"button\"\n              className=\"text-xs text-gray-500 hover:text-gray-700 underline\"\n              onClick={() => {\n                if (!searchResults || !Array.isArray(searchResults.results)) return;\n                const pins = getPins();\n                const oncoNames = ['pembrolizumab','nivolumab','fluorouracil','cisplatin','doxorubicin','paclitaxel','tamoxifen','imatinib'];\n                const visible = searchResults.results.filter((drug) => {\n                  const ttyOk = activeTtySet.size === 0 || (drug.tty ? activeTtySet.has(drug.tty) : false);\n                  const isOnco = oncoNames.some(n => (drug.name || '').toLowerCase().includes(n));\n                  const oncoOk = !filters.onlyOncology || isOnco;\n                  return ttyOk && oncoOk && pins[drug.rxcui];\n                });\n                visible.forEach(d => { if (pins[d.rxcui]) togglePin(d.rxcui, d.name); });\n                setPinsTick(x => x + 1);\n              }}\n              aria-label=\"Unpin all shown results\"\n              title=\"Unpin all shown in results\"\n            >\n              Unpin Shown\n            </button>\n            <button\n              type=\"button\"\n              className=\"text-xs text-gray-500 hover:text-gray-700 underline\"\n              onClick={() => { clearPins(); setPinsTick((x) => x + 1); }}\n              aria-label=\"Clear pinned drugs\"\n            >\n              Clear Pins\n            </button>\n          </div>\n        </div>\n        \n        </div>\n      )}\n\n      {/* Filter chips */}\n      <div className=\"flex flex-wrap gap-2 items-center\">\n        <span className=\"text-sm text-gray-600 mr-1\">Filters:</span>\n        {['BN','SCD','SBD','IN','MIN'].map((tty) => (\n          <button\n            key={tty}\n            type=\"button\"\n            onClick={() => updateFilters({ [tty]: !filters[tty as keyof typeof filters] })}\n            className={`px-2 py-1 rounded-full text-xs border ${filters[tty as keyof typeof filters] ? 'bg-blue-100 text-blue-700 border-blue-200' : 'bg-gray-50 text-gray-600 border-gray-200'}`}\n            aria-pressed={filters[tty as keyof typeof filters]}\n            aria-label={`Filter ${tty} ${filters[tty as keyof typeof filters] ? 'on' : 'off'}`}\n          >\n            {tty}\n          </button>\n        ))}\n        <button\n          type=\"button\"\n          onClick={() => updateFilters({ onlyOncology: !filters.onlyOncology })}\n          className={`px-2 py-1 rounded-full text-xs border ${filters.onlyOncology ? 'bg-purple-100 text-purple-700 border-purple-200' : 'bg-gray-50 text-gray-600 border-gray-200'}`}\n          aria-pressed={filters.onlyOncology}\n          aria-label={`Oncology filter ${filters.onlyOncology ? 'on' : 'off'}`}\n        >\n          Oncology\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => updateFilters({ onlyPinned: !filters.onlyPinned })}\n          className={`px-2 py-1 rounded-full text-xs border ${filters.onlyPinned ? 'bg-yellow-100 text-yellow-800 border-yellow-200' : 'bg-gray-50 text-gray-600 border-gray-200'}`}\n          aria-pressed={filters.onlyPinned}\n          aria-label={`Pinned filter ${filters.onlyPinned ? 'on' : 'off'}`}\n        >\n          Pinned only\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => updateFilters({ BN: false, SCD: false, SBD: false, IN: false, MIN: false, onlyOncology: false })}\n          className=\"px-2 py-1 rounded-full text-xs border bg-gray-50 text-gray-600 border-gray-200\"\n        >\n          Reset\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => {\n            if (!searchResults || !Array.isArray(searchResults.results)) return;\n            const pins = getPins();\n            const oncoNames = ['pembrolizumab','nivolumab','fluorouracil','cisplatin','doxorubicin','paclitaxel','tamoxifen','imatinib'];\n            const visible = searchResults.results.filter((drug) => {\n              const ttyOk = activeTtySet.size === 0 || (drug.tty ? activeTtySet.has(drug.tty) : false);\n              const isOnco = oncoNames.some(n => (drug.name || '').toLowerCase().includes(n));\n              const oncoOk = !filters.onlyOncology || isOnco;\n              return ttyOk && oncoOk;\n            });\n            visible.forEach(d => { if (!pins[d.rxcui]) togglePin(d.rxcui, d.name); });\n            setPinsTick((x) => x + 1);\n          }}\n          className=\"px-2 py-1 rounded-full text-xs border bg-yellow-50 text-yellow-800 border-yellow-200 hover:bg-yellow-100\"\n          aria-label=\"Pin all shown results\"\n        >\n          Pin All Shown\n        </button>\n      </div>\n\n      {/* Search Results - Only show if we have results */}\n      {searchResults && (\n        <div className={`grid ${selectedDrug ? 'md:grid-cols-2 gap-6' : ''}`}>\n          <div>\n            <DrugSearchResults\n              results={searchResults}\n              loading={loading}\n              error={error}\n              onDrugSelect={handleDrugSelect}\n              filters={{ onlyOncology: filters.onlyOncology, onlyPinned: filters.onlyPinned, tty: activeTtySet }}\n              pinVersion={pinsTick}\n            />\n          </div>\n          {selectedDrug && (\n            <div>\n              <DrugCard drug={selectedDrug} showDetails={true} />\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Help Section */}\n      {!searchResults && !loading && (\n        <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200\">\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center space-x-2\">\n              <Database className=\"w-5 h-5 text-blue-600\" />\n              <h3 className=\"text-lg font-semibold text-blue-900\">Search Features</h3>\n            </div>\n            <div className=\"grid md:grid-cols-2 gap-6 text-sm text-blue-800\">\n              <div>\n                <h4 className=\"font-medium mb-2 flex items-center space-x-1\">\n                  <Search className=\"w-4 h-4\" />\n                  <span>Search Capabilities</span>\n                </h4>\n                <ul className=\"space-y-1\">\n                  <li>• Search by generic or brand name</li>\n                  <li>• Partial name matching supported</li>\n                  <li>• Case-insensitive search</li>\n                  <li>• Search by drug categories</li>\n                </ul>\n              </div>\n              <div>\n                <h4 className=\"font-medium mb-2 flex items-center space-x-1\">\n                  <Star className=\"w-4 h-4\" />\n                  <span>Quick Access</span>\n                </h4>\n                <ul className=\"space-y-1\">\n                  <li>• Organized drug shortcuts by category</li>\n                  <li>• Common medications readily available</li>\n                  <li>• Oncology drugs for cancer care</li>\n                  <li>• Cardiovascular medications</li>\n                </ul>\n              </div>\n            </div>\n            <div className=\"mt-4 p-3 bg-blue-100 rounded-lg\">\n              <p className=\"text-blue-800 text-sm\">\n                <strong>Tip:</strong> Use the quick access buttons above for common medications, or search directly by typing the drug name.\n              </p>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* Data Sources */}\n      <Alert type=\"info\" title=\"Data Sources\">\n        Drug information is sourced from RxNorm (National Library of Medicine), FDA's DailyMed database, \n        and our curated database of oncology medications. Data is regularly updated to ensure accuracy.\n      </Alert>\n    </div>\n  );\n};\n\nconst DrugSearch: React.FC = () => {\n  return (\n    <FeatureErrorBoundary \n      featureName=\"Drug Search\"\n      fallbackMessage=\"The drug search feature is temporarily unavailable. This may be due to database connectivity or processing issues.\"\n    >\n      <DrugSearchInner />\n    </FeatureErrorBoundary>\n  );\n};\n\nexport default DrugSearch;\n"],"file":"assets/DrugSearch-B0fuDZ6Q.js"}