import{r as l,j as e}from"./index-8LC8IQKY.js";const E=()=>{const[m,c]=l.useState([]),[p,h]=l.useState(!0),[o,r]=l.useState(null);l.useEffect(()=>{let t=!1;async function s(){h(!0),r(null);try{const a=await fetch("/api/patients/with-profiles");if(!a.ok)throw new Error(await a.text());const n=await a.json();t||c(Array.isArray(n?.items)?n.items:[])}catch(a){t||r(a?.message||"Failed to load")}finally{t||h(!1)}}return s(),()=>{t=!0}},[]);const[d,y]=l.useState({}),[x,f]=l.useState({}),u=async t=>{y(s=>({...s,[t]:!0}));try{const s=await fetch(`/api/patients/${encodeURIComponent(t)}/with-profile`);if(!s.ok)throw new Error(await s.text());const a=await s.json();c(n=>n.map(i=>i.id===t?{id:t,patient:a.patient,profile:a.profile}:i))}catch(s){r(s?.message||"Failed to refresh patient profile"),setTimeout(()=>r(null),3e3)}finally{y(s=>({...s,[t]:!1}))}},j=async t=>{f(s=>({...s,[t]:!0}));try{const s=await fetch(`/api/patients/${encodeURIComponent(t)}/sync-profile`,{method:"POST"});if(!s.ok)throw new Error(await s.text());const a=await s.json();c(n=>n.map(i=>i.id===t?{id:t,patient:i.patient,profile:a.profile}:i))}catch(s){r(s?.message||"Failed to rebuild patient profile"),setTimeout(()=>r(null),3e3)}finally{f(s=>({...s,[t]:!1}))}};return e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Patient Profiles Diagnostics"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Joined view of patients and patient_profiles to verify synchronization."}),p&&e.jsx("div",{className:"text-sm text-gray-600",children:"Loading…"}),o&&e.jsx("div",{className:"text-sm text-red-600",children:o}),!p&&!o&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Patient ID"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"MRN"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Meds"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Allergies"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Comorbidities"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Genetics"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Updated"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[m.map(({id:t,patient:s,profile:a})=>{const n=s?.demographics||{},i=`${n.firstName||""} ${n.lastName||""}`.trim(),N=n.mrn||"",b=a?.current_medications?.length||0,w=a?.allergies?.length||0,v=a?.comorbidities?.length||0,S=Array.isArray(a?.genetic_profile)?a.genetic_profile.length:0,g=a?.updated_at||s?.updated_at||"";return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 text-gray-900 font-mono text-xs",children:t}),e.jsx("td",{className:"px-3 py-2 text-gray-900",children:i||"—"}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:N||"—"}),e.jsx("td",{className:"px-3 py-2",children:b}),e.jsx("td",{className:"px-3 py-2",children:w}),e.jsx("td",{className:"px-3 py-2",children:v}),e.jsx("td",{className:"px-3 py-2",children:S}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:g?new Date(g).toLocaleString():"—"}),e.jsxs("td",{className:"px-3 py-2 space-x-2",children:[e.jsx("button",{onClick:()=>u(t),disabled:!!d[t],className:`px-3 py-1.5 rounded-md text-white text-xs ${d[t]?"bg-gray-400":"bg-primary-600 hover:bg-primary-700"}`,title:"Refresh this row",children:d[t]?"Syncing…":"Sync Now"}),e.jsx("button",{onClick:()=>j(t),disabled:!!x[t],className:`px-3 py-1.5 rounded-md text-white text-xs ${x[t]?"bg-gray-400":"bg-indigo-600 hover:bg-indigo-700"}`,title:"Rebuild profile from patient data",children:x[t]?"Rebuilding…":"Rebuild Now"})]})]},t)}),m.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-center text-gray-500",colSpan:8,children:"No patients found."})})]})]})})]})};export{E as default};
