import{f as G,r,j as e,e as z,T as J,P as Z,_ as X,m as W,u as q}from"./index-4Ly-s4cr.js";import{a as Q}from"./env-HZVIiKqO.js";import{d as H,i as ee}from"./api-BfpE7lHs.js";import{C as K}from"./Card-DLOVFYwQ.js";import{A as se}from"./Alert-D2KfDB-X.js";import{L as te}from"./LoadingSpinner-BK8GoEPg.js";import{A as ae}from"./AutoComplete-DKJQY6mP.js";import"./circle-x-DA35Ia3u.js";import"./circle-check-big-DzqNVPmE.js";import"./check-pB4liXIF.js";const M=({onDrugSelect:E,placeholder:T="Search for medications (e.g., aspirin, warfarin, pembrolizumab)...",showTooltips:g=!0,allowMultiple:L=!1,maxSuggestions:u=10,className:k=""})=>{const j=G(),[I,h]=r.useState([]),[O,y]=r.useState(!1),[R,S]=r.useState(null),[p,A]=r.useState([]),w=["aspirin","ibuprofen","acetaminophen","warfarin","clopidogrel","pembrolizumab","nivolumab","fluorouracil","capecitabine","paclitaxel","cisplatin","carboplatin","doxorubicin","imatinib","tamoxifen","metformin","atorvastatin","amlodipine","omeprazole","hydrochlorothiazide"];r.useEffect(()=>{try{const n=localStorage.getItem("oncosaferx_search_history");n&&A(JSON.parse(n).slice(0,5))}catch(n){console.warn("Failed to load search history:",n)}},[]);const _=r.useCallback(n=>{const d=[n,...p.filter(l=>l.rxcui!==n.rxcui)].slice(0,5);A(d);try{localStorage.setItem("oncosaferx_search_history",JSON.stringify(d))}catch(l){console.warn("Failed to save search history:",l)}},[p]),V=r.useCallback(async n=>{if(n.length<2){const d=p.map(l=>({value:l.rxcui,label:l.name,description:`RXCUI: ${l.rxcui}${l.tty?` • ${l.tty}`:""}`,category:"Recent Searches",metadata:l}));h(d);return}y(!0),S(null);try{const l=(await H.searchDrugs(n)).results.slice(0,u).map(c=>({value:c.rxcui,label:c.name,description:`RXCUI: ${c.rxcui}${c.tty?` • ${c.tty}`:""}`,category:c.tty||"Medications",metadata:c})),x=[...n.length<4?p.filter(c=>c.name.toLowerCase().includes(n.toLowerCase())).map(c=>({value:c.rxcui,label:c.name,description:`RXCUI: ${c.rxcui}${c.tty?` • ${c.tty}`:""}`,category:"Recent Searches",metadata:c})):[],...l];if(x.length===0){const c=n.toLowerCase(),v=w.filter(t=>t.includes(c)).slice(0,u).map(t=>({value:t,label:t,description:"Local suggestion",category:"Suggestions",metadata:void 0}));h(v)}else h(x)}catch(d){S(d instanceof Error?d.message:"Failed to search drugs");const l=n.toLowerCase(),m=w.filter(x=>x.includes(l)).slice(0,u).map(x=>({value:x,label:x,description:"Local suggestion",category:"Suggestions",metadata:void 0}));h(m)}finally{y(!1)}},[p,u]),B=async n=>{const d=n.metadata;if(d){_(d),j.addDrug(d);try{const{rxcui:l,name:m}=d;(await X(async()=>{const{analytics:x}=await import("./analytics-DcoOYTyl.js");return{analytics:x}},[])).analytics.logSelection(l,m,"autocomplete")}catch{}E(d);return}try{const l=await H.searchDrugs(n.label);if(l.count>0){const m=l.results[0];_(m),j.addDrug(m);try{const{rxcui:x,name:c}=m;(await X(async()=>{const{analytics:v}=await import("./analytics-DcoOYTyl.js");return{analytics:v}},[])).analytics.logSelection(x,c,"autocomplete")}catch{}E(m)}}catch{}},$=()=>e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsx("div",{className:"font-semibold",children:"Search Tips:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:'Search by generic name (e.g., "aspirin")'}),e.jsx("li",{children:'Search by brand name (e.g., "Tylenol")'}),e.jsx("li",{children:'Use partial names (e.g., "pembro" for pembrolizumab)'}),e.jsx("li",{children:`Case doesn't matter (e.g., "WARFARIN" = "warfarin")`})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[e.jsx("div",{className:"font-semibold",children:"Drug Types Supported:"}),e.jsx("div",{className:"text-gray-600",children:"Oncology drugs, supportive care, anticoagulants, and more"})]})]}),U=()=>e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsx("div",{className:"font-semibold text-amber-200",children:"Clinical Safety:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Always verify drug selection"}),e.jsx("li",{children:"Check for interaction alerts"}),e.jsx("li",{children:"Consider patient-specific factors"}),e.jsx("li",{children:"Consult clinical guidelines"})]}),e.jsx("div",{className:"mt-2 pt-2 border-t border-amber-200",children:e.jsx("div",{className:"text-amber-200",children:"This tool supports clinical decision-making but does not replace professional judgment"})})]});return e.jsxs("div",{className:`relative ${k}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ae,{options:I,placeholder:T,onSelect:B,onSearch:V,loading:O,caseSensitive:!1,highlightMatches:!0,groupByCategory:!0,maxResults:u,minChars:2,debounceMs:300,allowCustom:!1,noResultsText:"No medications found. Try a different search term.",searchKeys:["label","description"],className:"w-full",dropdownClassName:"border-2 border-blue-200",disableFiltering:!0})}),g&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(z,{content:$(),type:"help",iconOnly:!0,position:"bottom-right",maxWidth:"max-w-sm"}),e.jsx(z,{content:U(),type:"clinical",iconOnly:!0,position:"bottom-right",maxWidth:"max-w-sm",children:e.jsx(J,{className:"w-4 h-4 text-purple-600"})})]})]}),R&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700",children:R})]})}),p.length>0&&e.jsxs("div",{className:"mt-2 flex items-center text-xs text-gray-500",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),e.jsxs("span",{children:["Recent: ",p.slice(0,3).map(n=>n.name).join(", ")]}),p.length>3&&e.jsxs("span",{children:[" and ",p.length-3," more..."]})]})]})},re={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ALLOW_DEMO_LOGIN:"false",VITE_API_URL:"https://oncosaferx-backend.onrender.com/api",VITE_APP_VERSION:"1.0.0",VITE_ENABLE_SERVER_ANALYTICS:"false",VITE_SKIP_SUPABASE_PREFLIGHT:"true",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVtZnJ3Y2t4Y3R5YXJwaGp2ZmV1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwNjM2NjcsImV4cCI6MjA3MzYzOTY2N30.yYrhigcrMY82OkA4KPqSANtN5YgeA6xGH9fnrTe5k8c",VITE_SUPABASE_AUTH_VIA_PROXY:"true",VITE_SUPABASE_URL:"https://emfrwckxctyarphjvfeu.supabase.co"},pe=()=>{const E=W(),T=q(),[g,L]=r.useState(""),[u,k]=r.useState(""),[j,I]=r.useState(""),[h,O]=r.useState(""),[y,R]=r.useState(!0),[S,p]=r.useState(null),[A,w]=r.useState("severity"),[_,V]=r.useState("desc"),[B,$]=r.useState({}),[U,n]=r.useState(!1),[d,l]=r.useState(null),m=G(),x=typeof window<"u"&&localStorage.getItem("allow_curated_editor")==="1",[c,v]=r.useState(!1),[t,b]=r.useState({a:"",b:"",severity:"moderate",mechanism:"",effect:"",management:"",evidence_level:"",sources:""}),P=async()=>{n(!0),l(null);try{const s=await ee.getKnownInteractions({drug:g,drugA:u,drugB:j,severity:h,resolveRx:y?"true":"false"});p({count:s.count,total:s.total,interactions:s.interactions||[]}),s.message&&s.message.includes("cached interaction data")&&console.info("Using fallback interaction data - API not available")}catch(s){l(s instanceof Error?s.message:"Failed to load curated interactions")}finally{n(!1)}};r.useEffect(()=>{const s=new URLSearchParams(E.search),a=s.get("drug")||"",i=s.get("drugA")||"",o=s.get("drugB")||"",N=s.get("severity")||"",C=s.get("resolveRx");L(a),k(i),I(o),O(N),R(C?C==="true":!0)},[E.search]),r.useEffect(()=>{if(!g&&m.selectedDrugs.length>0){const s=m.selectedDrugs.map(a=>a.name);L(s[0]||""),k(s[0]||""),I(s[1]||"")}},[]),r.useEffect(()=>{P()},[g,u,j,h,y]),r.useEffect(()=>{P()},[]);const F=s=>{const a=new URLSearchParams;g&&a.set("drug",g),u&&a.set("drugA",u),j&&a.set("drugB",j),h&&a.set("severity",h),y&&a.set("resolveRx","true"),a.set("view",s);const i=`${Q()}/interactions/known?${a.toString()}`;window.open(i,"_blank")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Curated Drug Interactions"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>F("csv"),className:"px-3 py-2 bg-primary-600 text-white rounded-md",children:"Export CSV"}),e.jsx("button",{onClick:()=>F("tsv"),className:"px-3 py-2 bg-gray-700 text-white rounded-md",children:"Export TSV"}),x&&e.jsx("button",{onClick:()=>v(!0),className:"px-3 py-2 bg-emerald-600 text-white rounded-md",children:"Add Curated"})]})]}),e.jsxs(K,{children:[e.jsxs("div",{className:"grid md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Drug"}),e.jsx(M,{onDrugSelect:s=>L(s.name),placeholder:"Search or select a drug (e.g., aspirin)",showTooltips:!1,className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Drug A"}),e.jsx(M,{onDrugSelect:s=>k(s.name),placeholder:"Search or select Drug A",showTooltips:!1,className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Drug B"}),e.jsx(M,{onDrugSelect:s=>I(s.name),placeholder:"Search or select Drug B",showTooltips:!1,className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Severity"}),e.jsxs("select",{value:h,onChange:s=>O(s.target.value),className:"w-full border rounded-md px-3 py-2",children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{value:"major",children:"Major"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"minor",children:"Minor"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"inline-flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:s=>R(s.target.checked)}),e.jsx("span",{className:"text-sm text-gray-700",children:"Resolve RXCUIs"})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center space-x-2",children:[e.jsx("button",{onClick:P,className:"px-4 py-2 bg-primary-600 text-white rounded-md",children:"Search"}),e.jsx("button",{onClick:()=>{const s=new URLSearchParams;g&&s.set("drug",g),u&&s.set("drugA",u),j&&s.set("drugB",j),h&&s.set("severity",h),y&&s.set("resolveRx","true"),T({pathname:"/curated",search:s.toString()?`?${s.toString()}`:""})},className:"px-3 py-2 bg-gray-100 text-gray-700 rounded-md",children:"Shareable Link"})]})]}),d&&e.jsx(se,{type:"error",title:"Error",children:d}),U&&e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx(te,{})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Add Curated Interaction"}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-600",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Drug A"}),e.jsx("input",{value:t.a,onChange:s=>b({...t,a:s.target.value}),className:"w-full border rounded px-2 py-1 text-sm",placeholder:"e.g., warfarin"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Drug B"}),e.jsx("input",{value:t.b,onChange:s=>b({...t,b:s.target.value}),className:"w-full border rounded px-2 py-1 text-sm",placeholder:"e.g., aspirin"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Severity"}),e.jsxs("select",{value:t.severity,onChange:s=>b({...t,severity:s.target.value}),className:"w-full border rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"major",children:"major"}),e.jsx("option",{value:"moderate",children:"moderate"}),e.jsx("option",{value:"minor",children:"minor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Evidence level"}),e.jsx("input",{value:t.evidence_level,onChange:s=>b({...t,evidence_level:s.target.value}),className:"w-full border rounded px-2 py-1 text-sm",placeholder:"e.g., A/B/C"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Mechanism"}),e.jsx("textarea",{value:t.mechanism,onChange:s=>b({...t,mechanism:s.target.value}),className:"w-full border rounded px-2 py-1 text-sm",rows:2})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Effect"}),e.jsx("textarea",{value:t.effect,onChange:s=>b({...t,effect:s.target.value}),className:"w-full border rounded px-2 py-1 text-sm",rows:2})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Management"}),e.jsx("textarea",{value:t.management,onChange:s=>b({...t,management:s.target.value}),className:"w-full border rounded px-2 py-1 text-sm",rows:2})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Sources (comma-separated or URLs)"}),e.jsx("input",{value:t.sources,onChange:s=>b({...t,sources:s.target.value}),className:"w-full border rounded px-2 py-1 text-sm"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>v(!1),className:"px-3 py-1.5 text-sm bg-gray-100 rounded",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{const s=localStorage.getItem("curated_admin_token")||String(re?.VITE_CURATED_EDITOR_TOKEN||"");if(!s){alert("Missing admin token. Set localStorage.curated_admin_token or VITE_CURATED_EDITOR_TOKEN.");return}const a={drugs:[t.a,t.b],severity:t.severity,mechanism:t.mechanism,effect:t.effect,management:t.management,evidence_level:t.evidence_level,sources:t.sources.split(",").map(o=>o.trim()).filter(Boolean)},i=await fetch("/api/interactions/known",{method:"POST",headers:{"Content-Type":"application/json","x-admin-token":s},body:JSON.stringify(a)});if(!i.ok){const o=await i.text();throw new Error(`Failed: ${i.status} ${o}`)}v(!1),P()}catch{alert("Failed to add curated interaction")}},className:"px-3 py-1.5 text-sm bg-emerald-600 text-white rounded",children:"Save"})]})]})}),!U&&S&&e.jsxs(K,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Results (",S.count,"/",S.total,")"]}),e.jsxs("div",{className:"text-xs text-gray-600 inline-flex items-center gap-2",children:[e.jsx("span",{children:"Sort:"}),e.jsxs("select",{className:"border rounded px-1 py-0.5",value:A,onChange:s=>w(s.target.value),children:[e.jsx("option",{value:"severity",children:"Severity"}),e.jsx("option",{value:"drugA",children:"Drug A"}),e.jsx("option",{value:"drugB",children:"Drug B"})]}),e.jsx("button",{className:"underline",onClick:()=>V(s=>s==="asc"?"desc":"asc"),children:_==="asc"?"Asc":"Desc"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-2 pr-4 cursor-pointer",onClick:()=>w("drugA"),children:"Drug A"}),e.jsx("th",{className:"py-2 pr-4 cursor-pointer",onClick:()=>w("drugB"),children:"Drug B"}),e.jsx("th",{className:"py-2 pr-4 cursor-pointer",onClick:()=>w("severity"),children:"Severity"}),e.jsx("th",{className:"py-2 pr-4",children:"Effect"}),e.jsx("th",{className:"py-2 pr-4",children:"Management"}),e.jsx("th",{className:"py-2 pr-4",children:"Sources"}),e.jsx("th",{className:"py-2 pr-4",children:"Actions"})]})}),e.jsx("tbody",{children:S.interactions.slice().sort((s,a)=>{const i=(s.drug_rxnorm?.[0]?.name||s.drugs?.[0]||"").toLowerCase(),o=(s.drug_rxnorm?.[1]?.name||s.drugs?.[1]||"").toLowerCase(),N=(a.drug_rxnorm?.[0]?.name||a.drugs?.[0]||"").toLowerCase(),C=(a.drug_rxnorm?.[1]?.name||a.drugs?.[1]||"").toLowerCase();if(A==="drugA")return(_==="asc"?1:-1)*(i>N?1:i<N?-1:0);if(A==="drugB")return(_==="asc"?1:-1)*(o>C?1:o<C?-1:0);const f=Y=>({major:3,high:3,moderate:2,minor:1,low:1})[(Y||"").toLowerCase()]||0,D=f(s.severity)-f(a.severity);return(_==="asc"?1:-1)*(D===0?0:D)}).map((s,a)=>{const i=s.drug_rxnorm?.[0],o=s.drug_rxnorm?.[1],N=(s.severity||"").toLowerCase(),C=N==="major"||N==="high"?"bg-red-100 text-red-800":N==="moderate"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-700";return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-b align-top",children:[e.jsx("td",{className:"py-2 pr-4",children:i?`${i.name} ${i.rxcui?`(RXCUI ${i.rxcui})`:""}`:s.drugs[0]}),e.jsx("td",{className:"py-2 pr-4",children:o?`${o.name} ${o.rxcui?`(RXCUI ${o.rxcui})`:""}`:s.drugs[1]}),e.jsxs("td",{className:"py-2 pr-4 capitalize",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${C}`,children:s.severity||"unknown"}),s.evidence_level&&e.jsxs("span",{className:"ml-2 text-[11px] text-gray-500",children:["Evidence ",s.evidence_level]})]}),e.jsx("td",{className:"py-2 pr-4",children:s.effect||"-"}),e.jsx("td",{className:"py-2 pr-4",children:s.management||"-"}),e.jsx("td",{className:"py-2 pr-4",children:Array.isArray(s.sources)&&s.sources.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:s.sources.map((f,D)=>/^https?:\/\//i.test(String(f))?e.jsx("a",{href:String(f),target:"_blank",rel:"noreferrer",className:"text-blue-700 hover:underline text-xs",children:"Source"},D):e.jsx("span",{className:"text-xs text-gray-700 bg-gray-100 rounded px-2 py-0.5",children:f},D))}):"-"}),e.jsx("td",{className:"py-2 pr-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-xs text-primary-700 underline",onClick:()=>{i?.name&&m.addDrug({name:i.name,rxcui:i.rxcui||""}),o?.name&&m.addDrug({name:o.name,rxcui:o.rxcui||""})},children:"Add both"}),e.jsx("button",{className:"text-xs text-blue-700 underline",onClick:()=>{i?.name&&m.addDrug({name:i.name,rxcui:i.rxcui||""}),o?.name&&m.addDrug({name:o.name,rxcui:o.rxcui||""}),setTimeout(()=>T("/interactions"),100)},children:"Open checker"}),e.jsx("button",{className:"text-xs text-gray-700 underline",onClick:()=>$(f=>({...f,[a]:!f[a]})),children:B[a]?"Hide":"Details"})]})})]},a),B[a]&&e.jsx("tr",{className:"border-b bg-gray-50",children:e.jsx("td",{colSpan:7,className:"p-3",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Mechanism"}),e.jsx("div",{className:"text-gray-800",children:s.mechanism||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Effect"}),e.jsx("div",{className:"text-gray-800",children:s.effect||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Management"}),e.jsx("div",{className:"text-gray-800",children:s.management||"-"})]})]})})})]})})})]})})]})]})};export{pe as default};
//# sourceMappingURL=CuratedInteractions-CfpU75D1.js.map
