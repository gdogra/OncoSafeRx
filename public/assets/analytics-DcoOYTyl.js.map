{"version":3,"file":"analytics-DcoOYTyl.js","sources":["../../src/utils/analytics.ts"],"sourcesContent":["export type SearchEvent = {\n  t: number; // timestamp\n  q: string;\n  count?: number;\n};\n\nexport type SelectionEvent = {\n  t: number;\n  rxcui: string;\n  name: string;\n  source?: string; // e.g., 'search_results', 'autocomplete', 'card_action'\n};\n\nconst KEYS = {\n  searches: 'oncosaferx_analytics_searches',\n  selections: 'oncosaferx_analytics_selections',\n};\n\nfunction append<T>(key: string, item: T, max = 200) {\n  try {\n    const raw = localStorage.getItem(key);\n    const list: T[] = raw ? JSON.parse(raw) : [];\n    list.unshift(item);\n    if (list.length > max) list.pop();\n    localStorage.setItem(key, JSON.stringify(list));\n  } catch {}\n}\n\nexport const analytics = {\n  logSearch(q: string, count?: number) {\n    append<SearchEvent>(KEYS.searches, { t: Date.now(), q, count });\n  },\n  logSelection(rxcui: string, name: string, source?: string) {\n    append<SelectionEvent>(KEYS.selections, { t: Date.now(), rxcui, name, source });\n  },\n  clearSearches() {\n    try { localStorage.removeItem(KEYS.searches); } catch {}\n  },\n  clearSelections() {\n    try { localStorage.removeItem(KEYS.selections); } catch {}\n  },\n  getRecentSearches(limit = 8): string[] {\n    try {\n      const raw = localStorage.getItem(KEYS.searches);\n      const list: SearchEvent[] = raw ? JSON.parse(raw) : [];\n      const seen = new Set<string>();\n      const recent: string[] = [];\n      for (const e of list) {\n        const q = (e.q || '').trim();\n        if (!q) continue;\n        if (seen.has(q.toLowerCase())) continue;\n        seen.add(q.toLowerCase());\n        recent.push(q);\n        if (recent.length >= limit) break;\n      }\n      return recent;\n    } catch {\n      return [];\n    }\n  },\n  getTopSelections(days = 30, limit = 5): Array<{ rxcui: string; name: string; count: number }> {\n    try {\n      const raw = localStorage.getItem(KEYS.selections);\n      const list: SelectionEvent[] = raw ? JSON.parse(raw) : [];\n      const cutoff = Date.now() - days * 24 * 60 * 60 * 1000;\n      const counts: Record<string, { name: string; count: number }> = {};\n      list.filter(e => e.t >= cutoff).forEach(e => {\n        const key = e.rxcui || e.name;\n        if (!counts[key]) counts[key] = { name: e.name, count: 0 };\n        counts[key].count += 1;\n      });\n      return Object.entries(counts)\n        .map(([rxcuiOrName, v]) => ({ rxcui: rxcuiOrName, name: v.name, count: v.count }))\n        .sort((a, b) => b.count - a.count)\n        .slice(0, limit);\n    } catch {\n      return [];\n    }\n  },\n};\n"],"names":["KEYS","append","key","item","max","raw","list","analytics","q","count","rxcui","name","source","limit","seen","recent","e","days","cutoff","counts","rxcuiOrName","v","a","b"],"mappings":"AAaA,MAAMA,EAAO,CACX,SAAU,gCACV,WAAY,iCACd,EAEA,SAASC,EAAUC,EAAaC,EAASC,EAAM,IAAK,CAClD,GAAI,CACF,MAAMC,EAAM,aAAa,QAAQH,CAAG,EAC9BI,EAAYD,EAAM,KAAK,MAAMA,CAAG,EAAI,CAAA,EAC1CC,EAAK,QAAQH,CAAI,EACbG,EAAK,OAASF,GAAKE,EAAK,IAAA,EAC5B,aAAa,QAAQJ,EAAK,KAAK,UAAUI,CAAI,CAAC,CAChD,MAAQ,CAAC,CACX,CAEO,MAAMC,EAAY,CACvB,UAAUC,EAAWC,EAAgB,CACnCR,EAAoBD,EAAK,SAAU,CAAE,EAAG,KAAK,IAAA,EAAO,EAAAQ,EAAG,MAAAC,EAAO,CAChE,EACA,aAAaC,EAAeC,EAAcC,EAAiB,CACzDX,EAAuBD,EAAK,WAAY,CAAE,EAAG,KAAK,MAAO,MAAAU,EAAO,KAAAC,EAAM,OAAAC,EAAQ,CAChF,EACA,eAAgB,CACd,GAAI,CAAE,aAAa,WAAWZ,EAAK,QAAQ,CAAG,MAAQ,CAAC,CACzD,EACA,iBAAkB,CAChB,GAAI,CAAE,aAAa,WAAWA,EAAK,UAAU,CAAG,MAAQ,CAAC,CAC3D,EACA,kBAAkBa,EAAQ,EAAa,CACrC,GAAI,CACF,MAAMR,EAAM,aAAa,QAAQL,EAAK,QAAQ,EACxCM,EAAsBD,EAAM,KAAK,MAAMA,CAAG,EAAI,CAAA,EAC9CS,MAAW,IACXC,EAAmB,CAAA,EACzB,UAAWC,KAAKV,EAAM,CACpB,MAAME,GAAKQ,EAAE,GAAK,IAAI,KAAA,EACtB,GAAKR,GACD,CAAAM,EAAK,IAAIN,EAAE,YAAA,CAAa,IAC5BM,EAAK,IAAIN,EAAE,aAAa,EACxBO,EAAO,KAAKP,CAAC,EACTO,EAAO,QAAUF,GAAO,KAC9B,CACA,OAAOE,CACT,MAAQ,CACN,MAAO,CAAA,CACT,CACF,EACA,iBAAiBE,EAAO,GAAIJ,EAAQ,EAA0D,CAC5F,GAAI,CACF,MAAMR,EAAM,aAAa,QAAQL,EAAK,UAAU,EAC1CM,EAAyBD,EAAM,KAAK,MAAMA,CAAG,EAAI,CAAA,EACjDa,EAAS,KAAK,IAAA,EAAQD,EAAO,GAAK,GAAK,GAAK,IAC5CE,EAA0D,CAAA,EAChE,OAAAb,EAAK,OAAO,GAAK,EAAE,GAAKY,CAAM,EAAE,QAAQ,GAAK,CAC3C,MAAMhB,EAAM,EAAE,OAAS,EAAE,KACpBiB,EAAOjB,CAAG,IAAGiB,EAAOjB,CAAG,EAAI,CAAE,KAAM,EAAE,KAAM,MAAO,CAAA,GACvDiB,EAAOjB,CAAG,EAAE,OAAS,CACvB,CAAC,EACM,OAAO,QAAQiB,CAAM,EACzB,IAAI,CAAC,CAACC,EAAaC,CAAC,KAAO,CAAE,MAAOD,EAAa,KAAMC,EAAE,KAAM,MAAOA,EAAE,KAAA,EAAQ,EAChF,KAAK,CAACC,EAAGC,IAAMA,EAAE,MAAQD,EAAE,KAAK,EAChC,MAAM,EAAGT,CAAK,CACnB,MAAQ,CACN,MAAO,CAAA,CACT,CACF,CACF"}