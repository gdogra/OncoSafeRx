import{r as p,j as e}from"./index-8LC8IQKY.js";import{p as Re}from"./patientService-Cm5QzZs7.js";import{U as I}from"./upload-DwNpUxEi.js";import{D as P}from"./dna-CkqnhaTf.js";import{T as q}from"./target-BsLO2_W8.js";import{U as Y}from"./users-CyD4O_24.js";import{A as J}from"./activity-BXSagPiR.js";import{T as L}from"./triangle-alert-BOEc2-VO.js";import{F as K}from"./file-text-CyEOTfEa.js";import{T as W}from"./trending-up-B8-67GCO.js";import{C as X}from"./clock-cnhIl4So.js";import{E as Se}from"./external-link-Do2W_skG.js";import{C as D}from"./circle-check-big-CYsdojUB.js";import{F as Pe}from"./FeatureErrorBoundary-C-SWZJ4k.js";import"./createLucideIcon-DlukwGQd.js";import"./refresh-cw-COcu3qHG.js";import"./house-svls-J_z.js";const A=class A{static async processNGSReport(s,t){try{const i=await this.readFileContent(s),r=await this.parseNGSFile(i,s.name);return{id:`ngs_${Date.now()}`,patientId:t,reportDate:new Date().toISOString().split("T")[0],testType:this.detectTestType(r),platform:r.platform||"Unknown",laboratoryName:r.laboratory||"Unknown",sampleInfo:{type:r.sampleType||"tissue",site:r.sampleSite||"Unknown",collectionDate:r.collectionDate||new Date().toISOString().split("T")[0],tumorCellularity:r.tumorCellularity},variants:await this.annotateVariants(r.variants||[]),copyNumberVariants:r.copyNumberVariants||[],structuralVariants:r.structuralVariants||[],microsatelliteStatus:r.microsatelliteStatus||"unknown",tumorMutationalBurden:r.tumorMutationalBurden||0,homologousRecombinationDeficiency:r.hrdScore,qualityMetrics:{averageCoverage:r.averageCoverage||0,percentCovered:r.percentCovered||0,contamination:r.contamination||0},clinicalInterpretation:await this.generateClinicalInterpretation(r),recommendedActions:await this.generateRecommendedActions(r)}}catch(i){throw console.error("Error processing NGS report:",i),new Error("Failed to process NGS report")}}static async analyzeGenomicProfile(s,t){try{const i=await this.aiInterpretVariants(t.variants,s),r=await this.identifyActionableVariants(i),n=await this.findPersonalizedTreatments(r,s),d=await this.aiMatchClinicalTrials(s,r),c=await this.assessHereditaryRisks(t.variants),g=await this.analyzeAdvancedPharmacogenomics(t.variants,s),x=await this.predictResistance(r,n);return{patientId:s.id,analysisDate:new Date().toISOString().split("T")[0],actionableVariants:r,treatmentOptions:n,clinicalTrials:d,hereditaryRisks:c,pharmacogenomics:g,resistancePredictions:x,executiveSummary:this.generateAIExecutiveSummary(r,n,d,s),keyRecommendations:this.generatePersonalizedRecommendations(n,d,c,s)}}catch(i){throw console.error("Error analyzing genomic profile:",i),new Error("Failed to analyze genomic profile")}}static getBiomarkerPanels(){return[{id:"foundation_one_cdx",name:"FoundationOne CDx",cancerTypes:["Solid tumors"],biomarkers:[{name:"BRCA1/2 mutations",gene:"BRCA1",type:"mutation",methodology:"NGS",therapeuticRelevance:[{drug:"Olaparib",indication:"Ovarian cancer",evidenceLevel:"FDA_approved",response:"responsive",description:"PARP inhibitor for BRCA-mutated cancers"}]},{name:"EGFR mutations",gene:"EGFR",type:"mutation",methodology:"NGS",therapeuticRelevance:[{drug:"Erlotinib",indication:"NSCLC",evidenceLevel:"FDA_approved",response:"responsive",description:"EGFR TKI for sensitizing mutations"}]}],methodology:"Next-generation sequencing",turnaroundTime:14,cost:5800},{id:"guardant360",name:"Guardant360",cancerTypes:["Solid tumors"],biomarkers:[{name:"Circulating tumor DNA",type:"mutation",methodology:"NGS",therapeuticRelevance:[{drug:"Various targeted therapies",indication:"Multiple cancers",evidenceLevel:"FDA_approved",response:"responsive",description:"Liquid biopsy for actionable mutations"}]}],methodology:"Liquid biopsy NGS",turnaroundTime:7,cost:4200}]}static async aiInterpretVariants(s,t){return s.map(i=>({...i,aiConfidence:this.calculateAIConfidence(i),patientSpecificScore:this.calculatePatientSpecificScore(i,t),actionabilityScore:this.calculateActionabilityScore(i),aiInterpretation:this.generateAIInterpretation(i,t)}))}static async findPersonalizedTreatments(s,t){const i=[];for(const n of s)for(const d of n.therapeuticImplications)if(d.implication==="responsive"){const c=this.calculatePersonalizedTreatmentScore(d.drug,t,n);i.push({drug:d.drug,drugClass:d.drugClass,mechanism:this.getDrugMechanism(d.drug),fdaApproval:this.getFDAApprovalStatus(d.drug,t.diagnosis),evidenceLevel:this.mapEvidenceLevel(d.evidenceLevel),supportingVariants:[`${n.gene} ${n.variant}`],contraindications:this.getPersonalizedContraindications(d.drug,t),expectedResponse:this.getPersonalizedResponse(d.evidenceLevel,t),references:d.references,personalizedScore:c,aiRecommendation:this.generateAITreatmentRecommendation(d.drug,t,n)})}return this.deduplicateTreatmentOptions(i).sort((n,d)=>(d.personalizedScore||0)-(n.personalizedScore||0))}static async aiMatchClinicalTrials(s,t){try{const i="/api",r=t.map(x=>`${x.gene} ${x.mutation}`),n=new URLSearchParams;s.diagnosis&&n.append("condition",s.diagnosis),r.forEach(x=>n.append("biomarker",x)),n.append("status","recruiting");const d=await fetch(`${i}/trials/search?${n}`);if(!d.ok)return console.warn("Failed to fetch clinical trials, using fallback data"),this.getFallbackTrials(s,t);const g=(await d.json()).trials.map(x=>({nctId:x.nct_id,title:x.title,phase:x.phase,status:x.status,eligibilityCriteria:{cancerTypes:[x.condition],biomarkers:x.biomarkers||[],priorTreatments:x.eligibility_criteria?.prior_therapies||[],ecogStatus:x.eligibility_criteria?.ecog_status||[0,1],ageRange:x.eligibility_criteria?.age_range||{min:18,max:null}},primaryEndpoint:x.primary_endpoint,secondaryEndpoints:x.secondary_endpoints||[],estimatedEnrollment:x.estimated_enrollment,locations:(x.locations||[]).map(h=>({name:h.name,city:h.city,state:h.state,country:"United States",distance:null})),contact:{name:"Clinical Trials Office",phone:x.contact?.phone||"",email:x.contact?.email||""},matchReasons:this.generateMatchReasons(s,t,x)}));return this.filterTrialsByPatientCriteria(g,s)}catch(i){return console.error("Error fetching clinical trials:",i),await this.getFallbackTrials(s,t)}}static async getFallbackTrials(s,t){try{const i={mutations:t.map(c=>({gene:c.gene,variant:c.variant})),biomarkers:t.filter(c=>c.clinicalSignificance==="pathogenic").map(c=>({gene:c.gene,name:`${c.gene} ${c.variant}`})),tumorType:s.diagnosis},r={condition:s.diagnosis,age:this.calculateAge(s.dateOfBirth),gender:s.gender},n=await fetch("/api/clinical-trials/search-by-genomics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({genomicData:i,patientProfile:r})});if(!n.ok)throw new Error("Failed to fetch clinical trials");return(await n.json()).data.studies.map(c=>({nctId:c.nctId,title:c.title,phase:c.phase,status:c.status,eligibilityCriteria:{cancerTypes:[c.condition],biomarkers:t.map(g=>`${g.gene} ${g.variant}`),priorTreatments:[],ecogStatus:[0,1,2],ageRange:{min:parseInt(c.ageRange?.split("-")?.[0])||18,max:parseInt(c.ageRange?.split("-")?.[1])||85}},primaryEndpoint:"Clinical response",secondaryEndpoints:["Progression-free survival","Overall survival","Safety"],estimatedEnrollment:c.estimatedEnrollment||100,locations:c.locations.map(g=>{const[x,h]=g.split(", "),[T,w]=(h||"").split(" ");return{facility:x||"Clinical Research Center",city:T||"Multiple",state:w||"",country:"USA",status:"recruiting",contactInfo:"clinicaltrials@institution.org"}}),interventions:[{type:"drug",name:c.intervention||"Targeted therapy",description:"Precision medicine approach based on genomic profile",armLabel:"Treatment Arm"}],matchScore:c.eligibilityScore,matchReasons:[...c.eligibilityScore>=90?["High genomic match"]:[],...c.eligibilityScore>=70?["Cancer type match"]:[],"Meets basic eligibility criteria"],url:c.url}))}catch(i){return console.error("Error fetching real clinical trials:",i),[{nctId:"NCT00000000",title:"Clinical trials data temporarily unavailable",phase:"N/A",status:"unavailable",eligibilityCriteria:{cancerTypes:[s.diagnosis],biomarkers:[],priorTreatments:[],ecogStatus:[0,1,2],ageRange:{min:18,max:85}},primaryEndpoint:"Please check ClinicalTrials.gov directly",secondaryEndpoints:[],estimatedEnrollment:0,locations:[],interventions:[],matchScore:0,matchReasons:["Data service temporarily unavailable"],url:"https://clinicaltrials.gov"}]}}static generateMatchReasons(s,t,i){const r=[],n=t.map(c=>`${c.gene} ${c.mutation}`),d=i.biomarkers||[];if(n.forEach(c=>{d.some(g=>g.includes(c)||c.includes(g))&&r.push(`${c} mutation detected`)}),s.diagnosis&&i.condition){const c=s.diagnosis.toLowerCase(),g=i.condition.toLowerCase();(c.includes(g)||g.includes(c))&&r.push("Cancer type match")}return r.length>0?r:["General eligibility criteria met"]}static filterTrialsByPatientCriteria(s,t){return s.filter(i=>{const r=this.calculateAge(t.dateOfBirth),n=r>=i.eligibilityCriteria.ageRange.min&&(i.eligibilityCriteria.ageRange.max===null||r<=i.eligibilityCriteria.ageRange.max),d=i.eligibilityCriteria.cancerTypes.some(g=>t.diagnosis.toLowerCase().includes(g.toLowerCase())),c=i.eligibilityCriteria.ecogStatus.includes(t.ecogPerformanceStatus||1);return n&&d&&c})}static async assessHereditaryRisks(s){const t=[],i=["BRCA1","BRCA2","TP53","MLH1","MSH2","MSH6","PMS2","APC"];for(const r of s)i.includes(r.gene)&&r.clinicalSignificance==="pathogenic"&&t.push({syndrome:this.getAssociatedSyndrome(r.gene),gene:r.gene,variant:r.variant,penetrance:this.getGenePenetrance(r.gene),recommendations:this.getHereditaryRecommendations(r.gene),familyScreening:!0});return t}static async analyzeAdvancedPharmacogenomics(s,t){const i=[],r=["CYP2D6","CYP2C19","CYP3A4","DPYD","UGT1A1","TPMT","SLCO1B1"];for(const n of s)if(r.includes(n.gene)){const d={drug:this.getPGxDrug(n.gene),gene:n.gene,variant:n.variant,phenotype:this.getPGxPhenotype(n.gene,n.variant),recommendation:this.getPersonalizedPGxRecommendation(n.gene,n.variant,t),dosageAdjustment:this.getPersonalizedDosageAdjustment(n.gene,t),warningLevel:this.getPGxWarningLevel(n.gene,n.variant),interactionRisk:this.assessDrugInteractionRisk(n.gene,t),clinicalGuidelines:this.getClinicalGuidelines(n.gene),aiInsight:this.generatePGxAIInsight(n,t)};i.push(d)}return i}static async readFileContent(s){return new Promise((t,i)=>{const r=new FileReader;r.onload=n=>t(n.target?.result),r.onerror=n=>i(n),r.readAsText(s)})}static async parseNGSFile(s,t){try{if(t.endsWith(".json"))return JSON.parse(s);if(t.endsWith(".vcf"))return this.parseVCF(s);throw new Error("Unsupported file format")}catch{throw new Error("Failed to parse NGS file")}}static parseVCF(s){const t=s.split(`
`),i=[];for(const r of t){if(r.startsWith("#"))continue;const n=r.split("	");n.length>=8&&i.push({chromosome:n[0],position:parseInt(n[1]),ref:n[3],alt:n[4],quality:parseFloat(n[5])||0})}return{variants:i}}static detectTestType(s){return s.testType?s.testType:s.sampleType==="blood"?"liquid_biopsy":s.methodology?.includes("RNA")?"rna_seq":"tumor"}static async annotateVariants(s){return s.map((t,i)=>({id:`var_${i}`,gene:t.gene||"Unknown",variant:t.variant||`${t.ref}>${t.alt}`,chromosome:t.chromosome||"",position:t.position||0,ref:t.ref||"",alt:t.alt||"",variantType:t.variantType||"SNV",clinicalSignificance:t.clinicalSignificance||"uncertain",therapeuticImplications:t.therapeuticImplications||[],coverage:t.coverage||0,alleleFrequency:t.alleleFrequency||0,quality:t.quality||0,consequence:t.consequence||"",impact:t.impact||"modifier",annotations:t.annotations||[]}))}static async identifyActionableVariants(s){return s.filter(t=>t.therapeuticImplications.length>0&&t.clinicalSignificance!=="benign")}static getDrugMechanism(s){return{Olaparib:"PARP inhibitor",Erlotinib:"EGFR tyrosine kinase inhibitor",Trastuzumab:"HER2-targeted monoclonal antibody",Pembrolizumab:"PD-1 checkpoint inhibitor"}[s]||"Unknown mechanism"}static getFDAApprovalStatus(s,t){const i=["Olaparib-Ovarian cancer","Erlotinib-NSCLC","Trastuzumab-Breast cancer"],r=`${s}-${t}`;return i.some(n=>r.includes(n.split("-")[0]))?"approved":"off_label"}static mapEvidenceLevel(s){return s==="A"||s==="B"?"high":s==="C"?"moderate":"low"}static getExpectedResponse(s){return s==="A"?"High likelihood of response (>70%)":s==="B"?"Moderate likelihood of response (40-70%)":"Lower likelihood of response (<40%)"}static deduplicateTreatmentOptions(s){const t=new Set;return s.filter(i=>{const r=`${i.drug}-${i.drugClass}`;return t.has(r)?!1:(t.add(r),!0)})}static calculateAge(s){const t=new Date,i=new Date(s);let r=t.getFullYear()-i.getFullYear();const n=t.getMonth()-i.getMonth();return(n<0||n===0&&t.getDate()<i.getDate())&&r--,r}static getAssociatedSyndrome(s){return{BRCA1:"Hereditary Breast and Ovarian Cancer Syndrome",BRCA2:"Hereditary Breast and Ovarian Cancer Syndrome",TP53:"Li-Fraumeni Syndrome",MLH1:"Lynch Syndrome",MSH2:"Lynch Syndrome",MSH6:"Lynch Syndrome",PMS2:"Lynch Syndrome",APC:"Familial Adenomatous Polyposis"}[s]||"Unknown syndrome"}static getGenePenetrance(s){return{BRCA1:.72,BRCA2:.69,TP53:.9,MLH1:.8,MSH2:.8,MSH6:.44,PMS2:.2}[s]||.5}static getHereditaryRecommendations(s){return{BRCA1:["Annual breast MRI starting at age 25","Consider risk-reducing mastectomy","Consider risk-reducing salpingo-oophorectomy"],BRCA2:["Annual breast MRI starting at age 25","Consider risk-reducing mastectomy","Consider risk-reducing salpingo-oophorectomy"],TP53:["Comprehensive cancer screening protocol","Avoid radiation exposure when possible","Annual whole-body MRI"]}[s]||["Genetic counseling recommended"]}static getPGxDrug(s){return{CYP2D6:"Tamoxifen, Codeine",CYP2C19:"Clopidogrel, Omeprazole",DPYD:"5-Fluorouracil, Capecitabine",UGT1A1:"Irinotecan",TPMT:"6-Mercaptopurine, Azathioprine"}[s]||"Unknown"}static getPGxPhenotype(s,t){return t.includes("*1/*1")?"Normal metabolizer":t.includes("*2")||t.includes("*3")?"Poor metabolizer":"Intermediate metabolizer"}static getPGxRecommendation(s,t){return this.getPGxPhenotype(s,t)==="Poor metabolizer"?"Consider alternative therapy or dose reduction":"Standard dosing recommended"}static getPGxDosageAdjustment(s){return"Consult pharmacogenomics guidelines"}static getPGxWarningLevel(s,t){const i=this.getPGxPhenotype(s,t);return i==="Poor metabolizer"?"high":i==="Intermediate metabolizer"?"moderate":"low"}static async generateClinicalInterpretation(s){return"Clinical interpretation based on genomic findings and current evidence."}static async generateRecommendedActions(s){return[]}static generateExecutiveSummary(s,t,i){return`Analysis identified ${s.length} actionable variants with ${t.length} treatment options and ${i.length} matching clinical trials.`}static calculateAIConfidence(s){let t=.5;return s.clinicalSignificance==="pathogenic"&&(t+=.3),s.therapeuticImplications.length>0&&(t+=.2),s.quality>30&&(t+=.1),s.coverage>100&&(t+=.1),Math.min(t,1)}static calculatePatientSpecificScore(s,t){let i=.5;return this.calculateAge(t.dateOfBirth)>65&&s.gene==="TP53"&&(i+=.2),t.diagnosis.toLowerCase().includes("breast")&&s.gene==="BRCA1"&&(i+=.3),t.diagnosis.toLowerCase().includes("lung")&&s.gene==="EGFR"&&(i+=.3),t.ecogPerformanceStatus<=1&&(i+=.1),Math.min(i,1)}static calculateActionabilityScore(s){let t=.3;return s.therapeuticImplications.length>0&&(t+=.4),s.clinicalSignificance==="pathogenic"&&(t+=.3),s.alleleFrequency>.1&&(t+=.2),Math.min(t,1)}static generateAIInterpretation(s,t){this.calculateAge(t.dateOfBirth);const i=t.diagnosis.toLowerCase();return s.gene==="BRCA1"&&i.includes("breast")?"High-impact BRCA1 variant detected. Strong indication for PARP inhibitor therapy. Consider hereditary cancer syndrome evaluation.":s.gene==="EGFR"&&i.includes("lung")?"Actionable EGFR variant identified. First-line EGFR TKI therapy recommended. Monitor for resistance mutations.":`${s.gene} variant with ${s.clinicalSignificance} significance. Clinical correlation recommended.`}static calculatePersonalizedTreatmentScore(s,t,i){let r=.5;i.therapeuticImplications.some(d=>d.evidenceLevel==="A")&&(r+=.3);const n=this.calculateAge(t.dateOfBirth);return n>70&&s==="Chemotherapy"&&(r-=.2),n<50&&s==="Immunotherapy"&&(r+=.1),t.ecogPerformanceStatus<=1&&(r+=.2),t.comorbidities?.includes("Heart disease")&&s.includes("Trastuzumab")&&(r-=.3),Math.max(0,Math.min(r,1))}static getPersonalizedContraindications(s,t){const i=[];return t.comorbidities?.includes("Heart disease")&&s==="Trastuzumab"&&i.push("Cardiac dysfunction - monitor LVEF"),t.comorbidities?.includes("Kidney disease")&&s==="Cisplatin"&&i.push("Renal impairment - dose adjustment required"),this.calculateAge(t.dateOfBirth)>75&&i.push("Advanced age - consider dose reduction"),i}static getPersonalizedResponse(s,t){const i=this.getExpectedResponse(s),r=this.calculateAge(t.dateOfBirth);return t.ecogPerformanceStatus<=1&&r<65?`${i} Enhanced response expected due to excellent performance status.`:r>75||t.ecogPerformanceStatus>2?`${i} Response may be attenuated due to patient factors.`:i}static generateAITreatmentRecommendation(s,t,i){const r=this.calculatePersonalizedTreatmentScore(s,t,i);return r>.8?`Highly recommended: Strong evidence and excellent patient fit for ${s}.`:r>.6?`Recommended: Good evidence supporting ${s} therapy.`:r>.4?`Consider: Moderate evidence for ${s}. Evaluate benefits vs risks.`:`Caution: Limited evidence or patient factors may affect ${s} efficacy.`}static async predictResistance(s,t){const i=[];for(const r of t){const n=this.calculateResistanceRisk(r.drug,s),d=this.identifyResistanceMechanisms(r.drug,s);i.push({drug:r.drug,resistanceRisk:n,mechanisms:d,monitoringStrategy:this.getMonitoringStrategy(r.drug)})}return i}static calculateResistanceRisk(s,t){const i=t.filter(r=>r.therapeuticImplications.some(n=>n.implication==="resistant"));return i.length>2?"high":i.length>0?"moderate":"low"}static identifyResistanceMechanisms(s,t){const i=[];return s==="Erlotinib"&&t.find(n=>n.gene==="EGFR"&&n.variant.includes("T790M"))&&i.push("T790M gatekeeper mutation"),i}static getMonitoringStrategy(s){return{Erlotinib:"Monitor for T790M emergence via liquid biopsy every 3 months",Trastuzumab:"Monitor LVEF every 3 months, assess for HER2 loss",Olaparib:"Monitor for BRCA reversion mutations"}[s]||"Standard oncology monitoring"}static getPersonalizedPGxRecommendation(s,t,i){const r=this.getPGxRecommendation(s,t);return this.calculateAge(i.dateOfBirth)>65&&s==="CYP2D6"?`${r} Additional caution in elderly patients.`:r}static getPersonalizedDosageAdjustment(s,t){return this.calculateAge(t.dateOfBirth)>75?"Consider 25% dose reduction due to advanced age":t.comorbidities?.includes("Kidney disease")?"Dose adjustment required for renal impairment":this.getPGxDosageAdjustment(s)}static assessDrugInteractionRisk(s,t){const i=t.currentMedications||[];return s==="CYP2D6"&&i.some(r=>r.includes("Paroxetine"))?"high":"low"}static getClinicalGuidelines(s){return{CYP2D6:["CPIC Guideline for CYP2D6","FDA Table of Pharmacogenomic Biomarkers"],DPYD:["CPIC Guideline for DPYD","EMA Recommendations for DPYD Testing"]}[s]||["Consult pharmacogenomics guidelines"]}static generatePGxAIInsight(s,t){return this.calculateAge(t.dateOfBirth),s.gene==="DPYD"&&s.clinicalSignificance==="pathogenic"?"Critical finding: High risk for 5-FU toxicity. Alternative chemotherapy strongly recommended.":`${s.gene} variant may affect drug metabolism. Clinical correlation recommended.`}static generateAIExecutiveSummary(s,t,i,r){const n=this.calculateAge(r.dateOfBirth),d=s.filter(g=>g.aiConfidence>.8),c=t.filter(g=>g.personalizedScore>.7);return`AI analysis of ${r.firstName} ${r.lastName} (age ${n}) identified ${d.length} high-confidence actionable variants. ${c.length} personalized treatment options and ${i.length} matching clinical trials available. Personalized recommendations prioritize patient-specific factors including age, performance status, and comorbidities.`}static generatePersonalizedRecommendations(s,t,i,r){const n=[],d=this.calculateAge(r.dateOfBirth),c=s.sort((g,x)=>(x.personalizedScore||0)-(g.personalizedScore||0))[0];return c&&n.push(`Primary recommendation: ${c.drug} (${(c.personalizedScore*100).toFixed(0)}% patient match)`),t.length>0&&n.push(`Evaluate clinical trial eligibility: ${t[0].title}`),i.length>0&&n.push(`Genetic counseling recommended for ${i[0].syndrome}`),d>70&&n.push("Consider geriatric oncology consultation for treatment optimization"),r.ecogPerformanceStatus>2&&n.push("Focus on supportive care and quality of life measures"),n}};A.ONCOKB_API_BASE="https://www.oncokb.org/api/v1",A.CIVIC_API_BASE="https://civicdb.org/api";let N=A;const Ae=()=>{const[u,s]=p.useState("upload"),[t,i]=p.useState(null),[r,n]=p.useState([]),[d,c]=p.useState([]),[g,x]=p.useState(null),[h,T]=p.useState(null),[w,F]=p.useState(!1),[G,M]=p.useState(!1),[Q]=p.useState(N.getBiomarkerPanels()),[Z,k]=p.useState(!1),[b,ee]=p.useState(null),[C,te]=p.useState(null),[E,$]=p.useState(!1),se=async()=>{if(k(!0),!(b&&C)){$(!0);try{const[a,o]=await Promise.all([fetch("/api/genomics/panel").then(l=>l.json()),fetch("/api/genomics/versions").then(l=>l.json())]);ee(a),te(o)}catch(a){console.error("Failed to load panel/versions",a)}finally{$(!1)}}},R=async a=>{O(a),s("pgx-report"),setTimeout(()=>U(),0)},ae=async()=>{try{const o=await(await fetch("/api/genomics/panel.csv")).blob(),l=window.URL.createObjectURL(o),m=document.createElement("a");m.href=l,m.download="pgx_panel.csv",document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(l)}catch(a){console.error("Failed to download panel CSV",a)}},ie=async()=>{try{const o=await(await fetch("/api/genomics/versions.csv")).blob(),l=window.URL.createObjectURL(o),m=document.createElement("a");m.href=l,m.download="pgx_versions.csv",document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(l)}catch(a){console.error("Failed to download versions CSV",a)}},re=async()=>{try{const o=await(await fetch("/api/genomics/panel.bundle")).json(),l=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),m=window.URL.createObjectURL(l),v=document.createElement("a");v.href=m,v.download="pgx_panel_bundle.json",document.body.appendChild(v),v.click(),v.remove(),window.URL.revokeObjectURL(m)}catch(a){console.error("Failed to download bundle JSON",a)}},S=async a=>{try{if(navigator?.clipboard?.writeText)await navigator.clipboard.writeText(a);else{const o=document.createElement("textarea");o.value=a,document.body.appendChild(o),o.select(),document.execCommand("copy"),o.remove()}}catch(o){console.error("Failed to copy text",o)}},ne=()=>{const a=window.location.origin;S(`curl -sSL ${a}/api/genomics/panel.csv -o pgx_panel.csv`)},oe=()=>{const a=window.location.origin;S(`curl -sSL ${a}/api/genomics/versions.csv -o pgx_versions.csv`)},ce=()=>{const a=window.location.origin;S(`curl -sSL ${a}/api/genomics/panel.bundle -o pgx_panel_bundle.json`)};p.useEffect(()=>{n(Re.getPatients())},[]);const le=[{id:"upload",label:"NGS Upload",icon:I,description:"Upload and process NGS reports"},{id:"analysis",label:"Genomic Analysis",icon:P,description:"Comprehensive genomic interpretation"},{id:"treatments",label:"Targeted Therapy",icon:q,description:"Treatment recommendations"},{id:"trials",label:"Clinical Trials",icon:Y,description:"Matching clinical trials"},{id:"biomarkers",label:"Biomarker Panels",icon:J,description:"Available testing panels"},{id:"hereditary",label:"Hereditary Risk",icon:L,description:"Germline risk assessment"},{id:"pgx-report",label:"PGx Report",icon:K,description:"Dynamic gene–drug report"},{id:"pgx-roi",label:"PGx ROI",icon:W,description:"Program ROI calculator"}],de=async a=>{const o=a.target.files?.[0];if(!(!o||!t)){F(!0);try{const l=await N.processNGSReport(o,t.id);c(m=>[...m,l]),x(l),s("analysis")}catch(l){console.error("Upload failed:",l)}finally{F(!1)}}},me=async()=>{if(!(!t||!g)){M(!0);try{const a=await N.analyzeGenomicProfile(t,g);T(a)}catch(a){console.error("Analysis failed:",a)}finally{M(!1)}}},[f,O]=p.useState("11289"),[j,ge]=p.useState(null),[B,z]=p.useState(!1),U=async()=>{if(f){z(!0);try{const o=await(await fetch(`/api/genomics/report/${encodeURIComponent(f)}`)).json();ge(o)}catch(a){console.error("Failed to load PGx report",a)}finally{z(!1)}}},xe=()=>{if(!f)return;const o=`curl -sSL ${window.location.origin}/api/genomics/report/${encodeURIComponent(f)}`;S(o)},[V,pe]=p.useState({annualADECost:1e7,testCost:300,targetPopulation:5e3,expectedTestingRate:.4,expectedADEreductionPct:.25}),[y,he]=p.useState(null),[_,H]=p.useState(!1),ue=async()=>{H(!0);try{const o=await(await fetch("/api/roi/pgx",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)})).json();he(o)}catch(a){console.error("Failed to calculate ROI",a)}finally{H(!1)}},ye=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Patient"}),e.jsxs("select",{value:t?.id||"",onChange:a=>{const o=r.find(l=>l.id===a.target.value);i(o||null)},className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Choose a patient..."}),r.map(a=>e.jsxs("option",{value:a.id,children:[a.firstName," ",a.lastName," - ",a.mrn]},a.id))]})]}),t&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload NGS Report"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(I,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Drop your NGS report here, or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Supports VCF, JSON, and proprietary formats"}),e.jsx("input",{type:"file",onChange:de,accept:".vcf,.json,.txt,.csv",className:"hidden",id:"ngs-upload",disabled:w}),e.jsx("label",{htmlFor:"ngs-upload",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer disabled:opacity-50",children:w?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Choose File"]})})]})]}),d.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Reports"}),e.jsx("div",{className:"space-y-3",children:d.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>{x(a),s("analysis")},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[a.testType," - ",a.platform]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.reportDate," • ",a.laboratoryName]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:[a.variants.length," variants"]}),e.jsx(Se,{className:"w-4 h-4 text-gray-400"})]})]},a.id))})]})]}),be=()=>g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Report Summary"}),e.jsx("button",{onClick:me,disabled:G,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:G?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Run Analysis"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Variants"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 mt-2",children:g.variants.length})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"w-5 h-5 text-green-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-green-900",children:"TMB"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-900 mt-2",children:g.tumorMutationalBurden})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"w-5 h-5 text-purple-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-purple-900",children:"MSI Status"})]}),e.jsx("p",{className:"text-lg font-bold text-purple-900 mt-2",children:g.microsatelliteStatus})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Detected Variants"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gene"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Variant"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Significance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"VAF"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.variants.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.gene}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.variant}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.variantType}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.clinicalSignificance==="pathogenic"?"bg-red-100 text-red-800":a.clinicalSignificance==="likely_pathogenic"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:a.clinicalSignificance})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(a.alleleFrequency*100).toFixed(1),"%"]})]},a.id))})]})})]}),h&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Analysis Results"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Executive Summary"}),e.jsx("p",{className:"text-gray-700",children:h.executiveSummary})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Key Recommendations"}),e.jsx("ul",{className:"space-y-2",children:h.keyRecommendations.map((a,o)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(D,{className:"w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700",children:a})]},o))})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Report Selected"}),e.jsx("p",{className:"text-gray-500",children:"Upload an NGS report to begin analysis"})]}),fe=()=>h?.treatmentOptions.length?e.jsx("div",{className:"space-y-6",children:h.treatmentOptions.map((a,o)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.drug}),e.jsx("p",{className:"text-sm text-gray-600",children:a.drugClass})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.fdaApproval==="approved"?"bg-green-100 text-green-800":a.fdaApproval==="investigational"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:a.fdaApproval.replace("_"," ")}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.evidenceLevel==="high"?"bg-green-100 text-green-800":a.evidenceLevel==="moderate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[a.evidenceLevel," evidence"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Mechanism of Action"}),e.jsx("p",{className:"text-gray-700",children:a.mechanism})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Supporting Variants"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.supportingVariants.map((l,m)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded",children:l},m))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Expected Response"}),e.jsx("p",{className:"text-gray-700",children:a.expectedResponse})]})]})]},o))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Treatment Options"}),e.jsx("p",{className:"text-gray-500",children:"Complete genomic analysis to see treatment recommendations"})]}),je=()=>h?.clinicalTrials.length?e.jsx("div",{className:"space-y-6",children:h.clinicalTrials.map((a,o)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["NCT ID: ",a.nctId]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:["Phase ",a.phase]}),e.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${a.status==="recruiting"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:a.status})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Primary Endpoint"}),e.jsx("p",{className:"text-gray-700",children:a.primaryEndpoint})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Match Score"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${a.matchScore}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.matchScore,"%"]})]})]}),a.matchReasons&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Match Reasons"}),e.jsx("ul",{className:"space-y-1",children:a.matchReasons.map((l,m)=>e.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[e.jsx(D,{className:"w-4 h-4 text-green-500 mr-2"}),l]},m))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Locations"}),e.jsx("div",{className:"space-y-2",children:a.locations.slice(0,3).map((l,m)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-700",children:[l.facility,", ",l.city,", ",l.state]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${l.status==="recruiting"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:l.status})]},m))})]})]})]},o))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Matching Trials"}),e.jsx("p",{className:"text-gray-500",children:"Complete genomic analysis to find matching clinical trials"})]}),ve=()=>e.jsx("div",{className:"space-y-6",children:Q.map((a,o)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.methodology})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Turnaround"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[a.turnaroundTime," days"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Cancer Types"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.cancerTypes.map((l,m)=>e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-sm rounded",children:l},m))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Key Biomarkers"}),e.jsx("div",{className:"space-y-2",children:a.biomarkers.slice(0,5).map((l,m)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:l.name}),e.jsx("span",{className:"text-gray-500",children:l.methodology})]},m))})]}),a.cost&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Estimated Cost"}),e.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:["$",a.cost]})]})]})]},o))}),Ne=()=>h?.hereditaryRisks.length?e.jsx("div",{className:"space-y-6",children:h.hereditaryRisks.map((a,o)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.syndrome}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.gene," - ",a.variant]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Penetrance"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[(a.penetrance*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Recommendations"}),e.jsx("ul",{className:"space-y-2",children:a.recommendations.map((l,m)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(D,{className:"w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700",children:l})]},m))})]}),a.familyScreening&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(L,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-800",children:"Family Screening Recommended"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Consider genetic counseling and testing for family members"})]})]})})]})]},o))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Hereditary Risks"}),e.jsx("p",{className:"text-gray-500",children:"Complete genomic analysis to assess hereditary cancer risks"})]}),we=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Drug RXCUI"}),e.jsx("input",{value:f,onChange:a=>O(a.target.value),placeholder:"e.g., 11289 (warfarin)",className:"border border-gray-300 rounded px-3 py-2 w-64"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:U,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:B,children:B?"Loading…":"Load Report"}),e.jsx("button",{onClick:xe,className:"px-3 py-2 text-sm bg-gray-100 border border-gray-300 rounded hover:bg-gray-200",title:"Copy cURL",children:"Copy cURL"})]})]}),j&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"PGx Report"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Version ",j.version," • ",j.count," recommendations"]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:["Last updated: ",j.lastUpdated]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:(j.recommendations||[]).map((a,o)=>e.jsxs("div",{className:"py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.gene}),e.jsxs("span",{className:"text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded",children:["Level ",a.evidenceLevel]})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Phenotype: ",a.phenotype]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Recommendation: ",a.recommendation]})]},o))})]})]}),Ce=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{key:"annualADECost",label:"Annual ADE Cost ($)"},{key:"testCost",label:"Test Cost ($)"},{key:"targetPopulation",label:"Target Population"},{key:"expectedTestingRate",label:"Testing Rate (0-1)"},{key:"expectedADEreductionPct",label:"ADE Reduction Among Tested (0-1)"}].map(a=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:a.label}),e.jsx("input",{type:"number",step:"any",value:V[a.key],onChange:o=>pe(l=>({...l,[a.key]:Number(o.target.value)})),className:"border border-gray-300 rounded px-3 py-2 w-full"})]},a.key))}),e.jsx("button",{onClick:ue,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:_,children:_?"Calculating…":"Calculate ROI"}),y&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ROI Results"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Tests"}),e.jsx("div",{className:"text-gray-900 font-medium",children:y.outputs.tests})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Program Cost"}),e.jsxs("div",{className:"text-gray-900 font-medium",children:["$",y.outputs.programCost.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Savings"}),e.jsxs("div",{className:"text-gray-900 font-medium",children:["$",y.outputs.savings.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Net"}),e.jsxs("div",{className:`font-medium ${y.outputs.net>=0?"text-green-700":"text-red-700"}`,children:["$",y.outputs.net.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"ROI"}),e.jsx("div",{className:"text-gray-900 font-medium",children:y.outputs.roi!==null?(y.outputs.roi*100).toFixed(1)+"%":"—"})]})]})]})]});return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Enhanced Genomics Analysis"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive NGS report processing and genomic analysis platform"})]}),e.jsx("div",{className:"pt-1",children:e.jsx("button",{onClick:se,className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded",children:"Panel & Versions"})})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("nav",{className:"-mb-px flex space-x-8 overflow-x-auto",children:le.map(({id:a,label:o,icon:l,description:m})=>e.jsxs("button",{onClick:()=>s(a),className:`group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${u===a?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(l,{className:`w-5 h-5 mr-2 ${u===a?"text-blue-500":"text-gray-400 group-hover:text-gray-500"}`}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:o}),e.jsx("div",{className:"text-xs text-gray-400",children:m})]})]},a))})}),e.jsxs("div",{className:"min-h-96",children:[u==="upload"&&ye(),u==="analysis"&&be(),u==="treatments"&&fe(),u==="trials"&&je(),u==="biomarkers"&&ve(),u==="hereditary"&&Ne(),u==="pgx-report"&&we(),u==="pgx-roi"&&Ce()]}),Z&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>k(!1)}),e.jsxs("aside",{className:"fixed top-0 right-0 h-full w-full sm:w-[28rem] bg-white shadow-xl z-50 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"PGx Panel & Versions"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Evidence-driven, multi-specialty panel overview"})]}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:"×"})]}),e.jsxs("div",{className:"p-4 overflow-y-auto",children:[E&&e.jsx("div",{className:"text-sm text-gray-500",children:"Loading…"}),!E&&b&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Panel"}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["Version ",b.version]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Genes"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(b.genes||[]).map((a,o)=>e.jsxs("span",{className:`px-2 py-1 rounded text-xs border ${a.implemented?"bg-green-50 text-green-800 border-green-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:[a.symbol,a.implemented?"":" (planned)"]},o))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"HLA Alleles"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(b.hla||[]).map((a,o)=>e.jsx("span",{className:`px-2 py-1 rounded text-xs border ${a.implemented?"bg-green-50 text-green-800 border-green-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:a.symbol},o))})]})]})]}),!E&&C&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Version Log"}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["Current ",C.currentVersion]}),e.jsx("div",{className:"space-y-3",children:(C.changes||[]).map((a,o)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.version}),e.jsx("div",{className:"text-xs text-gray-500",children:a.date})]}),e.jsx("ul",{className:"mt-2 list-disc list-inside text-sm text-gray-700 space-y-1",children:(a.notes||[]).map((l,m)=>e.jsx("li",{children:l},m))})]},o))})]}),e.jsxs("div",{className:"mt-6 border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Actions"}),e.jsxs("div",{className:"flex flex-wrap items-end gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Open PGx Report by RXCUI"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border border-gray-300 rounded px-2 py-1 w-40",placeholder:"e.g., 11289",onKeyDown:a=>{if(a.key==="Enter"){const o=a.target.value.trim();o&&R(o)}}}),e.jsx("button",{onClick:()=>R("11289"),className:"px-2 py-1 text-xs bg-gray-100 border border-gray-300 rounded hover:bg-gray-200",title:"Warfarin",children:"11289"}),e.jsx("button",{onClick:()=>R("42463"),className:"px-2 py-1 text-xs bg-gray-100 border border-gray-300 rounded hover:bg-gray-200",title:"Clopidogrel",children:"42463"}),e.jsx("button",{onClick:()=>R("39998"),className:"px-2 py-1 text-xs bg-gray-100 border border-gray-300 rounded hover:bg-gray-200",title:"Irinotecan",children:"39998"})]})]}),e.jsxs("div",{className:"ml-auto flex flex-wrap gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:ae,className:"px-3 py-2 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50",children:"Export Panel CSV"}),e.jsx("button",{onClick:ne,className:"px-2 py-2 text-xs bg-gray-100 border border-gray-300 rounded hover:bg-gray-200",title:"Copy cURL",children:"Copy cURL"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:ie,className:"px-3 py-2 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50",children:"Export Versions CSV"}),e.jsx("button",{onClick:oe,className:"px-2 py-2 text-xs bg-gray-100 border border-gray-300 rounded hover:bg-gray-200",title:"Copy cURL",children:"Copy cURL"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:re,className:"px-3 py-2 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50",children:"Export Bundle JSON"}),e.jsx("button",{onClick:ce,className:"px-2 py-2 text-xs bg-gray-100 border border-gray-300 rounded hover:bg-gray-200",title:"Copy cURL",children:"Copy cURL"})]})]})]})]})]})]})]})]})},qe=()=>e.jsx(Pe,{featureName:"Pharmacogenomics Analysis",fallbackMessage:"The genomics analysis feature is temporarily unavailable. This may be due to data processing issues or connectivity problems.",children:e.jsx(Ae,{})});export{qe as default};
