import React, { useState, useEffect } from 'react';\nimport { useResponsive } from '../../hooks/useResponsive';\nimport { useAuth } from '../../context/AuthContext';\nimport MobileNavigation from './MobileNavigation';\nimport MobileHeader from './MobileHeader';\nimport SwipeableDrawer from './SwipeableDrawer';\nimport QuickActionFAB from './QuickActionFAB';\nimport TouchOptimizedSearch from './TouchOptimizedSearch';\nimport AlertBanner from '../UI/AlertBanner';\n\ninterface MobileOptimizedLayoutProps {\n  children: React.ReactNode;\n  showQuickActions?: boolean;\n  enableSwipeNavigation?: boolean;\n}\n\nconst MobileOptimizedLayout: React.FC<MobileOptimizedLayoutProps> = ({\n  children,\n  showQuickActions = true,\n  enableSwipeNavigation = true\n}) => {\n  const { isMobile, isTablet, orientation } = useResponsive();\n  const { user } = useAuth();\n  const [drawerOpen, setDrawerOpen] = useState(false);\n  const [searchOpen, setSearchOpen] = useState(false);\n  const [alerts, setAlerts] = useState<any[]>([]);\n\n  // Mobile-specific state management\n  const [touchStartX, setTouchStartX] = useState(0);\n  const [touchStartY, setTouchStartY] = useState(0);\n  const [isScrolling, setIsScrolling] = useState(false);\n\n  // Handle swipe gestures for navigation\n  const handleTouchStart = (e: React.TouchEvent) => {\n    if (!enableSwipeNavigation) return;\n    \n    const touch = e.touches[0];\n    setTouchStartX(touch.clientX);\n    setTouchStartY(touch.clientY);\n    setIsScrolling(false);\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    if (!enableSwipeNavigation || isScrolling) return;\n    \n    const touch = e.touches[0];\n    const deltaX = Math.abs(touch.clientX - touchStartX);\n    const deltaY = Math.abs(touch.clientY - touchStartY);\n    \n    // Detect if this is a vertical scroll\n    if (deltaY > deltaX && deltaY > 10) {\n      setIsScrolling(true);\n    }\n  };\n\n  const handleTouchEnd = (e: React.TouchEvent) => {\n    if (!enableSwipeNavigation || isScrolling) return;\n    \n    const touch = e.changedTouches[0];\n    const deltaX = touch.clientX - touchStartX;\n    const deltaY = Math.abs(touch.clientY - touchStartY);\n    \n    // Only trigger swipe if horizontal movement is dominant\n    if (Math.abs(deltaX) > 50 && deltaY < 100) {\n      if (deltaX > 0 && touchStartX < 50) {\n        // Swipe right from left edge - open drawer\n        setDrawerOpen(true);\n      } else if (deltaX < 0 && drawerOpen) {\n        // Swipe left when drawer is open - close drawer\n        setDrawerOpen(false);\n      }\n    }\n  };\n\n  // Handle device orientation changes\n  useEffect(() => {\n    const handleOrientationChange = () => {\n      // Small delay to allow for layout recomputation\n      setTimeout(() => {\n        window.dispatchEvent(new Event('resize'));\n      }, 100);\n    };\n\n    window.addEventListener('orientationchange', handleOrientationChange);\n    return () => window.removeEventListener('orientationchange', handleOrientationChange);\n  }, []);\n\n  // Quick actions for mobile users\n  const quickActions = [\n    {\n      icon: 'üîç',\n      label: 'Drug Search',\n      action: () => setSearchOpen(true),\n      color: 'bg-blue-500'\n    },\n    {\n      icon: '‚ö†Ô∏è',\n      label: 'Check Interactions',\n      action: () => console.log('Open interaction checker'),\n      color: 'bg-red-500'\n    },\n    {\n      icon: 'üìä',\n      label: 'My Dashboard',\n      action: () => console.log('Open dashboard'),\n      color: 'bg-green-500'\n    },\n    {\n      icon: 'üíä',\n      label: 'My Medications',\n      action: () => console.log('Open medications'),\n      color: 'bg-purple-500'\n    }\n  ];\n\n  if (!isMobile && !isTablet) {\n    // Return regular layout for desktop\n    return <div className=\"desktop-layout\">{children}</div>;\n  }\n\n  return (\n    <div \n      className={`mobile-layout min-h-screen bg-gray-50 ${orientation === 'landscape' ? 'landscape' : 'portrait'}`}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n    >\n      {/* Mobile Header */}\n      <MobileHeader \n        onMenuClick={() => setDrawerOpen(true)}\n        onSearchClick={() => setSearchOpen(true)}\n        user={user}\n        alerts={alerts}\n      />\n\n      {/* Alert Banners */}\n      {alerts.length > 0 && (\n        <div className=\"alert-container sticky top-14 z-40\">\n          {alerts.slice(0, 2).map((alert, index) => (\n            <AlertBanner \n              key={alert.id || index}\n              alert={alert}\n              onDismiss={() => setAlerts(prev => prev.filter((_, i) => i !== index))}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* Swipeable Navigation Drawer */}\n      <SwipeableDrawer \n        open={drawerOpen}\n        onOpen={() => setDrawerOpen(true)}\n        onClose={() => setDrawerOpen(false)}\n      >\n        <MobileNavigation \n          user={user}\n          onNavigate={() => setDrawerOpen(false)}\n        />\n      </SwipeableDrawer>\n\n      {/* Touch-Optimized Search Overlay */}\n      <TouchOptimizedSearch \n        open={searchOpen}\n        onClose={() => setSearchOpen(false)}\n      />\n\n      {/* Main Content */}\n      <main className=\"main-content pb-20 pt-2\">\n        <div className={`content-container ${orientation === 'landscape' ? 'px-4' : 'px-3'}`}>\n          {children}\n        </div>\n      </main>\n\n      {/* Quick Action FAB */}\n      {showQuickActions && (\n        <QuickActionFAB \n          actions={quickActions}\n          position=\"bottom-right\"\n        />\n      )}\n\n      {/* Mobile Bottom Navigation - Landscape only */}\n      {orientation === 'landscape' && (\n        <div className=\"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-30\">\n          <div className=\"flex justify-around items-center h-12 text-xs\">\n            <button className=\"flex-1 py-2 text-center text-gray-600\">\n              <div className=\"text-lg mb-1\">üè†</div>\n              Dashboard\n            </button>\n            <button className=\"flex-1 py-2 text-center text-gray-600\">\n              <div className=\"text-lg mb-1\">üîç</div>\n              Search\n            </button>\n            <button className=\"flex-1 py-2 text-center text-gray-600\">\n              <div className=\"text-lg mb-1\">‚ö†Ô∏è</div>\n              Interactions\n            </button>\n            <button className=\"flex-1 py-2 text-center text-gray-600\">\n              <div className=\"text-lg mb-1\">üë§</div>\n              Profile\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Mobile-specific styles */}\n      <style jsx>{`\n        .mobile-layout {\n          touch-action: manipulation;\n          -webkit-tap-highlight-color: transparent;\n          -webkit-touch-callout: none;\n          -webkit-user-select: none;\n          user-select: none;\n        }\n        \n        .landscape {\n          max-height: 100vh;\n          overflow-y: auto;\n        }\n        \n        .portrait {\n          min-height: 100vh;\n        }\n        \n        .main-content {\n          padding-top: env(safe-area-inset-top, 56px);\n          padding-bottom: env(safe-area-inset-bottom, 80px);\n        }\n        \n        .content-container {\n          max-width: 100%;\n          margin: 0 auto;\n        }\n        \n        /* iOS Safari specific fixes */\n        @supports (-webkit-touch-callout: none) {\n          .mobile-layout {\n            min-height: -webkit-fill-available;\n          }\n        }\n        \n        /* Smooth scrolling for mobile */\n        .main-content {\n          overflow-y: auto;\n          -webkit-overflow-scrolling: touch;\n          scroll-behavior: smooth;\n        }\n        \n        /* Touch-friendly button sizing */\n        button, .btn {\n          min-height: 44px;\n          min-width: 44px;\n        }\n        \n        /* Input focus improvements */\n        input, textarea, select {\n          font-size: 16px; /* Prevent zoom on iOS */\n        }\n        \n        /* Card spacing for mobile */\n        .card, .card-mobile {\n          margin: 8px;\n          border-radius: 12px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        }\n        \n        /* Tablet-specific adjustments */\n        @media (min-width: 768px) and (max-width: 1024px) {\n          .content-container {\n            max-width: 90%;\n            padding: 0 20px;\n          }\n          \n          .card-mobile {\n            margin: 12px;\n          }\n        }\n      `}</style>\n    </div>\n  );\n};\n\nexport default MobileOptimizedLayout;"